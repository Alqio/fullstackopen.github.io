<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>osa 6</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/osa6/">
  <link rel="alternate" type="application/rss+xml" title="Full stack open" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Full stack open</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">osa 6</h1>
  </header>

  <div class="post-content">
    <h2 id="osan-6-oppimistavoitteet">Osan 6 oppimistavoitteet</h2>

<ul>
  <li>Redux
    <ul>
      <li>Combined reducers</li>
      <li>Asynkroniset actionit</li>
    </ul>
  </li>
  <li>React+redux
    <ul>
      <li>connect</li>
    </ul>
  </li>
  <li>React
    <ul>
      <li>presenter/container-patterni</li>
      <li>High order -komponentit</li>
      <li>React router</li>
      <li>Inline-tyylit</li>
      <li>UI-frameworkien käyttö</li>
    </ul>
  </li>
</ul>

<h2 id="muistiinpano-sovelluksen-refaktorointia">Muistiinpano-sovelluksen refaktorointia</h2>

<p>Jatketaan osan 5 loppupuolella tehdyn muistiinpanosovelluksen yksinkertaistetun <a href="/osa5#redux-muistiinpanot">redux-version</a> laajentamista.</p>

<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part5-6">githubissa</a> tagissä <em>part5-6</em>.</p>

<p>Tehdään koodiin muutamia rakenteellisia muutoksia. Siirretään reducerin määrittelevä tiedosto <em>noteReducer.js</em> hakemistoon <em>src/reducers</em>.</p>

<p>Sovelluskehitystä helpottaaksemme laajennetaan reduceria siten, että storelle määritellään alkutila, jossa on pari muistiinpanoa:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">initalState</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'reduxin storen toiminnan määrittelee reduceri'</span><span class="p">,</span> <span class="na">important</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
  <span class="p">{</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'storen tilassa voi olla mielivaltaista dataa'</span><span class="p">,</span> <span class="na">important</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">]</span>
<span class="kd">const</span> <span class="nx">noteReducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initalState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">noteReducer</span>
</code></pre></div></div>

<p>Siirretään <a href="https://redux.js.org/advanced/async-actions#synchronous-action-creators">action creatorit</a>, eli sopivia <a href="https://redux.js.org/basics/actions">action</a>-olioita generoivat apufunktiot reducerin kanssa samaan moduuliin:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">initalState</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'reduxin storen toiminnan määrittelee reduceri'</span><span class="p">,</span> <span class="na">important</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'storen tilassa voi olla mielivaltaista dataa'</span><span class="p">,</span> <span class="na">important</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="mi">2</span> <span class="p">}</span>
<span class="p">]</span>

<span class="kd">const</span> <span class="nx">noteReducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">initalState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'NEW_NOTE'</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">[...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">.</span><span class="nx">data</span><span class="p">]</span>
    <span class="k">case</span> <span class="s1">'TOGGLE_IMPORTANCE'</span><span class="p">:</span>
      <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">action</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span>
      <span class="kd">const</span> <span class="nx">noteToChange</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">n</span> <span class="o">=&gt;</span> <span class="nx">n</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span>
      <span class="kd">const</span> <span class="nx">changedNote</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="nx">noteToChange</span><span class="p">,</span> <span class="na">important</span><span class="p">:</span> <span class="o">!</span><span class="nx">noteToChange</span><span class="p">.</span><span class="nx">important</span> <span class="p">}</span>
      <span class="k">return</span> <span class="nx">state</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">id</span> <span class="p">?</span> <span class="nx">note</span> <span class="p">:</span> <span class="nx">changedNote</span> <span class="p">)</span>
    <span class="na">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">state</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">generateId</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Number</span><span class="p">((</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">noteCreation</span> <span class="o">=</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'NEW_NOTE'</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">content</span><span class="p">,</span>
      <span class="na">important</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">id</span><span class="p">:</span> <span class="nx">generateId</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">constimportanceToggling</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'TOGGLE_IMPORTANCE'</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">noteReducer</span>
</code></pre></div></div>

<p>Moduulissa on nyt useita <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export">export</a>-komentoja.</p>

<p>Reducer-funktio palautetaan edelleen komennolla <em>export default</em>. Tämän ansiosta reducer importataan (tiedostossa <em>index.js</em>) tuttuun tapaan:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">noteReducer</span> <span class="k">from</span> <span class="s1">'./reducers/noteReducer'</span>
</code></pre></div></div>

<p>Moduulilla voi olla vain <em>yksi default export</em>, mutta useita “normaaleja” exporteja, kuten <em>Action creator</em> -funktiot esimerkissämme</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">noteCreation</span> <span class="o">=</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">importanceToggling</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Normaalisti exportattujen funktioiden käyttöönotto tapahtuu aaltosulkusyntaksilla:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">noteCreation</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./../reducers/noteReducer'</span>
</code></pre></div></div>

<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-1">githubissa</a> tagissä <em>part6-1</em>.</p>

<h2 id="eslint">ESlint</h2>

<p>Konfiguroimme osassa 3 koodin tyylistä huolehtivan <a href="/osa3#lint">ESlintin</a> backendiin. Otetaan nyt ESlint käyttöön myös frontendissa.</p>

<p>Create-react-app on asentanut projektille eslintin valmiiksi, joten ei tarvita muuta kun sopiva konfiguraatio tiedoston <em>.eslintrc.js</em>.</p>

<p>Tiedoston voi generoida komennolla</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npx eslint <span class="nt">--init</span>
</code></pre></div></div>

<p>ja vastailemalla sopivasti kysymyksiin:</p>

<p><img src="http://localhost:4000/images/6/1a.png" alt="" /></p>

<p>Jotta pääsemme eroon testeissä olevista turhista huomautuksista asennetaan <a href="https://www.npmjs.com/package/eslint-plugin-jest">eslint-jest-plugin</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm add <span class="nt">--save-dev</span> eslint-plugin-jest
</code></pre></div></div>

<p>ja otetaan se käyttöön manuaalin opastamalla tavalla.</p>

<p>Jos vastailit initialisoinnissa kysymyksiin kuvan osoittamalla tavalla, asentuu projektiin  <a href="https://github.com/yannickcr/eslint-plugin-react">eslint-react-plugin</a>. Laajennetaan konfiguraatiota pluginin <a href="https://github.com/yannickcr/eslint-plugin-react#configuration">manuaalin</a> ohjeen mukaan.</p>

<p>Joudumme asentamaan myös <a href="https://github.com/babel/babel-eslint">babel-eslint</a>-pluginin, jotta ESlint osaisi tulkita koodissa käyttämäämme <em>class property</em> -syntaksia. Pluginin asennus tapahtuu komennolla</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install babel-eslint <span class="nt">--save-dev</span>
</code></pre></div></div>

<p>ja se tulee muistaa ottaa käyttöön konfiguraatiossa.</p>

<p>Seuraavassa lopullinen konfiguraatio, mihin on lisätty muutama muukin osassa 3 käyttöönotettu sääntö:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module.exports <span class="o">=</span> <span class="o">{</span>
    <span class="s2">"env"</span>: <span class="o">{</span>
        <span class="s2">"browser"</span>: <span class="nb">true</span>,
        <span class="s2">"es6"</span>: <span class="nb">true</span>,
        <span class="s2">"jest/globals"</span>: <span class="nb">true</span>
    <span class="o">}</span>,
    <span class="s2">"extends"</span>: <span class="o">[</span>
        <span class="s2">"eslint:recommended"</span>,
        <span class="s2">"plugin:react/recommended"</span>
    <span class="o">]</span>,
    <span class="s2">"parser"</span>: <span class="s2">"babel-eslint"</span>,
    <span class="s2">"parserOptions"</span>: <span class="o">{</span>
        <span class="s2">"ecmaFeatures"</span>: <span class="o">{</span>
            <span class="s2">"experimentalObjectRestSpread"</span>: <span class="nb">true</span>,
            <span class="s2">"jsx"</span>: <span class="nb">true</span>
        <span class="o">}</span>,
        <span class="s2">"sourceType"</span>: <span class="s2">"module"</span>
    <span class="o">}</span>,
    <span class="s2">"plugins"</span>: <span class="o">[</span>
        <span class="s2">"react"</span>, <span class="s2">"jest"</span>
    <span class="o">]</span>,
    <span class="s2">"rules"</span>: <span class="o">{</span>
        <span class="s2">"indent"</span>: <span class="o">[</span>
            <span class="s2">"error"</span>,
            2
        <span class="o">]</span>,
        <span class="s2">"linebreak-style"</span>: <span class="o">[</span>
            <span class="s2">"error"</span>,
            <span class="s2">"unix"</span>
        <span class="o">]</span>,
        <span class="s2">"quotes"</span>: <span class="o">[</span>
            <span class="s2">"error"</span>,
            <span class="s2">"single"</span>
        <span class="o">]</span>,
        <span class="s2">"semi"</span>: <span class="o">[</span>
            <span class="s2">"error"</span>,
            <span class="s2">"never"</span>
        <span class="o">]</span>,
        <span class="s2">"eqeqeq"</span>: <span class="s2">"error"</span>,
        <span class="s2">"no-trailing-spaces"</span>: <span class="s2">"error"</span>,
        <span class="s2">"object-curly-spacing"</span>: <span class="o">[</span>
            <span class="s2">"error"</span>, <span class="s2">"always"</span>
        <span class="o">]</span>,
        <span class="s2">"arrow-spacing"</span>: <span class="o">[</span>
            <span class="s2">"error"</span>, <span class="o">{</span> <span class="s2">"before"</span>: <span class="nb">true</span>, <span class="s2">"after"</span>: <span class="nb">true</span> <span class="o">}</span>
        <span class="o">]</span>,
        <span class="s2">"no-console"</span>: 0,
        <span class="s2">"react/prop-types"</span>: 0
    <span class="o">}</span>
<span class="o">}</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="monimutkaisempi-tila-storessa">Monimutkaisempi tila storessa</h2>

<p>Toteutetaan sovellukseen näytettävien muistiinpanojen filtteröinti, jonka avulla näytettäviä muistiinpanoja voidaan rajata. Filtterin toteutus tapahtuu <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/radio">radiobuttoneiden</a> avulla:</p>

<p><img src="http://localhost:4000/assets/6/1.png" alt="" /></p>

<p>Aloitetaan todella suoraviivaisella toteutuksella:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">filterSelected</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">NoteForm</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          kaikki    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type=</span><span class="s2">"radio"</span> <span class="na">name=</span><span class="s2">"filter"</span>
                      <span class="na">onChange=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">filterSelected</span><span class="p">(</span><span class="s1">'ALL'</span><span class="p">)</span><span class="si">}</span><span class="p">/&gt;</span>
          tärkeät   <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type=</span><span class="s2">"radio"</span> <span class="na">name=</span><span class="s2">"filter"</span>
                      <span class="na">onChange=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">filterSelected</span><span class="p">(</span><span class="s1">'IMPORTANT'</span><span class="p">)</span><span class="si">}</span><span class="p">/&gt;</span>
          eitärkeät <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type=</span><span class="s2">"radio"</span> <span class="na">name=</span><span class="s2">"filter"</span>
                      <span class="na">onChange=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">filterSelected</span><span class="p">(</span><span class="s1">'NONIMPORTANT'</span><span class="p">)</span><span class="si">}</span><span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">NoteList</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Koska painikkeiden attribuutin <em>name</em> arvo on kaikilla sama, muodostavat ne <em>nappiryhmän</em>, joista ainoastaan yksi voi olla kerrallaan valittuna.</p>

<p>Napeille on määritelty muutoksenkäsittelijä, joka tällä hetkellä ainoastaan tulostaa painettua nappia vastaavan merkkijonon konsoliin.</p>

<p>Päätämme toteuttaa filtteröinnin siten, että talletamme muistiinpanojen lisäksi sovelluksen storeen myös <em>filtterin arvon</em>. Eli muutoksen jälkeen storessa olevan tilan tulisi näyttää seuraavalta:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">notes</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'reduxin storen toiminnan määrittelee reduceri'</span><span class="p">,</span> <span class="na">important</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="p">{</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'storen tilassa voi olla mielivaltaista dataa'</span><span class="p">,</span> <span class="na">important</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
  <span class="p">],</span>
  <span class="nx">filter</span><span class="p">:</span> <span class="s1">'IMPORTANT'</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Tällä hetkellähän tilassa on ainoastaan muistiinpanot sisältävä taulukko. Uudessa ratkaisussa tilalla on siis kaksi avainta, <em>notes</em> jonka arvona muistiinpanot ovat sekä <em>filter</em>, jonka arvona on merkkijono joka kertoo mitkä muistiinpanoista tulisi näyttää ruudulla.</p>

<h3 id="yhdistetyt-reducerit">Yhdistetyt reducerit</h3>

<p>Voisimme periaatteessa muokata jo olemassaolevaa reduceria ottamaan huomioon muuttuneen tilanteen. Parempi ratkaisu on kuitenkin määritellä tässä tilanteessa uusi, filtterin arvosta huolehtiva reduceri:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">filterReducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="s1">'ALL'</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'SET_FILTER'</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">action</span><span class="p">.</span><span class="nx">filter</span>
    <span class="na">default</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">state</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Filterin arvon asettavat actionit ovat siis muotoa</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">type</span><span class="p">:</span> <span class="s1">'SET_FILTER'</span><span class="p">,</span>
  <span class="nx">filter</span><span class="p">:</span> <span class="s1">'IMPORTANT'</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Määritellään samalla myös sopiva <em>action creator</em> -funktio. Sijoitetaan koodi moduuliin <em>src/reducers/filterReducer.js</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">filterReducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="s1">'ALL'</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">filterChange</span> <span class="o">=</span> <span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'SET_FILTER'</span><span class="p">,</span>
    <span class="nx">filter</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">filterReducer</span>
</code></pre></div></div>

<p>Saamme nyt muodostettua varsinaisen reducerin yhdistämällä kaksi olemassaolevaa reduceria funktion <a href="https://redux.js.org/api-reference/combinereducers">combineReducers</a> avulla.</p>

<p>Määritellään yhdistetty reduceri tiedostossa <em>index.js</em>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="nx">ReactDOM</span> <span class="k">from</span> <span class="s1">'react-dom'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">combineReducers</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'redux'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Provider</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-redux'</span>
<span class="k">import</span> <span class="nx">App</span> <span class="k">from</span> <span class="s1">'./App'</span>
<span class="k">import</span> <span class="nx">noteReducer</span> <span class="k">from</span> <span class="s1">'./reducers/noteReducer'</span>
<span class="k">import</span> <span class="nx">filterReducer</span> <span class="k">from</span> <span class="s1">'./reducers/filterReducer'</span>

<span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">({</span>
  <span class="na">notes</span><span class="p">:</span> <span class="nx">noteReducer</span><span class="p">,</span>
  <span class="na">filter</span><span class="p">:</span> <span class="nx">filterReducer</span>
<span class="p">})</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">())</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="p">&lt;</span><span class="nc">Provider</span> <span class="na">store=</span><span class="si">{</span><span class="nx">store</span><span class="si">}</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nc">Provider</span><span class="p">&gt;,</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">))</span>
</code></pre></div></div>

<p>Koska sovelluksemme hajoaa tässä vaiheessa täysin, komponentin <em>App</em> sijasta renderöidään tyhjä <em>div</em>-elementti.</p>

<p>Konsoliin tulostuu storen tila:</p>

<p><img src="http://localhost:4000/assets/6/2.png" alt="" /></p>

<p>eli store on juuri siinä muodossa missä haluammekin sen olevan!</p>

<p>Tarkastellaan vielä yhdistetyn reducerin luomista</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">({</span>
  <span class="na">notes</span><span class="p">:</span> <span class="nx">noteReducer</span><span class="p">,</span>
  <span class="na">filter</span><span class="p">:</span> <span class="nx">filterReducer</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Näin tehdyn reducerin määrittelemän storen tila on olio, jossa on kaksi kenttää, <em>notes</em> ja <em>filter</em>. Tilan kentän <em>notes</em> arvon määrittelee <em>noteReducer</em>, jonka ei tarvitse välittää mitään tilan muista kentistä. Vastaavasti <em>filter</em> kentän käsittely tapahtuu <em>filterReducer</em>:in avulla.</p>

<p>Ennen muun koodin muutoksia, kokeillaan vielä konsolista, miten actionit muuttavat yhdistetyn reducerin muodostamaa staten tilaa:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//...</span>
<span class="k">import</span> <span class="nx">noteReducer</span><span class="p">,</span> <span class="p">{</span> <span class="nx">noteCreation</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./reducers/noteReducer'</span>
<span class="k">import</span> <span class="nx">filterReducer</span><span class="p">,</span> <span class="p">{</span> <span class="nx">filterChange</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./reducers/filterReducer'</span>

<span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">({</span>
  <span class="na">notes</span><span class="p">:</span> <span class="nx">noteReducer</span><span class="p">,</span>
  <span class="na">filter</span><span class="p">:</span> <span class="nx">filterReducer</span>
<span class="p">})</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">)</span>
<span class="nx">store</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">())</span>
<span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">())</span>
<span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">filterChange</span><span class="p">(</span><span class="s1">'IMPORTANT'</span><span class="p">))</span>
<span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">noteCreation</span><span class="p">(</span><span class="s1">'combineReducers muodostaa yhdistetyn reducerin'</span><span class="p">))</span>
</code></pre></div></div>

<p>Konsoliin tulostuu storen tila:</p>

<p><img src="http://localhost:4000/assets/6/3.png" alt="" /></p>

<p>Jo tässä vaiheessa kannattaa laittaa mieleen eräs tärkeä detalji. Jos lisäämme <em>molempien reducerien alkuun</em> konsoliin tulostuksen:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">filterReducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="s1">'ALL'</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'ACTION: '</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Näyttää konsolin perusteella siltä, että jokainen action kahdentuu:</p>

<p><img src="http://localhost:4000/assets/6/4.png" alt="" /></p>

<p>Onko koodissa bugi? Ei. Yhdistetty reducer toimii siten, että jokainen <em>action</em> käsitellään <em>kaikissa</em> yhdistetyn reducerin osissa. Usein tietystä actionista on kiinnostunut vain yksi reduceri, on kuitenkin tilanteita, joissa useampi reduceri muuttaa hallitsemaansa staten tilaa jonkin actionin seurauksena.</p>

<h3 id="sovelluksen-viimeistely">Sovelluksen viimeistely</h3>

<p>Viimeistellään nyt sovellus käyttämään yhdistettyä reduceria, eli palautetaan tiedostossa <em>index.js</em> suoritettava renderöinti muotoon</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="p">&lt;</span><span class="nc">Provider</span> <span class="na">store=</span><span class="si">{</span><span class="nx">store</span><span class="si">}</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nc">App</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nc">Provider</span><span class="p">&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">))</span>
</code></pre></div></div>

<p>Korjataan sitten bugi, joka johtuu siitä, että koodi olettaa storen tilan olevan mustiinpanot tallettava taulukko:</p>

<p><img src="http://localhost:4000/assets/6/5.png" alt="" /></p>

<p>Korjaus on helppo. Viitteen <code>this.context.store.getState()</code> sijaan kaikki muistiinpanot sisältävään taulukkoon viitataan <code>this.context.store.getState().notes</code>.</p>

<p>Ennakoiden tulevaa eriytetään näytettävien muistiinpanojen selvittämisen huolehtiminen funktioon <em>notesToShow</em>, joka vielä tässä vaiheessa palauttaa kaikki muistiinpanot:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">NoteList</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// ...</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">notesToShow</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">().</span><span class="nx">notes</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="nx">notesToShow</span><span class="p">().</span><span class="nx">map</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span>
          <span class="p">&lt;</span><span class="nc">Note</span>
            <span class="na">key=</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span>
            <span class="na">note=</span><span class="si">{</span><span class="nx">note</span><span class="si">}</span>
            <span class="na">handleClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">toggleImportance</span><span class="p">(</span><span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="si">}</span>
          <span class="p">/&gt;</span>
        <span class="p">)</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Eriytetään näkyvyyden säätelyfiltteri omaksi, tiedostoon sijoitettavaksi <em>src/components/VisibilityFilter.js</em> komponentiksi:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="nx">PropTypes</span> <span class="k">from</span> <span class="s1">'prop-types'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">filterChange</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'../reducers/filterReducer'</span>

<span class="kd">class</span> <span class="nx">VisibilityFilter</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">store</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">unsubscribe</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">forceUpdate</span><span class="p">()</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="nx">filterClicked</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">filterChange</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        kaikki    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type=</span><span class="s2">"radio"</span> <span class="na">name=</span><span class="s2">"filter"</span> <span class="na">onChange=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">filterClicked</span><span class="p">(</span><span class="s1">'ALL'</span><span class="p">)</span><span class="si">}</span> <span class="p">/&gt;</span>
        tärkeät   <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type=</span><span class="s2">"radio"</span> <span class="na">name=</span><span class="s2">"filter"</span> <span class="na">onChange=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">filterClicked</span><span class="p">(</span><span class="s1">'IMPORTANT'</span><span class="p">)</span><span class="si">}</span> <span class="p">/&gt;</span>
        eitärkeät <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type=</span><span class="s2">"radio"</span> <span class="na">name=</span><span class="s2">"filter"</span> <span class="na">onChange=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">filterClicked</span><span class="p">(</span><span class="s1">'NONIMPORTANT'</span><span class="p">)</span><span class="si">}</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">VisibilityFilter</span><span class="p">.</span><span class="nx">contextTypes</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">store</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">object</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">VisibilityFilter</span>
</code></pre></div></div>

<p>Toteutus on suoraviivainen, radiobuttonin klikkaaminen muuttaa storen kentän <em>filter</em> tilaa.</p>

<p>Muutetaan vielä komponentin <em>NoteList</em> metodi <em>notesToShow</em> ottamaan huomioon filtteri</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">notesToShow</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">notes</span><span class="p">,</span> <span class="nx">filter</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">()</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span> <span class="o">===</span> <span class="s1">'ALL'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">notes</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">filter</span> <span class="o">===</span> <span class="s1">'IMPORTANT'</span>
    <span class="p">?</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
    <span class="p">:</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Huomaa miten storen tilan kentät on otettu tuttuun tapaan destrukturoimalla apumuuttujiin</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">notes</span><span class="p">,</span> <span class="nx">filter</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">()</span>
</code></pre></div></div>

<p>siis on sama kuin kirjoittaisimme</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">notes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">().</span><span class="nx">notes</span>
<span class="kd">const</span> <span class="nx">filter</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">getState</span><span class="p">().</span><span class="nx">filter</span>
</code></pre></div></div>

<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-2">githubissa</a> tagissä <em>part6-2</em>.</p>

<p>Sovelluksessa on vielä pieni kauneusvirhe, vaikka oletusarvosesti filtterin arvo on <em>ALL</em>, eli näytetään kaikki muistiinpanot, ei vastaava radiobutton ole valittuna. Ongelma on luonnollisestikin mahdollista korjata, mutta koska kyseessä on ikävä, mutta harmiton feature, jätämme korjauksen myöhemmäksi.</p>

<h2 id="tehtäviä">Tehtäviä</h2>

<p>Tee nyt tehtävät <a href="/tehtävät/#osa-6">6.1-6.5</a></p>

<h2 id="connect">Connect</h2>

<p>Kaikissa Redux-storea käyttävissä komponenteissa on runsaasti samaa koodia</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">ComponentUsingReduxStore</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">store</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">unsubscribe</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">forceUpdate</span><span class="p">()</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">()</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="nx">ComponentUsingReduxStore</span><span class="p">.</span><span class="nx">contextTypes</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">store</span><span class="p">:</span> <span class="nx">PropTypes</span><span class="p">.</span><span class="nx">object</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Vaikka rivit on helppo copy-pasteta aina uusiin komponentteihin, ei tämä ole tarkoituksenmukaista. Osan 5 luvussa <a href="/osa5#staten-välittäminen-propseissa-ja-contextissa">staten välittäminen propseissa ja contextissa</a> myös varoiteltiin luottamasta liikaa Reactin Context API:iin, se on kokeellinen ja saattaa poistua tulevissa versioissa. Contextia on siis ainakin tässä vaiheessa käytettävä varovasti.</p>

<p><a href="https://github.com/reactjs/react-redux">React Redux</a> -kirjaston määrittelemä funktio <a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options">connect</a> on paras ratkaisu siihen, miten Redux-store saadaan välitettyä React-componenteille.</p>

<p>Connect voi olla aluksi haastava sisäistää, mutta hieman vaivaa kannattaa ehdottomasti nähdä. Tutustutaan nyt connectin käyttöön. Asensimme jo edellisessä osassa kirjaston, joten voimme aloittaa sen käytön suoraan.</p>

<p>Tutkitaan ensin komponenttia <em>NoteList</em>. Funktiota <em>connect</em> käyttämällä “normaaleista” React-komponenteista saadaan muodostettua komponentteja, joiden <em>propseihin</em> on “mäpätty” eli yhdistetty haluttuja osia storen määrittelemästä tilasta.</p>

<p>Muodostetaan ensin komponentista <em>NoteList</em> connectin avulla <em>yhdistetty komponentti</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">connect</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-redux'</span>

<span class="kd">class</span> <span class="nx">NoteList</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">ConnectedNoteList</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">()(</span><span class="nx">NoteList</span><span class="p">)</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">ConnectedNoteList</span>
</code></pre></div></div>

<p>Moduuli eksporttaa nyt alkuperäisen komponentin sijaan <em>yhdistetyn komponentin</em>, joka toimii toistaiseksi täsmälleen alkuperäisen komponentin kaltaisesti.</p>

<p>Komponentti tarvitsee storesta sekä muistiinpanojen listan, että filtterin arvon. Funktion <em>connect</em> ensimmäisenä parametrina voidaan määritellä funktio <a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#arguments">mapStateToProps</a>, joka liittää joitakin storen tilan perusteella määriteltyjä asioita connectilla muodostetun <em>yhdistetyn komponentin</em> propseiksi.</p>

<p>Jos määritellään:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">notes</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">,</span>
    <span class="na">filter</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">filter</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">ConnectedNoteList</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="nx">mapStateToProps</span>
<span class="p">)(</span><span class="nx">NoteList</span><span class="p">)</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">ConnectedNoteList</span>
</code></pre></div></div>

<p>on komponentin <em>NoteList</em> sisällä mahdollista viitata storen tilaan, esim. muistiinpanoihin suoraan propsin kautta <em>props.notes</em> sen sijaan, että käytettäisiin suoraan contextia muodossa <em>this.context.store.getState().notes</em>. Vastaavasti <em>props.filter</em> viittaa storessa olevaan filter-kentän tilaan.</p>

<p>Metodin <em>render</em> sisältö pelkistyy seuraavasti</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">NoteList</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">notesToShow</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="p">{</span> <span class="nx">notes</span><span class="p">,</span> <span class="nx">filter</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span> <span class="o">===</span> <span class="s1">'ALL'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">notes</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">filter</span> <span class="o">===</span> <span class="s1">'IMPORTANT'</span>
        <span class="p">?</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
        <span class="p">:</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Connect-komennolla, ja <em>mapStateToProps</em>-määrittelyllä aikaan saatua tilannetta voidaan visualisoida seuraavasti:</p>

<p><img src="http://localhost:4000/assets/6/5b.png" alt="" /></p>

<p>eli komponentin <em>NoteList</em> sisältä on propsien <em>props.notes</em> ja <em>props.filter</em> kautta “suora pääsy” tarkastelemaan Redux storen sisällä olevaa tilaa.</p>

<p><em>NoteList</em> viittaa edelleen suoraan kontekstin kautta storen metodiin <em>dispatch</em>, jota se tarvitsee action creatorin <em>importanceToggling</em> avulla tehdyn actionin dispatchaamiseen:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">toggleImportance</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span>
    <span class="nx">importanceToggling</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre></div></div>

<p>Connect-funktion toisena parametrina voidaan määritellä <a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#arguments">mapDispatchToProps</a> eli joukko <em>action creator</em> -funktioita, jotka välitetään yhdistetylle komponentille propseina. Laajennetaan connectausta seuraavasti</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">notes</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">,</span>
    <span class="na">filter</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">filter</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">importanceToggling</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">ConnectedNoteList</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="nx">mapStateToProps</span><span class="p">,</span>
  <span class="nx">mapDispatchToProps</span>
<span class="p">)(</span><span class="nx">NoteList</span><span class="p">)</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">ConnectedNoteList</span>
</code></pre></div></div>

<p>Nyt komponentti voi dispatchata suoraan action creatorin <em>importanceToggling</em> määrittelemän actionin kutsumalla prosien kautta saamaansa funktiota koodissa:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">NoteList</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">toggleImportance</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">importanceToggling</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Storen <em>dispatch</em>-funktiota ei enää tarvitse kutsua, sillä <em>connect</em> on muokannut action creatorin <em>importanceToggling</em> sellaiseen muotoon, joka sisältää  dispatchauksen.</p>

<p><em>mapDispatchToProps</em> lienee aluksi hieman haastava ymmärtää, etenkin sen kohta käsiteltävä <a href="/osa6/#mapdispatchtopropsin-vaihtoehtoinen-käyttötapa">vaihtoehtoinen käyttötapa</a>.</p>

<p>Connectin aikaansaamaa tilannetta voidaan havainnollistaa seuraavasti:</p>

<p><img src="http://localhost:4000/assets/6/5c.png" alt="" /></p>

<p>eli sen lisäksi että <em>NoteList</em> pääsee storen tilaan propsien <em>props.notes</em> ja <em>props.filter</em> kautta, se viittaa <em>props.importanceToggling</em>:lla funktioon, jonka avulla storeen saadaan dispatchattua <em>TOGGLE_IMPORTANCE</em>-tyyppisiä actioneja.</p>

<p>Koska komponentti saa storeen liittyvät asiat propseina, voidaan koodista poistaa metodit <em>componentDidMount</em> ja <em>componentWillUnMount</em> jotka huolehtivat komponentin uudelleenrenderöitymisestä storen tilan muuttuessa. Connect tekee tämän puolestamme.</p>

<p>Komponentti <em>NoteList</em> ei tarvitse storea enää mihinkään, se saa kaiken tarvitsemansa propseina <em>connect</em>-funktion ansiosta. Komponentti ei käytä enää suoraan contextia, joten koodi yksinkertaistuu seuraavaan muotoon:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">connect</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-redux'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">importanceToggling</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./../reducers/noteReducer'</span>
<span class="k">import</span> <span class="nx">Note</span> <span class="k">from</span> <span class="s1">'./Note'</span>

<span class="kd">class</span> <span class="nx">NoteList</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">notesToShow</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="p">{</span> <span class="nx">notes</span><span class="p">,</span> <span class="nx">filter</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span> <span class="o">===</span> <span class="s1">'ALL'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">notes</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">filter</span> <span class="o">===</span> <span class="s1">'IMPORTANT'</span>
        <span class="p">?</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
        <span class="p">:</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="nx">notesToShow</span><span class="p">().</span><span class="nx">map</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span>
          <span class="p">&lt;</span><span class="nc">Note</span>
            <span class="na">key=</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span>
            <span class="na">note=</span><span class="si">{</span><span class="nx">note</span><span class="si">}</span>
            <span class="na">handleClick=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">importanceToggling</span><span class="p">(</span><span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="si">}</span>
          <span class="p">/&gt;</span>
        <span class="p">)</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">notes</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">,</span>
    <span class="na">filter</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">filter</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">ConnectedNoteList</span> <span class="o">=</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="nx">mapStateToProps</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">importanceToggling</span> <span class="p">}</span>
<span class="p">)(</span><span class="nx">NoteList</span><span class="p">)</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">ConnectedNoteList</span>
</code></pre></div></div>

<p>Koodi sisältää pari muutakin oikaisua, mm. apumetodista <em>toggleImportance</em> on hankkiuduttu eroon.
Itseasiassa komponentti on nyt niin yksinkertainen että se voitaisiin määritellä funktionaalisena komponenttina. Emme kuitenkaan tee muutosta nyt.</p>

<p>Otetaan <em>connect</em> käyttöön myös uuden muistiinpanon luomisessa:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">noteCreation</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./../reducers/noteReducer'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">connect</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-redux'</span>

<span class="kd">class</span> <span class="nx">NoteForm</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">addNote</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">noteCreation</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">form</span> <span class="na">onSubmit=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">addNote</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name=</span><span class="s2">"note"</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>lisää<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="kc">null</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">noteCreation</span> <span class="p">}</span>
<span class="p">)(</span><span class="nx">NoteForm</span><span class="p">)</span>
</code></pre></div></div>

<p>Koska komponentti ei tarvitse storen tilasta mitään, on funktion <em>connect</em> ensimmäinen parametri <em>null</em>.</p>

<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-3">githubissa</a> tagissä <em>part6-3</em>.</p>

<h3 id="provider">Provider</h3>

<p>Funktion <em>connect</em> käytön edellytyksenä on se, että sovellus on määritelty React redux kirjaston tarjoaman <a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#provider-store">Provider</a>-komponentin lapseksi ja että sovelluksen käyttämä store on annettu Provider-komponentin attribuutiksi <em>store</em>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="nx">ReactDOM</span> <span class="k">from</span> <span class="s1">'react-dom'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">combineReducers</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'redux'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Provider</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-redux'</span>
<span class="k">import</span> <span class="nx">App</span> <span class="k">from</span> <span class="s1">'./App'</span>
<span class="k">import</span> <span class="nx">noteReducer</span> <span class="k">from</span> <span class="s1">'./reducers/noteReducer'</span>
<span class="k">import</span> <span class="nx">filterReducer</span> <span class="k">from</span> <span class="s1">'./reducers/filterReducer'</span>

<span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">({</span>
  <span class="na">notes</span><span class="p">:</span> <span class="nx">noteReducer</span><span class="p">,</span>
  <span class="na">filter</span><span class="p">:</span> <span class="nx">filterReducer</span>
<span class="p">})</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">)</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="p">&lt;</span><span class="nc">Provider</span> <span class="na">store=</span><span class="si">{</span><span class="nx">store</span><span class="si">}</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nc">App</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nc">Provider</span><span class="p">&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">))</span>
</code></pre></div></div>

<p>Lisäsimme jo edellisen osan lopussa sovellukseen <em>Providerin</em>, joten <em>connect</em> oli tällä kertaa suoraan käytettävissä.</p>

<h3 id="huomio-propsina-välitettyyn-action-creatoriin-viittaamisesta">Huomio propsina välitettyyn action creatoriin viittaamisesta</h3>

<p>Tarkastellaan vielä erästä mielenkiintoista seikkaa komponentista <em>NoteForm</em>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">noteCreation</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./../reducers/noteReducer'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">connect</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-redux'</span>

<span class="kd">class</span> <span class="nx">NoteForm</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">addNote</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">noteCreation</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="kc">null</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">noteCreation</span> <span class="p">}</span>
<span class="p">)(</span><span class="nx">NoteForm</span><span class="p">)</span>
</code></pre></div></div>

<p>Aloittelevalle connectin käyttäjälle aiheuttaa joskus ihmetystä se, että action creatorista <em>noteCreation</em> on komponentin sisällä käytettävissä <em>kaksi eri versiota</em>.</p>

<p>Funktioon tulee viitata propsien kautta, eli <em>this.props.noteCreation</em>, tällöin kyseessä on <em>connectin</em> muotoilema, <em>dispatchauksen sisältävä</em> versio funktiosta.</p>

<p>Moduulissa olevan import-lauseen</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">noteCreation</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./../reducers/noteReducer'</span>
</code></pre></div></div>

<p>ansiosta komponentin sisältä on mahdollista viitata funktioon myös suoraan, eli <em>noteCreation</em>. Näin ei kuitenkaan tule tehdä, sillä silloin on kyseessä alkuperäinen action creator joka <em>ei sisällä dispatchausta</em>.</p>

<p>Jos tulostamme funktiot koodin sisällä (emme olekaan vielä käyttäneet kurssilla tätä erittäin hyödyllistä debug-kikkaa)</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">noteCreation</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">noteCreation</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">onSubmit=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">addNote</span><span class="si">}</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name=</span><span class="s2">"note"</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>lisää<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>näemme eron:</p>

<p><img src="http://localhost:4000/assets/6/5d.png" alt="" /></p>

<p>Ensimmäinen funktiosta siis on normaali <em>action creator</em>, toinen taas connectin muotoilema funktio, joka sisältää storen metodin dispatch-kutsun.</p>

<p>Connect on erittäin kätevä työkalu, mutta abstraktiutensa takia kenties käsitteellisesti haastavin kurssin tähänastisista asioista.</p>

<p>Viimeistään nyt kannattaa katsoa kokonaisuudessaan Egghead.io:ta Reduxin kehittäjän Dan Abramovin loistava tuoriaali <a href="https://egghead.io/courses/getting-started-with-redux">Getting started with Redux</a>. Neljässä viimeisessä videossa käsitellään <em>connect</em>-metodia.</p>

<p>Siinä vaiheessa kun videot on tehty, connectin käyttö oli asteen verran nykyistä hankalampaa, sillä esimerkeissä käyttämämme tapa määritellä connectin toinen parametri <em>mapDispatchToProps</em> suoraan <em>action creator</em> -funktioiden avulla ei ollut vielä mahdollinen. Katsotaan seuraavassa luvussa lyhyesti vaihtoehtoista, “hankalampaa” tapaa, sitä näkee usein vanhemmassa React-koodissa, joten sen tunteminen on oleellista.</p>

<h3 id="mapdispatchtopropsin-vaihtoehtoinen-käyttötapa">mapDispatchToPropsin vaihtoehtoinen käyttötapa</h3>

<p>Määrittelimme siis connectin komponentille <em>NoteForm</em> antamat actioneja dispatchaavan funktion seuraavasti:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">NoteForm</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="kc">null</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">noteCreation</span> <span class="p">}</span>
<span class="p">)(</span><span class="nx">NoteForm</span><span class="p">)</span>
</code></pre></div></div>

<p>Eli määrittelyn ansiosta komponentti dispatchaa uuden muistiinpanon lisäyksen suorittavan actionin suoraan komennolla <code>this.props.noteCreation('uusi muistiinpano')</code>.</p>

<p>Parametrin <em>mapDispatchToProps</em> kenttinä ei voi antaa mitä tahansa funktiota, vaan funktion on oltava <em>action creator</em>, eli Redux-actionin palauttava funktio.</p>

<p>Kannattaa huomata, että parametri <em>mapDispatchToProps</em> on nyt <em>olio</em>, sillä määrittely</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nx">noteCreation</span> <span class="p">}</span>
</code></pre></div></div>

<p>on lyhempi tapa määritellä olioliteraali</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nl">noteCreation</span><span class="p">:</span> <span class="nx">noteCreation</span> <span class="p">}</span>
</code></pre></div></div>

<p>eli olio, jonka ainoan kentän <em>noteCreation</em> arvona on funktio <em>noteCreation</em>.</p>

<p>Voimme määritellä saman myös “pitemmän kaavan” kautta, antamalla <em>connectin</em> toisena parametrina seuraavanlaisen <em>funktion</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">NoteForm</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">mapDispatchToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">createTodo</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">dispatch</span><span class="p">(</span><span class="nx">noteCreation</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="kc">null</span><span class="p">,</span>
  <span class="nx">mapDispatchToProps</span>
<span class="p">)(</span><span class="nx">NoteForm</span><span class="p">)</span>
</code></pre></div></div>

<p>Tässä vaihtoehtoisessa tavassa <em>mapDispatchToProps</em> on funktio, jota <em>connect</em> kutsuu antaen sille parametriksi storen <em>dispatch</em>-funktion. Funktion paluuarvona on olio, joka määrittelee joukon funktioita, jotka annetaan connectoitavalle komponentille propsiksi. Esimerkkimme määrittelee propsin <em>createTodo</em> olevan funktion</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">dispatch</span><span class="p">(</span><span class="nx">noteCreation</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<p>eli action creatorilla luodun actionin dispatchaus.</p>

<p>Komponentti siis viittaa funktioon propsin <em>this.props.createTodo</em> kautta:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">NoteForm</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">addNote</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">createTodo</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">form</span> <span class="na">onSubmit=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">addNote</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name=</span><span class="s2">"note"</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>lisää<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Konsepti on hiukan monimutkainen ja sen selittäminen sanallisesti on haastavaa. Kannattaa katsoa huolellisesti Dan Abramovin videot ja koittaa miettiä mistä on kyse.</p>

<p>Useimmissa tapauksissa riittää <em>mapDispatchToProps</em>:in yksinkertaisempi muoto. On kuitenkin tilanteita, joissa monimutkaisempi muoto on tarpeen, esim. jos määriteltäessä propseiksi mäpättyjä <em>dispatchattavia actioneja</em> on <a href="https://github.com/gaearon/redux-devtools/issues/250#issuecomment-186429931">viitattava komponentin omiin propseihin</a>.</p>

<h2 id="presentationalcontainer-revisited">Presentational/Container revisited</h2>

<p>Komponentti <em>NoteList</em> käyttää apumetodia <em>notesToShow</em>, joka päättelee filtterin perusteella näytettävien muistiinpanojen listan:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">notesToShow</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">notes</span><span class="p">,</span> <span class="nx">filter</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span> <span class="o">===</span> <span class="s1">'ALL'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">notes</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">filter</span> <span class="o">===</span> <span class="s1">'IMPORTANT'</span>
    <span class="p">?</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
    <span class="p">:</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Komponentin on tarpeetonta sisältää kaikkea tätä logiikkaa. Eriytetään se komponentin ulkopuolelle <em>connect</em>-metodin parametrin <em>mapStateToProps</em> yhteyteen. Muutetaan komponentti samalla funktionaaliseksi:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">connect</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-redux'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">importanceToggling</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./../reducers/noteReducer'</span>
<span class="k">import</span> <span class="nx">Note</span> <span class="k">from</span> <span class="s1">'./Note'</span>

<span class="kd">const</span> <span class="nx">NoteList</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">visibleNotes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span>
      <span class="p">&lt;</span><span class="nc">Note</span>
        <span class="na">key=</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span>
        <span class="na">note=</span><span class="si">{</span><span class="nx">note</span><span class="si">}</span>
        <span class="na">handleClick=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">importanceToggling</span><span class="p">(</span><span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="si">}</span>
      <span class="p">/&gt;</span>
    <span class="p">)</span><span class="si">}</span>
  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="nx">notesToShow</span> <span class="o">=</span> <span class="p">(</span><span class="nx">notes</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span> <span class="o">===</span> <span class="s1">'ALL'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">notes</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">filter</span> <span class="o">===</span> <span class="s1">'IMPORTANT'</span>
    <span class="p">?</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
    <span class="p">:</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">visibleNotes</span><span class="p">:</span> <span class="nx">notesToShow</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">,</span> <span class="nx">state</span><span class="p">.</span><span class="nx">filter</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="nx">mapStateToProps</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">importanceToggling</span> <span class="p">}</span>
<span class="p">)(</span><span class="nx">NoteList</span><span class="p">)</span>
</code></pre></div></div>

<p><em>mapStateToProps</em> ei siis tällä kertaa mäppää propsiksi suoraan storessa olevaa asiaa, vaan storen tilasta funktion <em>notesToShow</em> avulla muodostetun sopivasti filtteröidyn datan.</p>

<p>Uudistettu <em>NoteList</em> keskittyy lähes ainoastaan muistiinpanojen renderöimiseen, se on hyvin lähellä sitä minkä sanotaan olevan <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">presentational</a>-komponentti, joita Dan Abramovin <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">sanoin</a> kuvailee seuraavasti:</p>

<ul>
  <li>Are concerned with how things look.</li>
  <li>May contain both presentational and container components inside, and usually have some DOM markup and styles of their own.</li>
  <li>Often allow containment via this.props.children.</li>
  <li>Have no dependencies on the rest of the app, such Redux actions or stores.</li>
  <li>Don’t specify how the data is loaded or mutated.</li>
  <li>Receive data and callbacks exclusively via props.</li>
  <li>Rarely have their own state (when they do, it’s UI state rather than data).</li>
  <li>Are written as functional components unless they need state, lifecycle hooks, or performance optimizations.</li>
</ul>

<p>Connect-metodin avulla muodostettu <em>yhdistetty komponentti</em></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">notesToShow</span> <span class="o">=</span> <span class="p">(</span><span class="nx">notes</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span> <span class="o">===</span> <span class="s1">'ALL'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">notes</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">filter</span> <span class="o">===</span> <span class="s1">'IMPORTANT'</span>
    <span class="p">?</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
    <span class="p">:</span> <span class="nx">notes</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="o">!</span><span class="nx">note</span><span class="p">.</span><span class="nx">important</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">mapStateToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">visibleNotes</span><span class="p">:</span> <span class="nx">notesToShow</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">,</span> <span class="nx">state</span><span class="p">.</span><span class="nx">filter</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">connect</span><span class="p">(</span>
  <span class="nx">mapStateToProps</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">importanceToggling</span> <span class="p">}</span>
<span class="p">)(</span><span class="nx">NoteList</span><span class="p">)</span>
</code></pre></div></div>

<p>taas on selkeästi <em>container</em>-komponentti, joita Dan Abramov <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">luonnehtii</a> seuraavasti:</p>

<ul>
  <li>Are concerned with how things work.</li>
  <li>May contain both presentational and container components inside but usually don’t have any DOM markup of their own except for some wrapping divs, and never have any styles.</li>
  <li>Provide the data and behavior to presentational or other container components.</li>
  <li>Call Redux actions and provide these as callbacks to the presentational components.</li>
  <li>Are often stateful, as they tend to serve as data sources.</li>
  <li>Are usually generated using higher order components such as connect from React Redux, rather than written by hand.</li>
</ul>

<p>Komponenttien presentational vs. container -jaottelu on eräs hyväksi havaittu tapa strukturoida React-sovelluksia. Jako voi olla toimiva tai sitten ei, kaikki riippuu kontekstista.</p>

<p>Abramov mainitsee jaon <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">eduiksi</a> muunmuassa seuraavat</p>
<ul>
  <li>Better separation of concerns. You understand your app and your UI better by writing components this way.</li>
  <li>Better reusability. You can use the same presentational component with completely different state sources, and turn those into separate container components that can be further reused.</li>
  <li>Presentational components are essentially your app’s “palette”. You can put them on a single page and let the designer tweak all their variations without touching the app’s logic. You can run screenshot regression tests on that page.</li>
</ul>

<p>Abramov mainitsee termin <a href="https://reactjs.org/docs/higher-order-components.html">high order component</a>. Esim. <em>NoteList</em> on normaali komponentti, React-reduxin <em>connect</em> metodi taas on <em>high order komponentti</em>, eli käytännössä funktio, joka haluaa parametrikseen komponentin muuttuakseen “normaaliksi” komponentiksi.</p>

<p>High order componentit eli HOC:t ovatkin yleinen tapa määritellä geneeristä toiminnallisuutta, joka sitten erikoistetaan esim. renderöitymisen määrittelyn suhteen parametrina annettavan komponentin avulla. Kyseessä on funktionaalisen ohjelmoinnin etäisesti olio-ohjelmoinnin perintää muistuttava käsite.</p>

<p>HOC:it ovat oikeastaan käsitteen <a href="https://en.wikipedia.org/wiki/Higher-order_function">High Order Function</a> (HOF) yleistys. HOF:eja ovat sellaiset funkiot, jotka joko ottavat parametrikseen funktioita tai palauttavat funkioita. Olemme oikeastaan käyttäneet HOF:eja läpi kurssin, esim. lähes kaikki taulukoiden käsittelyyn tarkoitetut metodit, kuten <em>map, filter ja find</em> ovat HOF:eja, samoin jo monta kertaa käyttämämme funktioita palauttavat (eli kahden nuolen) funktiot, esim.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">filterClicked</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">filterChange</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-4">githubissa</a> tagissä <em>part6-4</em>.</p>

<p>Mukana on myös edellisestä unohtunut <em>VisibilityFilter</em>-komponentin <em>connect</em>-funktiota käyttävä versio, jota on myös paranneltu siten, että nappi <em>kaikki</em> on oletusarvoisesti valittuna. Koodissa on pieni ikävä copypaste mutta kelvatkoon.</p>

<h2 id="tehtäviä-1">Tehtäviä</h2>

<p>Tee nyt tehtävät <a href="/tehtävät#connect">6.6-6.9</a></p>

<h2 id="redux-sovelluksen-kommunikointi-palvelimen-kanssa">Redux-sovelluksen kommunikointi palvelimen kanssa</h2>

<p>Laajennetaan sovellusta siten, että muistiinpanot talletetaan backendiin. Käytetään osasta 2 tuttua <a href="/osa2#datan-haku-palvelimelta">json-serveriä</a>.</p>

<p>Tallennetaan projektin juuren tiedostoon <em>db.json</em> tietokannan alkutila:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"notes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="s2">"reduxin storen toiminnan määrittelee reduceri"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"important"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="s2">"storen tilassa voi olla mielivaltaista dataa"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"important"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Asennetaan projektiin json-server</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install json-server <span class="nt">--save</span>
</code></pre></div></div>

<p>ja lisätään tiedoston <em>package.json</em> osaan <em>scripts</em> rivi</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"scripts"</span>: <span class="o">{</span>
  <span class="s2">"server"</span>: <span class="s2">"json-server -p3001 db.json"</span>,
  // ...
<span class="o">}</span>
</code></pre></div></div>

<p>Käynnistetään json-server komennolla <em>npm run server</em>.</p>

<p>Tehdään sitten tuttuun tapaan <em>axiosia</em> hyödyntävä backendistä dataa hakeva metodi tiedostoon <em>services/notes.js</em></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">axios</span> <span class="k">from</span> <span class="s1">'axios'</span>

<span class="kd">const</span> <span class="nx">getAll</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'http://localhost:3001/notes'</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span> <span class="nx">getAll</span> <span class="p">}</span>
</code></pre></div></div>

<p>Muutetaan <em>nodeReducer</em>:issa tapahtuva muistiinpanojen tilan alustusta, siten että oletusarvoisesti mustiinpanoja ei ole:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">noteReducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Nopea tapa saada storagen tila alustettua palvelimella olevan datan perusteella on hakea muistiinpanot tiedostossa <em>index.js</em> ja dispatchata niille yksitellen action <em>NEW_NOTE</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="k">import</span> <span class="nx">noteService</span> <span class="k">from</span> <span class="s1">'./services/notes'</span>

<span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">({</span>
  <span class="na">notes</span><span class="p">:</span> <span class="nx">noteReducer</span><span class="p">,</span>
  <span class="na">filter</span><span class="p">:</span> <span class="nx">filterReducer</span>
<span class="p">})</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span><span class="nx">reducer</span><span class="p">)</span>

<span class="nx">noteService</span><span class="p">.</span><span class="nx">getAll</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">notes</span> <span class="o">=&gt;</span>
  <span class="nx">notes</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="s1">'NEW_NOTE'</span><span class="p">,</span> <span class="na">data</span><span class="p">:</span> <span class="nx">note</span><span class="p">})</span>
  <span class="p">})</span>
<span class="p">)</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<p>Lisätään reduceriin tuki actionille <em>INIT_NOTES</em>, jonka avulla alustus voidaan tehdä dispatchaamalla yksittäinen action. Luodaan myös sitä varten oma action creator -funktio <em>noteInitialization</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">const</span> <span class="nx">noteReducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'ACTION:'</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span>
  <span class="k">switch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'NEW_NOTE'</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">[...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">.</span><span class="nx">data</span><span class="p">]</span>
    <span class="k">case</span> <span class="s1">'INIT_NOTES'</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">action</span><span class="p">.</span><span class="nx">data</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">noteInitialization</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'INIT_NOTES'</span><span class="p">,</span>
    <span class="nx">data</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<p><em>index.js</em> yksinkertaistuu:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">noteReducer</span><span class="p">,</span> <span class="p">{</span> <span class="nx">noteInitialization</span><span class="p">}</span> <span class="k">from</span> <span class="s1">'./reducers/noteReducer'</span>
<span class="c1">// ...</span>

<span class="nx">noteService</span><span class="p">.</span><span class="nx">getAll</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">notes</span> <span class="o">=&gt;</span>
  <span class="nx">store</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">noteInitialization</span><span class="p">(</span><span class="nx">notes</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p><strong>HUOM:</strong> miksi emme käyttäneet koodissa promisejen ja <em>then</em>-metodilla rekisteröidyn tapahtumankäsittelijän sijaan awaitia?</p>

  <p>await toimii ainoastaan <em>async</em>-funktioiden sisällä, ja <em>index.js</em>:ssä oleva koodi ei ole funktiossa, joten päädyimme tilanteen yksinkertaisuuden takia tällä kertaa jättämään <em>async</em>:in käyttämättä.</p>
</blockquote>

<p>Päätetään kuitenkin siirtää muistiinpanojen alustus <em>App</em>-komponentin metodiin <em><a href="https://reactjs.org/docs/react-component.html#componentdidmount">componentDidMount</a></em>, se on luonteva paikka alustuksille, sillä metodi suoritetaan ennen kuin sovelluksemme renderöidään ensimmäistä kertaa.</p>

<p>Jotta saamme action creatorin <em>noteInitialization</em> käyttöön komponentissa <em>App</em> tarvitsemme jälleen <em>connect</em>-metodin apua:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="nx">NoteForm</span> <span class="k">from</span> <span class="s1">'./components/NoteForm.js'</span>
<span class="k">import</span> <span class="nx">NoteList</span> <span class="k">from</span> <span class="s1">'./components/NoteList.js'</span>
<span class="k">import</span> <span class="nx">VisibilityFilter</span> <span class="k">from</span> <span class="s1">'./components/VisibilityFilter'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">connect</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-redux'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">noteInitialization</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./reducers/noteReducer'</span>
<span class="k">import</span> <span class="nx">noteService</span> <span class="k">from</span> <span class="s1">'./services/notes'</span>

<span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidMount</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">notes</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">noteService</span><span class="p">.</span><span class="nx">getAll</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">noteInitialization</span><span class="p">(</span><span class="nx">notes</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">NoteForm</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">VisibilityFilter</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">NoteList</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="kc">null</span><span class="p">,</span>
  <span class="p">{</span> <span class="nx">noteInitialization</span> <span class="p">}</span>
<span class="p">)(</span><span class="nx">App</span><span class="p">)</span>
</code></pre></div></div>

<p>Näin funktio <em>noteInitialization</em> tulee komponentin <em>App</em> propsiksi <em>this.props.noteInitialization</em> ja sen kutsumiseen ei tarvita <em>dispatch</em>-metodia koska <em>connect</em> hoitaa asian puolestamme.</p>

<p>Pääsimme nyt myös käyttämään aina mukavaa async/awaitia. Palvelimen kanssa kommunikointi tapahtuu joka tapauksessa funktiossa, joten sen määrittely asyncina on vaivatonta:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">componentDidMount</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">notes</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">noteService</span><span class="p">.</span><span class="nx">getAll</span><span class="p">()</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">noteInitialization</span><span class="p">(</span><span class="nx">notes</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Voimme toimia samoin myös uuden muistiinpanon luomisen suhteen. Laajennetaan palvelimen kanssa kommunikoivaa koodia:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">'http://localhost:3001/notes'</span>

<span class="kd">const</span> <span class="nx">getAll</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">createNew</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span> <span class="nx">content</span><span class="p">,</span> <span class="na">important</span><span class="p">:</span> <span class="kc">false</span><span class="p">})</span>
  <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">getAll</span><span class="p">,</span> <span class="nx">createNew</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Komponentin <em>NoteForm</em> metodi <em>addNote</em> muuttuu hiukan:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">noteCreation</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'./../reducers/noteReducer'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">connect</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-redux'</span>
<span class="k">import</span> <span class="nx">noteService</span> <span class="k">from</span> <span class="s1">'../services/notes'</span>

<span class="kd">class</span> <span class="nx">NoteForm</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">addNote</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="kd">const</span> <span class="nx">newNote</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">noteService</span><span class="p">.</span><span class="nx">createNew</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">noteCreation</span><span class="p">(</span><span class="nx">newNote</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//...</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="kc">null</span><span class="p">,</span>
  <span class="p">{</span><span class="nx">noteCreation</span><span class="p">}</span>
<span class="p">)(</span><span class="nx">NoteForm</span><span class="p">)</span>
</code></pre></div></div>

<p>Koska backend generoi muistiinpanoille id:t, muutetaan action creator <em>noteCreation</em> muotoon</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">noteCreation</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'NEW_NOTE'</span><span class="p">,</span>
    <span class="nx">data</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Muistiinpanojen tärkeyden muuttaminen olisi mahdollista toteuttaa samalla periaatteella, eli tehdä palvelimelle ensin asynkroninen metodikutsu ja sen jälkeen dispatchata sopiva action.</p>

<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-5">githubissa</a> tagissä <em>part6-5</em>.</p>

<h2 id="tehtäviä-2">Tehtäviä</h2>

<p>Tee nyt tehtävät <a href="/tehtävät#redux-ja-backend">6.10-6.12</a></p>

<h3 id="asynkroniset-actionit-ja-redux-thunk">Asynkroniset actionit ja redux thunk</h3>

<p>Lähestymistapamme on ok, mutta siinä mielessä ikävä, että palvelimen kanssa kommunikointi tapahtuu komponenttien metodeissa. Olisi parempi, jos kommunikointi voitaisiin abstrahoida komponenteilta siten, että niiden ei tarvitsisi kuin kutsua sopivaa <em>action creatoria</em>, esim. <em>App</em> alustaisi sovelluksen tilan seuraavasti:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initializeNotes</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ja <em>NoteForm</em> loisi uuden muistiinpanon seuraavasti:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">NoteForm</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">addNote</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">createNote</span><span class="p">(</span><span class="nx">newNote</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Molemmat komponentit käyttäisivät ainoastaan propsina saamaansa funktiota, välittämättä siitä että taustalla tapahtuu todellisuudessa palvelimen kanssa tapahtuvaa kommunikoinia.</p>

<p>Asennetaan nyt <a href="https://github.com/gaearon/redux-thunk">redux-thunk</a>-kirjasto, joka mahdollistaa <em>asynkronisten actionien</em> luomisen. Asennus tapahtuu komennolla:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install <span class="nt">--save</span> redux-thunk
</code></pre></div></div>

<p>redux-thunk-kirjasto on ns. <em>redux-middleware</em> joka täytyy ottaa käyttöön storen alustuksen yhteydessä. Eriytetään samalla storen määrittely omaan tiedostoon <em>store.js</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">combineReducers</span><span class="p">,</span> <span class="nx">applyMiddleware</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'redux'</span>
<span class="k">import</span> <span class="nx">thunk</span> <span class="k">from</span> <span class="s1">'redux-thunk'</span>

<span class="k">import</span> <span class="nx">noteReducer</span> <span class="k">from</span> <span class="s1">'./reducers/noteReducer'</span>
<span class="k">import</span> <span class="nx">filterReducer</span> <span class="k">from</span> <span class="s1">'./reducers/filterReducer'</span>

<span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">({</span>
  <span class="na">notes</span><span class="p">:</span> <span class="nx">noteReducer</span><span class="p">,</span>
  <span class="na">filter</span><span class="p">:</span> <span class="nx">filterReducer</span>
<span class="p">})</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span>
  <span class="nx">reducer</span><span class="p">,</span>
  <span class="nx">applyMiddleware</span><span class="p">(</span><span class="nx">thunk</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">store</span>
</code></pre></div></div>

<p>Tiedosto <em>src/index.js</em> on muutoksen jälkeen seuraava</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="nx">ReactDOM</span> <span class="k">from</span> <span class="s1">'react-dom'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Provider</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-redux'</span>
<span class="k">import</span> <span class="nx">App</span> <span class="k">from</span> <span class="s1">'./App'</span>
<span class="k">import</span> <span class="nx">store</span> <span class="k">from</span> <span class="s1">'./store'</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="p">&lt;</span><span class="nc">Provider</span> <span class="na">store=</span><span class="si">{</span><span class="nx">store</span><span class="si">}</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nc">App</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nc">Provider</span><span class="p">&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>redux-thunkin ansiosta on mahdollista määritellä <em>action creatoreja</em> siten, että ne palauttavat funktion, jonka parametrina on redux-storen <em>dispatch</em>-metodi. Tämän ansiosta on mahdollista tehdä asynkronisia action creatoreja, jotka ensin odottavat jonkin toimenpiteen valmistumista ja vasta sen jälkeen dispatchaavat varsinaisen actionin.</p>

<p>Voimme nyt määritellä muistiinpanojen alkutilan palvelimelta hakevan action creatorin <em>initializeNotes</em> seuraavasti:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">initializeNotes</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">async</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">notes</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">noteService</span><span class="p">.</span><span class="nx">getAll</span><span class="p">()</span>
    <span class="nx">dispatch</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'INIT_NOTES'</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">notes</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Sisemmässä funktiossaan, eli <em>asynkroonisessa actionissa</em> operaatio hakee ensin palvelimelta kaikki muistiinpanot ja sen jälkeen <em>dispatchaa</em> muistiinpanot storeen lisäävän actionin.</p>

<p>Komponentti <em>App</em> voidaan nyt määritellä seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidMount</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">initializeNotes</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">NoteForm</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">NoteList</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">VisibilityFilter</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="kc">null</span><span class="p">,</span> <span class="p">{</span> <span class="nx">initializeNotes</span> <span class="p">}</span>
<span class="p">)(</span><span class="nx">App</span><span class="p">)</span>
</code></pre></div></div>

<p>Ratkaisu on elegantti, muistiinpanojen alustuslogiikka on eriytetty kokonaan React-komponenttien ulkopuolelle.</p>

<p>Uuden muistiinpanon lisäävä action creator <em>createNew</em> on seuraavassa</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">createNew</span> <span class="o">=</span> <span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">async</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">newNote</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">noteService</span><span class="p">.</span><span class="nx">createNew</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
    <span class="nx">dispatch</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'NEW_NOTE'</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">newNote</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Periaate on jälleen sama, ensin suoritetaan asynkroninen operaatio, ja sen valmistuttua <em>dispatchataan</em> storen tilaa muuttava action.</p>

<p>Lomake muuttuu seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">NoteForm</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">addNote</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">note</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">createNew</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">form</span> <span class="na">onSubmit=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">addNote</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name=</span><span class="s1">'note'</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>lisää<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">connect</span><span class="p">(</span>
  <span class="kc">null</span><span class="p">,</span> <span class="p">{</span> <span class="nx">createNew</span> <span class="p">}</span>
<span class="p">)(</span><span class="nx">NoteForm</span><span class="p">)</span>
</code></pre></div></div>

<p>Sovelluksen tämänhetkinen koodi on <a href="https://github.com/FullStack-HY/redux-notes/tree/part6-6">githubissa</a> tagissä <em>part6-6</em>.</p>

<h3 id="redux-devtools">Redux DevTools</h3>

<p>Chromeen on asennettavissa <a href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd">Redux DevTools</a>, jonka avulla Redux-storen tilaa ja sitä muuttavia actioneja on mahdollisuus seurata selaimen konsolista.</p>

<p>Selaimen lisäosan lisäksi debugatessa tarvitaan kirjastoa <a href="https://www.npmjs.com/package/redux-devtools-extension">redux-devtools-extension</a>. Asennetaan se komennolla</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">save</span> <span class="nx">redux</span><span class="o">-</span><span class="nx">devtools</span><span class="o">-</span><span class="nx">extension</span>
</code></pre></div></div>

<p>Storen luomistapaa täytyy hieman muuttaa, että kirjasto saadaan käyttöön:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">createStore</span><span class="p">,</span> <span class="nx">combineReducers</span><span class="p">,</span> <span class="nx">applyMiddleware</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'redux'</span>
<span class="k">import</span> <span class="nx">thunk</span> <span class="k">from</span> <span class="s1">'redux-thunk'</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">composeWithDevTools</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'redux-devtools-extension'</span>

<span class="k">import</span> <span class="nx">noteReducer</span> <span class="k">from</span> <span class="s1">'./reducers/noteReducer'</span>
<span class="k">import</span> <span class="nx">filterReducer</span> <span class="k">from</span> <span class="s1">'./reducers/filterReducer'</span>

<span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="nx">combineReducers</span><span class="p">({</span>
  <span class="na">notes</span><span class="p">:</span> <span class="nx">noteReducer</span><span class="p">,</span>
  <span class="na">filter</span><span class="p">:</span> <span class="nx">filterReducer</span>
<span class="p">})</span>

<span class="kd">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">createStore</span><span class="p">(</span>
  <span class="nx">reducer</span><span class="p">,</span>
  <span class="nx">composeWithDevTools</span><span class="p">(</span>
    <span class="nx">applyMiddleware</span><span class="p">(</span><span class="nx">thunk</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">store</span>
</code></pre></div></div>

<p>Kun nyt avaat konsolin, välilehti <em>redux</em> näyttää seuraavalta:</p>

<p><img src="http://localhost:4000/assets/6/5e.png" alt="" /></p>

<p>Konsolin avulla on myös mahdollista dispatchata actioneja storeen</p>

<p><img src="http://localhost:4000/assets/6/5f.png" alt="" /></p>

<p>Storen tietyn hetkisen tilan lisäksi on myös mahdollista tarkastella, mikä on kunkin actionin tilalle aiheuttama muutos:</p>

<p><img src="http://localhost:4000/assets/6/5g.png" alt="" /></p>

<h2 id="tehtäviä-3">tehtäviä</h2>

<p>Tee nyt tehtävät <a href="/tehtävät#thunk">6.13-6.15</a></p>

<h2 id="react-router">React router</h2>

<p>Palataan jälleen Reduxittoman Reactin pariin.</p>

<p>On erittäin tyypillistä, että web-sovelluksissa on navigaatiopalkki, jonka avulla on mahdollista vaihtaa sovelluksen näkymää. Muistiinpanosovelluksemme voisi sisältää pääsivun:</p>

<p><img src="http://localhost:4000/assets/6/6.png" alt="" /></p>

<p>ja omat sivunsa muistiinpanojen ja käyttäjien tietojen näyttämiseen:</p>

<p><img src="http://localhost:4000/assets/6/7.png" alt="" /></p>

<p><a href="/osa0#perinteinen-web-sovellus">Vanhan koulukunnan websovelluksessa</a> sovelluksen näyttämän sivun vaihto tapahtui siten että selain teki palvelimelle uuden HTTP GET -pyynnön ja renderöi sitten palvelimen palauttaman näkymää vastaavan HTML-koodin.</p>

<p>Single page appeissa taas ollaan todellisuudessa koko ajan samalla sivulla, ja selaimessa suoritettava Javascript-koodi luo illuusion eri “sivuista”. Jos näkymää vaihdettaessa tehdään HTTP-kutsuja, niiden avulla haetaan ainoastaan JSON-muotoista dataa jota uuden näkymän näyttäminen ehkä edellyttää.</p>

<p>Navigaatiopalkki ja useita näkymiä sisältävä sovellus on erittäin helppo toteuttaa Reactilla.</p>

<p>Seuraavassa on eräs tapa:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Home</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>TKTL notes app<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="nx">Notes</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Notes<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="nx">Users</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Users<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>

<span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">page</span><span class="p">:</span> <span class="s1">'home'</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">toPage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">page</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">page</span> <span class="o">===</span> <span class="s1">'home'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">&lt;</span><span class="nc">Home</span> <span class="p">/&gt;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">page</span> <span class="o">===</span> <span class="s1">'notes'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">&lt;</span><span class="nc">Notes</span> <span class="p">/&gt;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">page</span> <span class="o">===</span> <span class="s1">'users'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">&lt;</span><span class="nc">Users</span> <span class="p">/&gt;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href=</span><span class="s2">""</span> <span class="na">onClick=</span><span class="si">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">toPage</span><span class="p">(</span><span class="s1">'home'</span><span class="p">)</span> <span class="si">}</span><span class="p">&gt;</span>home<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="ni">&amp;nbsp;</span>
          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href=</span><span class="s2">""</span> <span class="na">onClick=</span><span class="si">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">toPage</span><span class="p">(</span><span class="s1">'notes'</span><span class="p">)</span> <span class="si">}</span><span class="p">&gt;</span>notes<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> <span class="ni">&amp;nbsp;</span>
          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href=</span><span class="s2">""</span> <span class="na">onClick=</span><span class="si">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">toPage</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span> <span class="si">}</span><span class="p">&gt;</span>users<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="si">{</span><span class="nx">content</span><span class="p">()</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Eli jokainen näkymä on toteutettu omana komponenttinaan ja sovelluksen tilassa pidetään tieto siitä, minkä näkymää vastaava komponentti menupalkin alla näytetään.</p>

<p><strong>Huom:</strong> navigointivalikossa oleva <em>&amp;nbsp;</em> tarkoittaa <em>a</em>-tagien väliin sjijoitettavaa välilyöntiä. CSS:n käyttö olisi luonnollisesti parempi tapa sivun ulkoasun muotoilulle mutta nyt tyydymme quick’n’dirty-ratkaisuun.</p>

<p>Menetelmä ei kuitenkaan ole optimaalinen. Kuten kuvista näkyy, sivuston osoite pysyy samana vaikka välillä ollaankin eri näkymässä. Jokaisella näkymällä tulisi kuitenkin olla oma osoitteensa, jotta esim. bookmarkien tekeminen olisi mahdollista. Sovelluksessamme ei myöskään selaimen <em>back</em>-painike toimi loogisesti, eli <em>back</em> ei vie edelliseksi katsottuun sovelluksen näkymään vaan jonnekin ihan muualle. Jos sovellus kasvaisi suuremmaksi ja sinne haluttaisiin esim. jokaiselle käyttäjälle sekä muistiinpanolle oma yksittäinen näkymänsä, itse koodattu <em>reititys</em> eli sivuston navigaationhallinta menisi turhan monimutkaiseksi.</p>

<p>Reactissa on onneksi valmis komponentti <a href="https://github.com/ReactTraining/react-router">React router</a> joka tarjoaa erinomaisen ratkaisun React-sovelluksen navigaation hallintaan.</p>

<p>Muutetaan ylläoleva sovellus käyttämään React routeria. Asennetaan React router komennolla</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install <span class="nt">--save</span> react-router-dom
</code></pre></div></div>

<p>React routerin tarjoama reititys saadaan käyttöön muuttamalla sovellusta seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">BrowserRouter</span> <span class="k">as</span> <span class="nx">Router</span><span class="p">,</span> <span class="nx">Route</span><span class="p">,</span> <span class="nx">Link</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-router-dom'</span>

<span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">Router</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">to=</span><span class="s2">"/"</span><span class="p">&gt;</span>home<span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span> <span class="ni">&amp;nbsp;</span>
              <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">to=</span><span class="s2">"/notes"</span><span class="p">&gt;</span>notes<span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span> <span class="ni">&amp;nbsp;</span>
              <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">to=</span><span class="s2">"/users"</span><span class="p">&gt;</span>users<span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">Route</span> <span class="nt">exact</span> <span class="na">path=</span><span class="s2">"/"</span> <span class="na">render=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nc">Home</span> <span class="p">/&gt;</span><span class="si">}</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nc">Route</span> <span class="na">path=</span><span class="s2">"/notes"</span> <span class="na">render=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nc">Notes</span> <span class="p">/&gt;</span><span class="si">}</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nc">Route</span> <span class="na">path=</span><span class="s2">"/users"</span> <span class="na">render=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nc">Users</span> <span class="p">/&gt;</span><span class="si">}</span> <span class="p">/&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nc">Router</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Reititys, eli komponenttien ehdollinen, selaimen <em>urliin perustuva</em> renderöinti otetaan käyttöön sijoittamalla komponentteja <em>Router</em>-komponentin lapsiksi, eli <em>Router</em>-tagien sisälle.</p>

<p>Huomaa, että vaikka komponenttiin viitataan nimellä <em>Router</em> kyseessä on <a href="https://reacttraining.com/react-router/web/api/BrowserRouter">BrowserRouter</a>, sillä
importtaus tapahtuu siten, että importattava olio uudelleennimetään:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">BrowserRouter</span> <span class="k">as</span> <span class="nx">Router</span> <span class="p">...</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-router-dom'</span>
</code></pre></div></div>

<p>Manuaalin mukaan</p>

<blockquote>
  <p><em>BrowserRouter</em> is a <em>Router</em> that uses the HTML5 history API (pushState, replaceState and the popstate event) to keep your UI in sync with the URL.</p>
</blockquote>

<p>Normaalisti selain lataa uuden sivun osoiterivillä olevan urlin muuttuessa. <a href="https://css-tricks.com/using-the-html5-history-api/">HTML5 history API</a>:n avulla <em>BrowserRouter</em> kuitenkin mahdollistaa sen, että selaimen osoiterivillä olevaa urlia voidaan käyttää React-sovelluksen sisäiseen “reitittämiseen”, eli vaikka osoiterivillä oleva url muuttuu, sivun sisältöä manipuloidaan ainoastaan Javascriptillä ja selain ei lataa uutta sisältöä palvelimelta. Selaimen toiminta back- ja forward-toimintojen ja bookmarkien tekemisen suhteen on kuitenkin loogista, eli toimii kuten perinteisillä web-sivuilla.</p>

<p>Routerin sisälle määritellään selaimen osoiteriviä muokkaavia <em>linkkejä</em> komponentin <a href="https://reacttraining.com/react-router/web/api/Link">Link</a> avulla. Esim.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/notes"</span><span class="o">&gt;</span>notes&lt;/Link&gt;
</code></pre></div></div>

<p>luo sovellukseen linkin, jonka teksti on <em>notes</em> ja jonka klikkaaminen vaihtaa selaimen osoiteriville urliksi <em>/notes</em>.</p>

<p>Selaimen urliin perustuen renderöitävät komponentit määritellään komponentin <a href="https://reacttraining.com/react-router/web/api/Route">Route</a> avulla. Esim.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Route <span class="nv">path</span><span class="o">=</span><span class="s2">"/notes"</span> <span class="nv">render</span><span class="o">={()</span> <span class="o">=&gt;</span> &lt;Notes /&gt;<span class="o">}</span> /&gt;
</code></pre></div></div>

<p>määrittelee, että jos selaimen osoiteena on <em>/notes</em>, renderöidään komponentti <em>Notes</em>.</p>

<p>Sovelluksen juuren, eli osoitteen <em>/</em> määritellään renderöivän komponentti <em>Home</em>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Route exact <span class="nv">path</span><span class="o">=</span><span class="s2">"/"</span> <span class="nv">render</span><span class="o">={()</span> <span class="o">=&gt;</span> &lt;Home /&gt;<span class="o">}</span> /&gt;
</code></pre></div></div>

<p>joudumme käyttämään routen <em>path</em> attribuutin edessä määrettä <em>exact</em>, muuten <em>Home</em> renderöityy kaikilla muillakin poluilla, sillä juuri <em>/</em> on kaikkien muiden polkujen <em>alkuosa</em>.</p>

<h3 id="parametroitu-route">parametroitu route</h3>

<p>Tarkastellaan sitten hieman modifioitua versiota edellisestä esimerkistä. Esimerkin koodi kokonaisuudessaan on <a href="https://github.com/FullStack-HY/FullStack-Hy.github.io/wiki/router-esimerkki">täällä</a>.</p>

<p>Sovellus sisältää nyt viisi eri näkymää, joiden näkyvyyttä kontrolloidaan routerin avulla. Edellisestä esimerkistä tuttujen komponenttien <em>Home</em>, <em>Notes</em> ja <em>Users</em> lisäksi mukana on kirjautumisnäkymää vastaava <em>Login</em> ja yksittäisen muistiinpanon näkymää vastaava <em>Note</em>.</p>

<p><em>Home</em> ja <em>Users</em> ovat kuten aiemmassa esimerkissä. <em>Notes</em> on hieman monimutkaisempi, se renderöi propseina saamansa muistiinpanojen listan siten, että jokaisen muistiinpanon nimi on klikattavissa</p>

<p><img src="http://localhost:4000/assets/6/8.png" alt="" /></p>

<p>Nimen klikattavuus on toteutettu komponentilla <em>Link</em> ja esim. muistiinpanon, jonka id on 3 nimen klikkaaminen aiheuttaa selaimen osoitteen arvon päivittymisen muotoon <em>notes/3</em>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Notes</span> <span class="o">=</span> <span class="p">({</span><span class="nx">notes</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Notes<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">notes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">note</span><span class="o">=&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key=</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">to=</span><span class="si">{</span><span class="s2">`/notes/${note.id}`</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">content</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">)</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Kun selain siirtyy muistiinpanon yksilöivään osoitteeseen, esim. <em>notes/3</em>, renderöidään komponentti <em>Note</em>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Note</span> <span class="o">=</span> <span class="p">({</span><span class="nx">note</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span><span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">content</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">user</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">important</span> <span class="p">?</span> <span class="s1">'tärkeä'</span> <span class="p">:</span> <span class="s1">''</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)}</span>
</code></pre></div></div>

<p>Tämä tapahtuu laajentamalla komponentissa <em>App</em> olevaa reititystä seuraavasti:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div&gt;
  &lt;Router&gt;
    &lt;div&gt;
      &lt;div&gt;
        &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/"</span><span class="o">&gt;</span>home&lt;/Link&gt; &amp;nbsp<span class="p">;</span>
        &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/notes"</span><span class="o">&gt;</span>notes&lt;/Link&gt; &amp;nbsp<span class="p">;</span>
        &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/users"</span><span class="o">&gt;</span>users&lt;/Link&gt; &amp;nbsp<span class="p">;</span>
      &lt;/div&gt;

      &lt;Route exact <span class="nv">path</span><span class="o">=</span><span class="s2">"/"</span> <span class="nv">render</span><span class="o">={()</span> <span class="o">=&gt;</span> &lt;Home /&gt;<span class="o">}</span> /&gt;
      &lt;Route exact <span class="nv">path</span><span class="o">=</span><span class="s2">"/notes"</span> <span class="nv">render</span><span class="o">={()</span> <span class="o">=&gt;</span>
        &lt;Notes <span class="nv">notes</span><span class="o">={</span>this.state.notes<span class="o">}</span> /&gt;<span class="o">}</span>
      /&gt;
      &lt;Route exact <span class="nv">path</span><span class="o">=</span><span class="s2">"/notes/:id"</span> <span class="nv">render</span><span class="o">={({</span>match<span class="o">})</span> <span class="o">=&gt;</span>
        &lt;Note <span class="nv">note</span><span class="o">={</span>noteById<span class="o">(</span>match.params.id<span class="o">)}</span> /&gt;<span class="o">}</span>
      /&gt;
    &lt;/div&gt;
  &lt;/Router&gt;
&lt;/div&gt;
</code></pre></div></div>

<p>Kaikki muistiinpanon renderöivään routeen on lisätty määre <em>exact path=”/notes”</em> sillä muuten se renderöityisi myös <em>/notes/3</em>-muotoisten polkujen yhteydessä.</p>

<p>Yksittäisen muistiinpanon näkymän renderöivä route määritellään “expressin tyyliin” merkkaamalla reitin parametrina oleva osa merkinnällä <em>:id</em></p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s2">"/notes/:id"</span> <span class="o">/&gt;</span>
</code></pre></div></div>

<p>Renderöityvän komponentin määrittävä <em>render</em>-attribuutti pääsee käsiksi id:hen parametrinsa <a href="https://reacttraining.com/react-router/web/api/match">match</a> avulla seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">render</span><span class="o">=</span><span class="p">{({</span><span class="nx">match</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nc">Note</span> <span class="na">note=</span><span class="si">{</span><span class="nx">noteById</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="si">}</span> <span class="p">/&gt;}</span>
</code></pre></div></div>

<p>Muuttujassa <em>match.params.id</em> olevaa id:tä vastaava muistiinpano selvitetään apufunktion <em>noteById</em> avulla</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">noteById</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span>
</code></pre></div></div>

<p>renderöityvä <em>Note</em>-komponentti saa siis propsina urlin yksilöivää osaa vastaavan muistiinpanon.</p>

<h3 id="history">history</h3>

<p>Sovellukseen on myös toteutettu erittäin yksinkertainen kirjautumistoiminto. Jos sovellukseen ollaan kirjautuneena, talletetaan tieto kirjautuneesta käyttäjästä komponentin <em>App</em> tilaan <em>this.state.user</em>.</p>

<p>Mahdollisuus <em>Login</em>-näkymään navigointiin renderöidään menuun ehdollisesti</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Router&gt;
  &lt;div&gt;
    &lt;div&gt;
      &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/"</span><span class="o">&gt;</span>home&lt;/Link&gt; &amp;nbsp<span class="p">;</span>
      &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/notes"</span><span class="o">&gt;</span>notes&lt;/Link&gt; &amp;nbsp<span class="p">;</span>
      &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/users"</span><span class="o">&gt;</span>users&lt;/Link&gt; &amp;nbsp<span class="p">;</span>
      <span class="o">{</span>this.state.user
        ? &lt;em&gt;<span class="o">{</span>this.state.user<span class="o">}</span> logged <span class="k">in</span>&lt;/em&gt;
        : &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/login"</span><span class="o">&gt;</span>login&lt;/Link&gt;
      <span class="o">}</span>
    &lt;/div&gt;
  ...
  &lt;/div&gt;
&lt;/Router&gt;
</code></pre></div></div>

<p>eli jos käyttäjä on kirjaantunut, renderöidäänkin linkin <em>Login</em> sijaan kirjautuneen käyttäjän käyttäjätunnus:</p>

<p><img src="http://localhost:4000/assets/6/9.png" alt="" /></p>

<p>Kirjautumisen toteuttamiseen liittyy eräs mielenkiintoinen seikka. Kirjaantumislomakkeelle mennään selaimen osoitteen ollessa <em>/login</em>. Toiminnallisuuden määrittelevä Route on seuraavassa</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Route <span class="nv">path</span><span class="o">=</span><span class="s2">"/login"</span> <span class="nv">render</span><span class="o">={({</span><span class="nb">history</span><span class="o">})</span> <span class="o">=&gt;</span>
  &lt;Login <span class="nb">history</span><span class="o">={</span><span class="nb">history</span><span class="o">}</span> <span class="nv">onLogin</span><span class="o">={</span>this.login<span class="o">}</span> /&gt;<span class="o">}</span>
/&gt;
</code></pre></div></div>

<p>Routen render-attribuutissa määritelty metodi ottaa nyt vastaan olion <a href="https://reacttraining.com/react-router/web/api/history">history</a>, joka tarjoaa mm. mahdollisuuden manipuloida selaimen osoiterivin arvoa ohjelmallisesti.</p>

<p>Renderöitävälle <em>Login</em>-näkymälle annetaan parametriksi <em>history</em>-olio ja kirjautumisen komponentin <em>App</em> tilaan synkronoiva funktio <em>this.login</em>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Login <span class="nb">history</span><span class="o">={</span><span class="nb">history</span><span class="o">}</span> <span class="nv">onLogin</span><span class="o">={</span>this.login<span class="o">}</span>/&gt;<span class="o">}</span>
</code></pre></div></div>

<p>Komponentin koodi seuraavassa</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Login</span> <span class="o">=</span> <span class="p">({</span><span class="nx">onLogin</span><span class="p">,</span> <span class="nx">history</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">onSubmit</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    <span class="nx">onLogin</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">username</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
    <span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>login<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">form</span> <span class="na">onSubmit=</span><span class="si">{</span><span class="nx">onSubmit</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          username: <span class="p">&lt;</span><span class="nt">input</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          password: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type=</span><span class="s2">"password"</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type=</span><span class="s2">"submit"</span><span class="p">&gt;</span>login<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Kirjautumisen yhteydessä funktiossa <em>onSubmit</em> kutsutaan <a href="https://reacttraining.com/react-router/web/api/history">history</a>-olion metodia <em>push</em>. Käytetty komento <code>history.push('/')</code> saa aikaan sen, että selaimen osoiteriville tulee osoitteeksi <em>/</em> ja sovellus renderöi osoitetta vastaavan komponentin <em>Home</em>.</p>

<h3 id="redirect">redirect</h3>

<p>Näkymän <em>Users</em> routeen liittyy vielä eräs mielenkiintoinen detalji:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Route <span class="nv">path</span><span class="o">=</span><span class="s2">"/users"</span> <span class="nv">render</span><span class="o">={()</span> <span class="o">=&gt;</span>
  this.state.user
    ? &lt;Users /&gt;
    : &lt;Redirect <span class="nv">to</span><span class="o">=</span><span class="s2">"/login"</span> /&gt;
  <span class="o">}</span>/&gt;
</code></pre></div></div>

<p>Jos käyttäjä ei ole kirjautuneena, ei renderöidäkään näkymää <em>Users</em> vaan sen sijaan <em>uudelleenohjataan</em> käyttäjä <em>Redirect</em>-komponentin avulla kirjautumisnäkymään</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">Redirect</span> <span class="nx">to</span><span class="o">=</span><span class="s2">"/login"</span> <span class="o">/&gt;</span>
</code></pre></div></div>

<p>Todellisessa sovelluksessa olisi kenties parempi olla kokonaan näyttämättä navigaatiovalikossa kirjautumista edellyttäviä näkymiä jos käyttäjä ei ole kirjautunut sovellukseen.</p>

<p>Seuraavassa vielä komponentin <em>App</em> koodi kokonaisuudessaan:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">notes</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="na">content</span><span class="p">:</span> <span class="s1">'HTML on helppoa'</span><span class="p">,</span>
          <span class="na">important</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">user</span><span class="p">:</span> <span class="s1">'Matti Luukkainen'</span>
        <span class="p">},</span>
        <span class="c1">// ...</span>
      <span class="p">],</span>
      <span class="na">user</span><span class="p">:</span> <span class="kc">null</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">login</span> <span class="o">=</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">user</span><span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">noteById</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span> <span class="nx">note</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">Router</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">to=</span><span class="s2">"/"</span><span class="p">&gt;</span>home<span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span> <span class="ni">&amp;nbsp;</span>
              <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">to=</span><span class="s2">"/notes"</span><span class="p">&gt;</span>notes<span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span> <span class="ni">&amp;nbsp;</span>
              <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">to=</span><span class="s2">"/users"</span><span class="p">&gt;</span>users<span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span> <span class="ni">&amp;nbsp;</span>
              <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span>
                <span class="p">?</span> <span class="p">&lt;</span><span class="nt">em</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="si">}</span> logged in<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span>
                <span class="p">:</span> <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">to=</span><span class="s2">"/login"</span><span class="p">&gt;</span>login<span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span>
              <span class="si">}</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nc">Route</span> <span class="nt">exact</span> <span class="na">path=</span><span class="s2">"/"</span> <span class="na">render=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nc">Home</span> <span class="p">/&gt;</span><span class="si">}</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nc">Route</span> <span class="nt">exact</span> <span class="na">path=</span><span class="s2">"/notes"</span> <span class="na">render=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nc">Notes</span> <span class="na">notes=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">notes</span><span class="si">}</span><span class="p">/&gt;</span><span class="si">}</span> <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nc">Route</span> <span class="nt">exact</span> <span class="na">path=</span><span class="s2">"/notes/:id"</span> <span class="na">render=</span><span class="si">{</span><span class="p">({</span><span class="nx">match</span><span class="p">})</span> <span class="o">=&gt;</span>
              <span class="p">&lt;</span><span class="nc">Note</span> <span class="na">note=</span><span class="si">{</span><span class="nx">noteById</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span><span class="si">}</span> <span class="p">/&gt;</span><span class="si">}</span>
            <span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nc">Route</span> <span class="na">path=</span><span class="s2">"/users"</span> <span class="na">render=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span>
                <span class="p">?</span> <span class="p">&lt;</span><span class="nc">Users</span> <span class="p">/&gt;</span>
                <span class="p">:</span> <span class="p">&lt;</span><span class="nc">Redirect</span> <span class="na">to=</span><span class="s2">"/login"</span> <span class="p">/&gt;</span>
              <span class="si">}</span><span class="p">/&gt;</span>
            <span class="p">&lt;</span><span class="nc">Route</span> <span class="na">path=</span><span class="s2">"/login"</span> <span class="na">render=</span><span class="si">{</span><span class="p">({</span><span class="nx">history</span><span class="p">})</span> <span class="o">=&gt;</span>
              <span class="p">&lt;</span><span class="nc">Login</span> <span class="na">history=</span><span class="si">{</span><span class="nx">history</span><span class="si">}</span> <span class="na">onLogin=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">login</span><span class="si">}</span> <span class="p">/&gt;</span><span class="si">}</span>
            <span class="p">/&gt;</span>
          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nc">Router</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">em</span><span class="p">&gt;</span>Note app, Department of Computer Science 2018<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Render-metodissa määritellään myös kokonaan <em>Router</em>:in ulkopuolella oleva nykyisille web-sovelluksille tyypillinen <em>footer</em>-elementti, eli sivuston pohjalla oleva osa, joka on näkyvillä riippumatta siitä mikä komponentti sovelluksen reititetyssä osassa näytetään.</p>

<p><strong>Huom:</strong> edellä olevassa esimerkissä käytetään React Routerin versiota 4.2.6. Jos ja kun etsit esimerkkejä internetistä, kannattaa varmistaa, että niissä käytetään Routerista vähintään versiota 4.0. Nelosversio ei ole ollenkaan alaspäinyhteensopiva kolmosen kanssa, eli vanhaa React Routeria käyttävä koodi on täysin käyttökelvotonta Routerin versiota 4 käytettäessä.</p>

<h2 id="tehtäviä-4">tehtäviä</h2>

<p>Tee nyt tehtävät <a href="/tehtävät#router">6.16-6.18</a></p>

<h2 id="inline-tyylit">Inline-tyylit</h2>

<p>Osan 2 <a href="/osa2#tyylien-lisääminen">lopussa</a> lisäsimme React-sovellukseen tyylejä vanhan koulukunnan tapaan yhden koko sovelluksen tyylit määrittelevän CSS-tiedoston avulla.</p>

<p>Olemme jo muutamaan kertaan määritelleet komponenteille <a href="https://react-cn.github.io/react/tips/inline-styles.html">inline</a>-tyylejä, eli määritelleet CSS:ää suoraan komponentin muun koodin seassa.</p>

<p>Edellisessä osassa piilotimme inline-tyylin avulla napin ruudusta tietyissä tapauksissa:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">hideWhenVisible</span> <span class="o">=</span> <span class="p">{</span> <span class="na">display</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">visible</span> <span class="p">?</span> <span class="s1">'none'</span> <span class="p">:</span> <span class="s1">''</span> <span class="p">}</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style=</span><span class="si">{</span><span class="nx">hideWhenVisible</span><span class="si">}</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">toggleVisibility</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">buttonLabel</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>eli jos <em>this.state.visible</em> oli arvoltaan tosi, liitetään <em>div</em>-komponenttiin sen näkymättömäksi asettava tyyli</p>

<pre><code class="language-CSS">{ display: 'none' }
</code></pre>

<p>Periaate inline-tyylien määrittelyssä on siis erittäin yksinkertainen. Mihin tahansa React-komponenttiin tai elementtiin voi liittää attribuutin <em>style</em>, jolle annetaan arvoksi Javascript-oliona määritelty joukko <em>CSS</em>-sääntöjä.</p>

<p>CSS-säännöt määritellään hieman eri tavalla kuin normaaleissa CSS-tiedostoissa. Jos haluamme asettaa jollekin elementille vihreän, kursivoidun ja 16 pikselin korkuisen fontin, eli CSS-syntaksilla ilmaistuna</p>

<pre><code class="language-CSS">{
  color: green;
  font-style: italic;
  font-size: 16px;
}
</code></pre>

<p>tulee tämä muotilla Reactin inline-tyylin määrittelevänä oliona seuraavasti</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">footerStyle</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">color</span><span class="p">:</span> <span class="s1">'green'</span><span class="p">,</span>
  <span class="na">fontStyle</span><span class="p">:</span> <span class="s1">'italic'</span><span class="p">,</span>
  <span class="na">fontSize</span><span class="p">:</span> <span class="mi">16</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Jokainen CSS-sääntö on olion kenttä, joten ne erotetaan Javascript-syntaksin mukaan pilkuilla. Pikseleinä ilmaistut numeroarvot voidaan määritellä kokonaislukuina. Merkittävin ero normaaliin CSS:ään on väliviivan sisältämien CSS-ominaisuuksien kirjoittaminen <em>camelCase</em>-muodossa.</p>

<p>Voimme muotoilla edellisen luvun footer-elementin olion <em>footerStyle</em> avulla seuraavasti:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div <span class="nv">style</span><span class="o">={</span>footerStyle<span class="o">}&gt;</span>
  &lt;br /&gt;
  &lt;em&gt;Note app, Department of Computer Science 2018&lt;/em&gt;
&lt;/div&gt;
</code></pre></div></div>

<p>Inline-tyyleillä on tiettyjä rajoituksia, esim. ns. <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Pseudo-classes">pseudo-selektoreja</a> ei ole mahdollisuutta käyttää (ainakaan helposti).</p>

<p>Inline-tyylit ja muutamat seuraavassa osassa katsomamme tavat lisätä tyylejä Reactiin ovat periaatteessa täysin vastoin vanhoja hyviä periaatteita, joiden mukaan Web-sovellusten ulkoasujen määrittely eli CSS tulee erottaa sisällön (HTML) ja toiminnallisuuden (Javascript) määrittelystä. Vanha koulukunta pyrkiikin siihen että sovelluksen CSS, HTML ja Javascript on kaikki kirjoitettu omiin tiedostoihinsa.</p>

<p>Itseasiassa Reactin filosofia on täysin päinvastainen. Koska CSS:n, HTML:n ja Javascriptin erottelu eri tiedostoihin ei ole kuitenkaan osoittautunut erityisen skaalautuvaksi ratkaisuiksi suurissa järjestelmissä, on Reactissa periaatteena tehdä erottelu (eli jakaa sovelluksen koodi eri tiedostoihin) noudattaen <em>sovelluksen loogisia toiminnallisia kokonaisuuksia</em>.</p>

<p>Toiminnallisen kokonaisuuden strukturointiyksikkö on React-komponentti, joka määrittelee niin sisällön rakenteen kuvaavan HTML:n, toiminnan määrittelevät Javascript-funktiot kuin komponentin tyylinkin yhdessä paikassa, siten että komponenteista tulee mahdollisimman riippumattomia ja yleiskäyttöisiä.</p>

<h2 id="tehtäviä-5">tehtäviä</h2>

<p>Tee nyt tehtävät <a href="/tehtävät#inline-tyylit">6.19 ja 6.20</a></p>

<h2 id="valmiit-käyttöliittymätyylikirjastot">Valmiit käyttöliittymätyylikirjastot</h2>

<p>Eräs lähestymistapa sovelluksen tyylien määrittelyyn on valmiin “UI frameworkin”, eli suomeksi ehkä käyttöliittymätyylikirjaston käyttö.</p>

<p>Ensimmäinen laajaa kuuluisuutta saanut UI framework oli Twitterin kehittämä <a href="https://getbootstrap.com/">Bootstrap</a>, joka lienee edelleen UI frameworkeista eniten käytetty. Viime aikoina UI frameworkeja on noussut kuin sieniä sateella. Valikoima on niin iso, ettei tässä kannata edes yrittää tehdä tyhjentävää listaa.</p>

<p>Monet UI-frameworkit sisältävät web-sovellusten käyttöön valmiiksi määriteltyjä teemoja sekä “komponentteja”, kuten painikkeita, menuja, taulukkoja. Termi komponentti on edellä kirjotettu hipsuissa sillä kyse ei ole samasta asiasta kuin React-komponentti. Useimmiten UI-frameworkeja käytetään sisällyttämällä sovellukseen frameworkin määrittelemät CSS-tyylitiedostot sekä Javascript-koodi.</p>

<p>Monesta UI-frameworkista on tehty React-ystävällisiä versiota, joissa UI-frameworkin avulla määritellyistä “komponenteista” on tehty React-komponentteja. Esim. Bootstrapista on olemassa parikin React-versiota <a href="http://reactstrap.github.io/">reactstrap</a> ja <a href="https://react-bootstrap.github.io/">react-bootstrap</a>.</p>

<p>Katsotaan seuraavaksi kahta UI-framworkia bootstrapia ja <a href="https://semantic-ui.com/">semantic ui</a>:ta.
Lisätään molempien avulla samantapaiset tyylit luvun <a href="/osa6#React-router">React-router</a> sovellukseen.</p>

<h3 id="react-bootstrap">react bootstrap</h3>

<p>Aloitetaan bootstrapista, käytetään kirjastoa <a href="https://react-bootstrap.github.io/">react-bootstrap</a>.</p>

<p>Asennetaan kirjasto suorittamalla komento</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install <span class="nt">--save</span> react-bootstrap
</code></pre></div></div>

<p>Lisätään sitten sovelluksen <em>public/index.html</em> tiedoston <em>head</em>-tagin sisään bootstrapin css-määrittelyt lataava rivi:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"</span> <span class="na">integrity=</span><span class="s">"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
  // ...
<span class="nt">&lt;/head&gt;</span>
</code></pre></div></div>

<p>Kun sovellus ladataan uudelleen, näyttää se jo aavistuksen tyylikkäämmältä:</p>

<p><img src="http://localhost:4000/assets/6/10.png" alt="" /></p>

<p>Bootstrapissa koko sivun sisältö renderöidään yleensä <a href="https://getbootstrap.com/docs/4.0/layout/overview/#containers">container</a>:ina, eli käytännössä koko sovelluksen ympäröivä <em>div</em>-elementti merkitään luokalla <em>container</em>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className=</span><span class="s2">"container"</span><span class="p">&gt;</span>
        // ...
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Sovelluksen ulkoasu muuttuu siten, että sisältö ei ole enää yhtä kiinni selaimen reunoissa:</p>

<p><img src="http://localhost:4000/assets/6/11.png" alt="" /></p>

<p>Muutetaan seuraavaksi komponenttia <em>Notes</em> siten, että se renderöi muistiinpanojen listan <a href="https://getbootstrap.com/docs/4.0/content/tables/">taulukkona</a>. React bootstrap tarjoaa valmiin komponentin <a href="https://reactstrap.github.io/components/tables/">Table</a>, joten CSS-luokan käyttöön ei ole tarvetta.</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Notes</span> <span class="o">=</span> <span class="p">({</span><span class="nx">notes</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Notes<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nc">Table</span> <span class="nt">striped</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="nx">notes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">note</span><span class="o">=&gt;</span>
          <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">key=</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">to=</span><span class="si">{</span><span class="s2">`/notes/${note.id}`</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">content</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
              <span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">user</span><span class="si">}</span>
            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">)</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nc">Table</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Ulkoasu on varsin tyylikäs:</p>

<p><img src="http://localhost:4000/assets/6/12.png" alt="" /></p>

<p>Huomaa, että koodissa käytettävät React bootstrapin komponentit täytyy importata, eli koodiin on lisättävä:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Table</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-bootstrap'</span>
</code></pre></div></div>

<h4 id="lomake">Lomake</h4>

<p>Parannellaan seuraavaksi näkymän <em>Login</em> kirjautumislomaketta Bootstrapin <a href="https://getbootstrap.com/docs/4.0/components/forms/">lomakkeiden</a> avulla.</p>

<p>React bootstrap tarjoaa valmiit <a href="https://react-bootstrap.github.io/components/forms/">komponentit</a> myös lomakkeiden muodostamiseen (dokumentaatio tosin ei ole paras mahdollinen):</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Login</span> <span class="o">=</span> <span class="p">({</span><span class="nx">onLogin</span><span class="p">,</span> <span class="nx">history</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>login<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">form</span> <span class="na">onSubmit=</span><span class="si">{</span><span class="nx">onSubmit</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">FormGroup</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nc">ControlLabel</span><span class="p">&gt;</span>username:<span class="p">&lt;/</span><span class="nc">ControlLabel</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nc">FormControl</span>
            <span class="na">type=</span><span class="s2">"text"</span>
            <span class="na">name=</span><span class="s2">"username"</span>
          <span class="p">/&gt;</span>
          <span class="p">&lt;</span><span class="nc">ControlLabel</span><span class="p">&gt;</span>password:<span class="p">&lt;/</span><span class="nc">ControlLabel</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nc">FormControl</span>
            <span class="na">type=</span><span class="s2">"password"</span>
          <span class="p">/&gt;</span>
          <span class="p">&lt;</span><span class="nc">Button</span> <span class="na">bsStyle=</span><span class="s2">"success"</span> <span class="na">type=</span><span class="s2">"submit"</span><span class="p">&gt;</span>login<span class="p">&lt;/</span><span class="nc">Button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nc">FormGroup</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)}</span>
</code></pre></div></div>

<p>Importoitavien komponenttien määrä kasvaa:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Table</span><span class="p">,</span> <span class="nx">FormGroup</span><span class="p">,</span> <span class="nx">FormControl</span><span class="p">,</span> <span class="nx">ControlLabel</span><span class="p">,</span> <span class="nx">Button</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'react-bootstrap'</span>
</code></pre></div></div>

<p>Lomake näyttää parantelun jälkeen seuraavalta:</p>

<p><img src="http://localhost:4000/assets/6/12b.png" alt="" /></p>

<h4 id="notifikaatio">Notifikaatio</h4>

<p>Toteutetaan sovellukseen kirjautumisen jälkeinen <em>notifikaatio</em>:</p>

<p><img src="http://localhost:4000/assets/6/13.png" alt="" /></p>

<p>Asetetaan notifikaatio kirjautumisen yhteydessä komponentin <em>App</em> tilan kenttään <em>message</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">login</span> <span class="o">=</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">user</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="s2">`welcome </span><span class="p">${</span><span class="nx">user</span><span class="p">}</span><span class="s2">`</span><span class="p">})</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">message</span><span class="p">:</span> <span class="kc">null</span><span class="p">})</span>
  <span class="p">},</span> <span class="mi">10000</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ja renderöidään viesti Bootstrapin <a href="https://getbootstrap.com/docs/4.0/components/alerts/">Alert</a>-komponentin avulla. React bootstrap tarjoaa tähän jälleen valmiin <a href="https://react-bootstrap.github.io/components/alerts/">React-komponentin</a>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">message</span> <span class="o">&amp;&amp;</span>
  <span class="p">&lt;</span><span class="nc">Alert</span> <span class="na">color=</span><span class="s2">"success"</span><span class="p">&gt;</span>
    <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span>
  <span class="p">&lt;/</span><span class="nc">Alert</span><span class="p">&gt;</span>
<span class="p">)}</span>
</code></pre></div></div>

<h4 id="navigaatiorakenne">Navigaatiorakenne</h4>

<p>Muutetaan vielä lopuksi sovelluksen navigaatiomenu käyttämään Bootstrapin <a href="https://getbootstrap.com/docs/4.0/components/navbar/">Navbaria</a>. Tähänkin React bootstrap tarjoaa <a href="https://react-bootstrap.github.io/components/navbar/#navbars-mobile-friendly">valmiit komponentit</a>, dokumentaatio on hieman kryptistä, mutta trial and error johtaa lopulta toimivaan ratkaisuun:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Navbar inverse collapseOnSelect&gt;
  &lt;Navbar.Header&gt;
    &lt;Navbar.Brand&gt;
      Anecdote app
    &lt;/Navbar.Brand&gt;
    &lt;Navbar.Toggle /&gt;
  &lt;/Navbar.Header&gt;
  &lt;Navbar.Collapse&gt;
    &lt;Nav&gt;
      &lt;NavItem <span class="nv">href</span><span class="o">=</span><span class="s2">"#"</span><span class="o">&gt;</span>
        &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/"</span><span class="o">&gt;</span>home&lt;/Link&gt;
      &lt;/NavItem&gt;
      &lt;NavItem <span class="nv">href</span><span class="o">=</span><span class="s2">"#"</span><span class="o">&gt;</span>
        &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/notes"</span><span class="o">&gt;</span>notes&lt;/Link&gt;
      &lt;/NavItem&gt;
      &lt;NavItem <span class="nv">href</span><span class="o">=</span><span class="s2">"#"</span><span class="o">&gt;</span>
        &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/users"</span><span class="o">&gt;</span>users&lt;/Link&gt;
      &lt;/NavItem&gt;
      &lt;NavItem&gt;
        <span class="o">{</span>this.state.user
          ? &lt;em&gt;<span class="o">{</span>this.state.user<span class="o">}</span> logged <span class="k">in</span>&lt;/em&gt;
          : &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/login"</span><span class="o">&gt;</span>login&lt;/Link&gt;
        <span class="o">}</span>
      &lt;/NavItem&gt;
    &lt;/Nav&gt;
  &lt;/Navbar.Collapse&gt;
&lt;/Navbar&gt;
</code></pre></div></div>

<p>Ulkoasu on varsin tyylikäs</p>

<p><img src="http://localhost:4000/assets/6/14.png" alt="" /></p>

<p>Jos selaimen kokoa kaventaa, huomaamme että menu “kollapsoituu” ja sen saa näkyville vain klikkaamalla:</p>

<p><img src="http://localhost:4000/assets/6/15.png" alt="" /></p>

<p>Bootstrap ja valtaosa tarjolla olevista UI-frameworkeista tuottavat <a href="https://en.wikipedia.org/wiki/Responsive_web_design">responsiivisia</a> näkymiä, eli sellaisia jotka renderöityvät vähintään kohtuullisesti monen kokoisilla näytöillä.</p>

<p>Chromen konsolin avulla on mahdollista simuloida sovelluksen käyttöä erilaisilla mobiilipäätteillä</p>

<p><img src="http://localhost:4000/assets/6/16.png" alt="" /></p>

<p>Sovellus toimii hyvin, mutta konsoliin vilkaisu paljastaa erään ikävän detaljin:</p>

<p><img src="http://localhost:4000/assets/6/17.png" alt="" /></p>

<p>Syy valituksiin on navigaatiorakenteessa</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;NavItem <span class="nv">href</span><span class="o">=</span><span class="s2">"#"</span><span class="o">&gt;</span>
  &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/"</span><span class="o">&gt;</span>home&lt;/Link&gt;
&lt;/NavItem&gt;
</code></pre></div></div>

<p>Nämä sisäkkäiset komponentit sisältävät molemmat <em>a</em>-tagin ja React hermostuu tästä.</p>

<p>Ongelma on ikävä ja sen kiertäminen on toki mahdollista, katso esim.
<a href="https://serverless-stack.com/chapters/adding-links-in-the-navbar.html">https://serverless-stack.com/chapters/adding-links-in-the-navbar.html</a></p>

<p>Esimerkin sovelluksen koodi kokonaisuudessaan <a href="https://github.com/FullStack-HY/FullStack-Hy.github.io/wiki/bootstrap">täällä</a>.</p>

<h3 id="semantic-ui">Semantic UI</h3>

<p>Olen käyttänyt bootstrapia vuosia, mutta siirryin hiljattain <a href="https://semantic-ui.com/">Semantic UI</a>:n käyttäjäksi. Kurssin tehtävien <a href="https://studies.cs.helsinki.fi/fs-stats">palautusovellus</a> on tehty Semanticilla ja kokemukset ovat olleet rohkaisevia, erityisesti semanticin <a href="https://react.semantic-ui.com">React-tuki</a> on ensiluokkainen ja dokumentaatiokin huomattavasti parempi kuin bootstrapissa.</p>

<p>Lisätään nyt <a href="/osa6#React-router">React-router</a>-sovellukselle edellisen luvun tapaan tyylit semanticilla.</p>

<p>Aloitetaan asentamalla <a href="https://react.semantic-ui.com">react-semantic-ui</a>-kirjasto:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install <span class="nt">--save</span> semantic-ui-react
</code></pre></div></div>

<p>Lisätään sitten sovelluksen tiedostoon <em>public/index.html</em> head-tagin sisään semanticin css-määrittelyt lataava rivi:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.12/semantic.min.css"</span><span class="nt">&gt;&lt;/link&gt;</span>
  // ...
<span class="nt">&lt;/head&gt;</span>
</code></pre></div></div>

<p>Sijoitetaan koko sovelluksen renderöimä sisältö Semanticin komponentin <a href="https://react.semantic-ui.com/elements/container">Container</a> sisälle.</p>

<p>Semanticin dokumentaatio sisältää jokaisesta komponentista useita esimerkkikoodinpätkiä, joiden avulla komponenttien käytön periaatteet on helppo omaksua:</p>

<p><img src="http://localhost:4000/images/6/18.png" alt="" /></p>

<p>Muutetaan komponentin App uloin <em>div</em>-elementti <em>Containeriksi</em>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import <span class="o">{</span> Container <span class="o">}</span> from <span class="s1">'semantic-ui-react'</span>

// ...

class App extends React.Component <span class="o">{</span>
  // ...
  render<span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span>
      &lt;Container&gt;
        // ...
      &lt;/Container&gt;
    <span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Sivun sisältö ei ole enää reunoissa kiinni:</p>

<p><img src="http://localhost:4000/images/6/19.png" alt="" /></p>

<p>Edellisen luvun tapaan, renderöidään muistiinpanot taulukkona, komponentin <a href="https://react.semantic-ui.com/collections/table">Table</a> avulla. Koodi näyttää seuraavalta</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Table</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'semantic-ui-react'</span>

<span class="kd">const</span> <span class="nx">Notes</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">notes</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Notes<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nc">Table</span> <span class="nt">striped</span> <span class="nt">celled</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Table</span><span class="p">.</span><span class="nc">Body</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="nx">notes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">note</span> <span class="o">=&gt;</span>
          <span class="p">&lt;</span><span class="nc">Table</span><span class="p">.</span><span class="nc">Row</span> <span class="na">key=</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">Table</span><span class="p">.</span><span class="nc">Cell</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nc">Link</span> <span class="na">to=</span><span class="si">{</span><span class="s2">`/notes/${note.id}`</span><span class="si">}</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">content</span><span class="si">}</span><span class="p">&lt;/</span><span class="nc">Link</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nc">Table</span><span class="p">.</span><span class="nc">Cell</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">Table</span><span class="p">.</span><span class="nc">Cell</span><span class="p">&gt;</span>
              <span class="si">{</span><span class="nx">note</span><span class="p">.</span><span class="nx">user</span><span class="si">}</span>
            <span class="p">&lt;/</span><span class="nc">Table</span><span class="p">.</span><span class="nc">Cell</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nc">Table</span><span class="p">.</span><span class="nc">Row</span><span class="p">&gt;</span>
        <span class="p">)</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nc">Table</span><span class="p">.</span><span class="nc">Body</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nc">Table</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Muistiinpanojen lista näyttää seuraavalta:</p>

<p><img src="http://localhost:4000/images/6/20.png" alt="" /></p>

<h4 id="lomake-1">Lomake</h4>

<p>Otetaan kirjautumissivulla käyttöön Semanticin <a href="https://react.semantic-ui.com/collections/form">Form</a>-komponentti:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import { Form, Button } from 'semantic-ui-react'

const Login = ({ onLogin, history }) =&gt; {
  const onSubmit = (event) =&gt; {
    // ...
  }
  return (
    &lt;div&gt;
      &lt;h2&gt;login&lt;/h2&gt;
      &lt;Form onSubmit={onSubmit}&gt;
        &lt;Form.Field&gt;
          &lt;label&gt;username&lt;/label&gt;
          &lt;input name='username' /&gt;
        &lt;/Form.Field&gt;
        &lt;Form.Field&gt;
          &lt;label&gt;password&lt;/label&gt;
          &lt;input type='password' /&gt;
        &lt;/Form.Field&gt;
        &lt;Button type='submit'&gt;login&lt;/Button&gt;
      &lt;/Form&gt;
    &lt;/div&gt;
  )
}
</code></pre></div></div>

<p>Ulkoasu näyttää seuraavalta:</p>

<p><img src="http://localhost:4000/images/6/21.png" alt="" /></p>

<h4 id="notifikaatio-1">Notifikaatio</h4>

<p>Edellisen luvun tapaan, toteutetaan sovellukseen kirjautumisen jälkeinen <em>notifikaatio</em>:</p>

<p><img src="http://localhost:4000/images/6/22.png" alt="" /></p>

<p>Kuten edellisessä luvussa, asetetaan notifikaatio kirjautumisen yhteydessä komponentin <em>App</em> tilan kenttään <em>message</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">login</span> <span class="o">=</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">user</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="s2">`welcome </span><span class="p">${</span><span class="nx">user</span><span class="p">}</span><span class="s2">`</span><span class="p">})</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">message</span><span class="p">:</span> <span class="kc">null</span><span class="p">})</span>
  <span class="p">},</span> <span class="mi">10000</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ja renderöidään viesti käyttäen komponenttia <a href="https://react.semantic-ui.com/collections/message">Message</a>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">message</span> <span class="o">&amp;&amp;</span>
  <span class="p">&lt;</span><span class="nc">Message</span> <span class="nt">success</span><span class="p">&gt;</span>
    <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span>
  <span class="p">&lt;/</span><span class="nc">Message</span><span class="p">&gt;</span>
<span class="p">)}</span>
</code></pre></div></div>

<h4 id="navigaatiorakenne-1">Navigaatiorakenne</h4>

<p>Navigaatiorakenne toteutetaan komponentin <a href="https://react.semantic-ui.com/collections/menu">Menu</a> avulla:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Menu inverted&gt;
  &lt;Menu.Item link&gt;
    &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/"</span><span class="o">&gt;</span>home&lt;/Link&gt;
  &lt;/Menu.Item&gt;
  &lt;Menu.Item link&gt;
    &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/notes"</span><span class="o">&gt;</span>notes&lt;/Link&gt;
  &lt;/Menu.Item&gt;
  &lt;Menu.Item link&gt;
    &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/users"</span><span class="o">&gt;</span>users&lt;/Link&gt;
  &lt;/Menu.Item&gt;
  &lt;Menu.Item link&gt;
    <span class="o">{</span>this.state.user
      ? &lt;em&gt;<span class="o">{</span>this.state.user<span class="o">}</span> logged <span class="k">in</span>&lt;/em&gt;
      : &lt;Link <span class="nv">to</span><span class="o">=</span><span class="s2">"/login"</span><span class="o">&gt;</span>login&lt;/Link&gt;
    <span class="o">}</span>
  &lt;/Menu.Item&gt;
&lt;/Menu&gt;
</code></pre></div></div>

<p>Lopputulos näyttää seuraavalta:</p>

<p><img src="http://localhost:4000/images/6/23.png" alt="" /></p>

<p>Bootstrapin yhteydessä esiintynyttä sisäkkäisen <em>a</em>-tagien ongelmaa ei semanticin kanssa ole.</p>

<p>Esimerkin sovelluksen koodi kokonaisuudessaan <a href="https://github.com/FullStack-HY/FullStack-Hy.github.io/wiki/semantic-ui">täällä</a>.</p>

<h3 id="loppuhuomioita">Loppuhuomioita</h3>

<p>Ero react-bootstrapin ja react-semantic-ui:n välillä ei ole suuri. On makuasia kummalla tuotettu ulkoasu on tyylikkäämpi. Oma vuosia kestäneen bootstrapin käytön jälkeinen sirtymiseni semanticiin johtuu semanticin saumattomammasta React-tuesta, laajemmasta valmiiden komponenttien valikoimasta ja paremmasta sekä selkeämmästä dokumentaatioista. Semantic UI projektin kehitystyön jatkuvuuden suhteen on kuitenkin viime aikoina ollut ilmoilla muutamia <a href="https://github.com/Semantic-Org/Semantic-UI/issues/6109">kysymysmerkkejä</a>, ja tilannetta kannattaakin seurata.</p>

<p>Esimerkissä käytettiin UI-frameworkeja niiden React-integraatiot tarjoavien kirjastojen kautta.</p>

<p>Sen sijaan että käytimme kirjastoa <a href="https://react-bootstrap.github.io/">React bootstrap</a>, olisimme voineet aivan yhtä hyvin käyttää Bootstrapia suoraan, liittämällä HTML-elementteihin CSS-luokkia. Eli sen sijaan että määrittelimme esim. taulukon komponentin <em>Table</em> avulla</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Table striped&gt;
  // ...
&lt;/Table&gt;
</code></pre></div></div>

<p>olisimme voineet käyttää normaalia HTML:n taulukkoa <em>table</em> ja CSS-luokkaa</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;table <span class="nv">className</span><span class="o">=</span><span class="s2">"table striped"</span><span class="o">&gt;</span>
  // ...
&lt;/table&gt;
</code></pre></div></div>

<p>Taulukon määrittelyssä React bootstrapin tuoma etu ei ole suuri.</p>

<p>Tiiviimmän ja ehkä paremmin luettavissa olevan kirjoitusasun lisäksi toinen etu React-kirjastoina olevissa UI-frameworkeissa on se, että kirjastojen mahdollisesti käyttämä Javascript-koodi on sisällytetty React-komponentteihin. Esim. osa Bootstrapin komponenteista edellyttää toimiakseen muutamaakin ikävää <a href="https://getbootstrap.com/docs/4.0/getting-started/introduction/#js">Javascript-riippuvuutta</a> joita emme mielellään halua React-sovelluksiin sisällyttää.</p>

<p>React-kirjastoina tarjottavien UI-frameworkkien ikävä puoli verrattuna frameworkin “suoraan käyttöön” on React-kirjastojen API:n mahdollinen epästabiilius ja osittain huono dokumentaatio. Tosin <a href="https://react.semantic-ui.com">react-semanticin</a> suhteen tilanne on paljon parempi kuiten monien muiden UI-frameworkien sillä kyseessä on virallinen React-integraatio.</p>

<p>Kokonaan toinen kysymys on se kannattaako UI-frameworkkeja ylipäätän käyttää. Kukin muodostakoon oman mielipiteensä, mutta CSS:ää taitamattomalle ja puutteellisilla design-taidoilla varustetulle ne ovat varsin käyttökelpoisia työkaluja.</p>

<h3 id="muita-ui-frameworkeja">Muita UI-frameworkeja</h3>

<p>Luetellaan tässä kaikesta huolimatta muitakin UI-frameworkeja. Jos oma suosikkisi ei ole mukana, tee pull request</p>

<ul>
  <li><a href="http://www.material-ui.com/">http://www.material-ui.com/</a></li>
  <li><a href="https://bulma.io/">https://bulma.io/</a></li>
  <li><a href="https://ant.design/">https://ant.design/</a></li>
  <li><a href="https://foundation.zurb.com/">https://foundation.zurb.com/</a></li>
</ul>

<p>Alun perin tässä osassa oli tarkoitus käyttää <a href="http://www.material-ui.com/">Material UI</a>:ta, mutta kirjasto on juuri nyt kiivaan kehityksen alla ennen version 1.0 julkaisemista ja osa dokumentaation esimerkeistä ei toiminut uusimmalla versiolla. Voikin olla viisainta odotella Materialin kanssa verisiota 1.0.</p>

<h2 id="tehtäviä-6">Tehtäviä</h2>

<p>Tee nyt tehtävät <a href="/tehtävät#ui-framework">6.21-6.23</a></p>

  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
             Full stack open 
          </li>
          <li>
            <a href="mailto:mluukkai@cs.helsinki.fi">mluukkai@cs.helsinki.fi</a>
          </li>
          <li>
            <a href="https://github.com/mluukkai"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">mluukkai</span></a>

          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
           
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>
          <a href="https://courses.helsinki.fi/fi/TKT21009/121540749">https://courses.helsinki.fi/fi/TKT21009/121540749</a>
        </p>
      </div>
    </div>

  </div>

</footer>

  </body>

</html>
