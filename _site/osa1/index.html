<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>osa 1</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/osa1/">
  <link rel="alternate" type="application/rss+xml" title="Full stack open" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Full stack open</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">osa 1</h1>
  </header>

  <div class="post-content">
    <!--
<div class='important warn'>
  <p><strong>dokumenttia päivitetään</strong> lukeminen omalla vastuulla</p>
</div>
-->

<h2 id="osan-1-oppimistavoitteet">Osan 1 oppimistavoitteet</h2>

<ul>
  <li>React
    <ul>
      <li>funktiona ja luokkana määriteltävät komponentit</li>
      <li>tietojen ja funktioiden välittäminen lapsikomponentteihin propseina</li>
      <li>komponentin tila</li>
      <li>tilan päivittämisen periaatteet</li>
      <li>tapahtumankäsittelyn perusteet</li>
    </ul>
  </li>
  <li>Javascript
    <ul>
      <li>muuttujien määrittely</li>
      <li>taulukko ja sen operaatiot (mm. concat, forEach, join ja map)</li>
      <li>literaalisyntaksilla määritellyt oliot</li>
      <li>funktioiden määrittely</li>
      <li>this:in käyttäytyminen</li>
      <li>funktioita palauttavat funktiot</li>
      <li>luokkasyntaksi</li>
      <li>class propertynä määritellyt metodit</li>
    </ul>
  </li>
</ul>

<h2 id="react">React</h2>

<p>Alamme nyt tutustua kurssin ehkä tärkeimpään teemaan, <a href="https://reactjs.org/">React</a>-kirjastoon. Tehdään heti yksinkertainen React-sovellus ja tutustutaan samalla Reactin peruskäsitteistöön.</p>

<p>Ehdottomasti helpoin tapa päästä alkuun on <a href="https://github.com/facebookincubator/create-react-app">create-react-app</a>-nimisen työkalun käyttö. <em>create-react-app</em> on mahdollista asentaa, mutta asennukseen ei ole tarvetta jos Noden mukana asentunut <em>npm</em>-työkalu on versioltaan vähintään <em>5.3</em>. Tällöin npm:n mukana asentuu komento <em>npx</em>, joka mahdollistaa create-react-app:in käytön asentamatta sitä erikseen. Npm:n version saa selville komennolla <em>npm -v</em>. Laitoksen koneilla ja fuksiläppäreillä asian pitäisi olla kunnossa.</p>

<p>Luodaan sovellus nimeltään <em>osa1</em> ja käynnistetään se:</p>

<pre>
$ npx create-react-app osa1
$ cd osa1
$ npm start
</pre>

<p>Sovellus käynnistyy oletusarvoisesti localhostin porttiin 3000, eli osoitteeseen <a href="http://localhost:3000">http://localhost:3000</a></p>

<p>Chromen pitäisi aueta automaattisesti. Avaa konsoli <strong>välittömästi</strong>. Avaa myös tekstieditori siten, että näet koodin ja web-sivun samaan aikaan ruudulla:</p>

<p><img src="http://localhost:4000/images/1/26.png" alt="" /></p>

<p>Sovelluksen koodi on hakemistossa <em>src</em>. Yksinkertaistetaan valmiina olevaa koodia siten, että tiedoston <em>index.js</em> sisällöksi tulee:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span>
<span class="k">import</span> <span class="nx">ReactDOM</span> <span class="k">from</span> <span class="s1">'react-dom'</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nc">App</span> <span class="p">/&gt;,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">))</span>
</code></pre></div></div>

<p>Voit poistaa tiedostot <em>App.js</em>, <em>App.css</em>, <em>App.test.js</em>, <em>logo.svg</em> ja <em>registerServiceWorker.js</em></p>

<h3 id="komponentti">Komponentti</h3>

<p>Tiedosto <em>index.js</em> määrittelee nyt React-<a href="https://reactjs.org/docs/components-and-props.html">komponentin</a> nimeltään <em>App</em> ja viimeisen rivin komento</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nc">App</span> <span class="p">/&gt;,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">))</span>
</code></pre></div></div>

<p>renderöi komponentin sisällön tiedoston <em>public/index.html</em> määrittelemään <em>div</em>-elementtiin, jonka <em>id:n</em> arvona on ‘root’</p>

<p>Tiedosto <em>public/index.html</em> on oleellisesti ottaen tyhjä, voit kokeilla lisätä sinne HTML:ää. Reactilla ohjelmoitaessa yleensä kuitenkin kaikki renderöitävä sisältö määritellään Reactin komponenttien avulla.</p>

<p>Tarkastellaan vielä tarkemmin komponentin määrittelevää koodia:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Kuten arvata saattaa, komponentti renderöityy <em>div</em>-tagina, jonka sisällä on <em>p</em>-tagin sisällä oleva teksti <em>Hello world</em>.</p>

<p>Teknisesti ottaen komponentti on määritelty Javascript-funktiona. Seuraava siis on funktio (joka ei saa yhtään parametria):</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">)</span>
</code></pre></div></div>

<p>joka sijoitetaan vakioarvoiseen muuttujaan <em>App</em></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">...</span>
</code></pre></div></div>

<p>Javascriptissa on muutama tapa määritellä funktioita. Käytämme nyt Javascriptin hieman uudemman version <a href="http://es6-features.org/#Constants">EcmaScript 6:n</a> eli ES6:n <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">nuolifunktiota</a> (arrow functions).</p>

<p>Koska funktio koostuu vain yhdestä lausekkeesta, on käytössämme lyhennysmerkintä, joka vastaa oikeasti seuraavaa koodia:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>eli funktio palauttaa sisältämänsä lausekkeen arvon.</p>

<p>Komponentin määrittelevä funktio voi sisältää mitä tahansa Javascript-koodia. Muuta komponenttisi seuraavaan muotoon ja katso mitä konsolissa tapahtuu:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Hello from komponentti'</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)}</span>
</code></pre></div></div>

<p>Komponenttien sisällä on mahdollista renderöidä myös dynaamista sisältöä.</p>

<p>Muuta komponentti muotoon:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
  <span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">20</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world, it is <span class="si">{</span><span class="nx">now</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">a</span><span class="si">}</span> plus <span class="si">{</span><span class="nx">b</span><span class="si">}</span> is <span class="si">{</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Aaltosulkeiden sisällä oleva Javascript-koodi evaluoidaan ja evaluoinnin tulos upotetaan määriteltyyn kohtaan komponentin tuottamaa HTML-koodia.</p>

<h3 id="jsx">JSX</h3>

<p>Näyttää siltä, että React-komponentti palauttaa HTML-koodia. Näin ei kuitenkaan ole. React-komponenttien ulkoasu kirjoitetaan yleensä <a href="https://reactjs.org/docs/introducing-jsx.html">JSX</a>:ää käyttäen. Vaikka JSX näyttää HTML:ltä, kyseessä on kuitenkin tapa kirjoittaa Javascriptiä. React komponenttien palauttama JSX käännetään konepellin alla Javascriptiksi.</p>

<p>Käännösvaiheen jälkeen ohjelmamme näyttää seuraavalta:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ReactDOM</span> <span class="k">from</span> <span class="s1">'react-dom'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span>
    <span class="s1">'div'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span>
      <span class="s1">'p'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'Hello world, it is '</span><span class="p">,</span> <span class="nx">now</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">),</span>
    <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span>
      <span class="s1">'p'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="s1">' plus '</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="s1">' is '</span><span class="p">,</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span>
    <span class="p">)</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">App</span><span class="p">,</span> <span class="kc">null</span><span class="p">),</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">));</span>
</code></pre></div></div>

<p>Käännöksen hoitaa <a href="https://babeljs.io/repl/">Babel</a>. Create-react-app:illa luoduissa projekteissa käännös on konfiguroitu tapahtumaan automaattisesti. Tulemme tutustumaan aiheeseen tarkemmin kurssin <a href="/osa7">osassa 7</a>.</p>

<p>Reactia olisi myös mahdollista kirjoittaa “suoraan Javascriptinä” käyttämättä JSX:ää. Kukaan täysijärkinen ei kuitenkaan niin tee.</p>

<p>Käytännössä JSX on melkein kuin HTML:ää sillä erotuksella, että mukaan voi upottaa helposti dynaamista sisältöä kirjoittamalla sopivaa Javascriptiä aaltosulkeiden sisälle. Idealtaan JSX on melko lähellä monia palvelimella käytettäviä templating-kieliä kuten Java Springin yhteydessä käytettävää thymeleafia.</p>

<h2 id="monta-komponenttia">Monta komponenttia</h2>

<p>Muutetaan sovellusta seuraavasti (yläreunan importit jätetään nyt ja jatkossa pois):</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello world<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nc">App</span> <span class="p">/&gt;,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">))</span>
</code></pre></div></div>

<p>Olemme määritelleet uuden komponentin <em>Hello</em>, jota käytetään komponentista <em>App</em>. Komponenttia voidaan luonnollisesti käyttää monta kertaa:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Komponenttien tekeminen Reactissa on helppoa ja komponentteja yhdistelemällä monimutkaisempikin sovellus on mahdollista pitää kohtuullisesti ylläpidettävänä. Reactissa filosofiana onkin koostaa sovellus useista, pieneen asiaan keskittyvistä uudelleenkäytettävistä komponenteista.</p>

<h2 id="props-tiedonvälitys-komponenttien-välillä">props: tiedonvälitys komponenttien välillä</h2>

<p>Komponenteille on mahdollista välittää dataa <a href="https://reactjs.org/docs/components-and-props.html">propsien</a> avulla.</p>

<p>Muutetaan komponenttia <em>Hello</em> seuraavasti</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>komponentin määrittelevällä funktiolla on nyt parametri <em>props</em>. Parametri saa arvokseen olion, jonka kenttinä ovat kaikki eri “propsit”, jotka komponentin käyttäjä määrittelee.</p>

<p>Propsit määritellään seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="s2">"Arto"</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="s2">"Pekka"</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Propseja voi olla mielivaltainen määrä ja niiden arvot voivat olla “kovakoodattuja” merkkijonoja tai Javascript-lausekkeiden tuloksia. Jos propsin arvo muodostetaan Javascriptillä, tulee se olla aaltosulkeissa.</p>

<p>Muutetaan koodia siten, että komponentti <em>Hello</em> käyttää kahta propsia:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span><span class="si">}</span> years old<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">nimi</span> <span class="o">=</span> <span class="s1">'Pekka'</span>
  <span class="kd">const</span> <span class="nx">ika</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="s2">"Arto"</span> <span class="na">age=</span><span class="si">{</span><span class="mi">26</span> <span class="o">+</span> <span class="mi">10</span><span class="si">}</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="si">{</span><span class="nx">nimi</span><span class="si">}</span> <span class="na">age=</span><span class="si">{</span><span class="nx">ika</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Komponentti <em>App</em> lähettää propseina muuttujan arvoja, summalausekkeen evaluoinnin tuloksen ja normaalin merkkijonon.</p>

<h3 id="muutama-huomio">Muutama huomio</h3>

<p>React on konfiguroitu antamaan varsin hyviä virheilmoituksia. Kannattaa kuitenkin edetä ainakin alussa <strong>todella pienin askelin</strong> ja varmistaa, että jokainen muutos toimii halutulla tavalla.</p>

<p><strong>Konsolin tulee olla koko ajan auki</strong>. Jos selain ilmoittaa virheestä, ei kannata kirjoittaa sokeasti lisää koodia ja toivoa ihmettä tapahtuvaksi, vaan tulee yrittää ymmärtää virheen syy ja esim. palata edelliseen toimivaan tilaan:</p>

<p><img src="http://localhost:4000/images/1/27.png" alt="" /></p>

<p>Kannattaa myös muistaa, että React-koodissakin on mahdollista ja kannattavaa lisätä koodin sekaan sopivia konsoliin tulostavia <code>console.log()</code>-komentoja. Tulemme hieman <a href="#react-sovellusten-debuggaus">myöhemmin</a> tutustumaan muutamiin muihinkin tapoihin debugata Reactia.</p>

<p>Kannattaa pitää mielessä, että <strong>React-komponenttien nimien tulee alkaa isolla kirjaimella</strong>. Jos yrität määritellä komponentin seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">footer</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>greeting app created by <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href=</span><span class="s2">"https://github.com/mluukkai"</span><span class="p">&gt;</span>mluukkai<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ja ottaa se käyttöön</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="s2">"Arto"</span> <span class="na">age=</span><span class="si">{</span><span class="mi">26</span> <span class="o">+</span> <span class="mi">10</span><span class="si">}</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">footer</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>sivulle ei kuitenkaan ilmesty näkyviin Footer-komponentissa määriteltyä sisältöä, vaan React luo sivulle ainoastaan tyhjän <em>footer</em>-elementin. Jos muutat komponentin nimen alkamaan isolla kirjaimella, React luo sivulle <em>div</em>-elementin, joka määriteltiin Footer-komponentissa.</p>

<p>Kannattaa myös  pitää mielessä, että React-komponentin sisällön tulee (yleensä) sisältää <strong>yksi juurielementti</strong>. Eli jos yrittäisimme määritellä komponentin <em>App</em> ilman uloimmaista <em>div</em>-elementtiä:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="s2">"Arto"</span> <span class="na">age=</span><span class="si">{</span><span class="mi">26</span> <span class="o">+</span> <span class="mi">10</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nc">Footer</span> <span class="p">/&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>seurauksena on virheilmoitus:</p>

<p><img src="http://localhost:4000/assets/1/27a.png" alt="" /></p>

<p>Reactin versiosta 0.16 asti juurielementin käyttö ei ole ollut enää ainoa toimiva vaihtoehto, myös <em>taulukollinen</em> komponentteja on validi tapa:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">[</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Greetings<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;,</span>
      <span class="p">&lt;</span><span class="nc">Hello</span> <span class="na">name=</span><span class="s2">"Arto"</span> <span class="na">age=</span><span class="si">{</span><span class="mi">26</span> <span class="o">+</span> <span class="mi">10</span><span class="si">}</span> <span class="p">/&gt;,</span>
      <span class="p">&lt;</span><span class="nc">Footer</span> <span class="p">/&gt;</span>
    <span class="p">]</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Määritellessä sovelluksen juurikomponenttia, tämä ei kuitenkaan ole järkevää ja näyttää koodissakin pahalta.</p>

<h3 id="react-tehtävät-osa-1">React-tehtävät, osa 1</h3>

<p>Tee nyt <a href="/tehtävät#reactin-alkeet">tehtävät 1.1 ja 1.2</a></p>

<h2 id="javascriptiä">Javascriptiä</h2>

<p>Kurssin aikana on websovelluskehityksen rinnalla tavoite ja tarve oppia riittävässä määrin Javascriptiä.</p>

<p>Javascript on kehittynyt viime vuosina nopeaan tahtiin, ja käytämme kurssilla kielen uusimpien versioiden piirteitä, joista osa ei ole vielä edes ehtinyt kielen viimeisimpään standardoituun versioon. Javascript-standardin virallinen nimi on <a href="https://en.wikipedia.org/wiki/ECMAScript">ECMAScript</a>. Tämän hetken tuorein versio on kesäkuussa 2017 julkaistu <a href="https://www.ecma-international.org/publications/standards/Ecma-262.htm">ES8</a>, toiselta nimeltään ECMAScript 2017.</p>

<p>Selaimet eivät vielä osaa kaikkia Javascriptin uusimpien versioiden ominaisuuksia. Tämän takia selaimessa suoritetaan useimmiten koodia joka on käännetty (englanniksi <em>transpiled</em>) uudemmasta Javascriptin versiosta johonkin vanhempaan, laajemmin tuettuun versioon.</p>

<p>Tällä hetkellä johtava tapa tehdä transpilointi on <a href="https://babeljs.io/">Babel</a>. Create-react-app:in avulla luoduissa React-sovelluksissa on valmiiksi konfiguroitu automaattinen transpilaus. Katsomme kurssin <a href="/osa7">osassa 7</a> tarkemmin miten transpiloinnin konfigurointi tapahtuu.</p>

<p><a href="https://nodejs.org/en/">Node.js</a> on melkein missä vaan, mm. palvelimilla toimiva, Googlen <a href="https://developers.google.com/v8/">chrome V8</a>-javascriptmoottoriin perustuva Javascript-suoritusympäristö. Harjoitellaan hieman Javascriptiä Nodella. Tässä oletetaan, että koneellasi on Node.js:stä vähintään versio <em>v8.6.0</em>. Noden tuoreet versiot osaavat suoraan Javascriptin uusia versioita, joten koodin transpilaus ei ole tarpeen.</p>

<p>Koodi kirjoitetaan <em>.js-</em>päätteiseen tiedostoon, ja suoritetaan komennolla <code>node tiedosto.js</code></p>

<p>Koodia on mahdollisuus kirjoittaa myös Node.js-konsoliin, joka aukeaa kun kirjoitat komentorivillä <em>node</em> tai myös selaimen developer toolin konsoliin. Chromen uusimmat versiot osaavat suoraan transpiloimatta <a href="http://kangax.github.io/compat-table/es6/">melko hyvin</a> Javascriptin uusiakin piirteitä.</p>

<p>Javascript muistuttaa nimensä ja syntaksinsa puolesta läheisesti Javaa. Perusmekanismeiltaan kielet kuitenkin poikkeavat radikaalisti. Java-taustalta tultaessa Javascriptin käyttäytyminen saattaa aiheuttaa hämmennystä, varsinkin jos kielen piirteistä ei viitsitä ottaa selvää.</p>

<p>Tietyissä piireissä on myös ollut suosittua yrittää “simuloida” Javascriptilla eräitä Javan piirteitä ja ohjelmointitapoja. En suosittele.</p>

<h3 id="muuttujat">Muuttujat</h3>

<p>Javascriptissä on muutama tapa määritellä muuttujia:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">5</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>  <span class="c1">// tulostuu 1, 5</span>
<span class="nx">y</span> <span class="o">+=</span> <span class="mi">10</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>  <span class="c1">// tulostuu 1, 15</span>
<span class="nx">y</span> <span class="o">=</span> <span class="s1">'teksti'</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>  <span class="c1">// tulostuu 1, teksti</span>
<span class="nx">x</span> <span class="o">=</span> <span class="mi">4</span>              <span class="c1">// aiheuttaa virheen</span>
</code></pre></div></div>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const">const</a> ei oikeastaan määrittele muuttujaa vaan <em>vakion</em>, jonka arvoa ei voi enää muuttaa. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let">let</a> taas määrittelee normaalin muuttujan.</p>

<p>Esimerkistä näemme myös, että muuttujan tallettaman tiedon tyyppi voi vaihtaa tyyppiä suorituksen aikana, <em>y</em> tallettaa aluksi luvun ja lopulta merkkijonon.</p>

<p>Javascriptissa on myös mahdollista määritellä muuttujia avainsanan <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var">var</a> avulla. Var oli pitkään ainoa tapa muuttujien määrittelyyn, const ja let tulivat kieleen mukaan vasta versiossa ES6. Var toimii tietyissä tilanteissa <a href="https://medium.com/craft-academy/javascript-variables-should-you-use-let-var-or-const-394f7645c88f">eri</a> <a href="http://www.jstips.co/en/javascript/keyword-var-vs-let/">tavalla</a> kuin useimpien muiden kielien muuttujien määrittely. Tällä kurssilla varin käyttö ei ole suositeltavaa eli käytä aina const:ia tai let:iä!</p>

<p>Lisää aiheesta esim. youtubessa <a href="https://youtu.be/sjyJBL5fkp8">var, let and const - ES6 JavaScript Features</a></p>

<h3 id="taulukot">Taulukot</h3>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">Taulukko</a> ja muutama esimerkki sen käytöstä</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="nx">t</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>  <span class="c1">// tulostuu 4</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>      <span class="c1">// tuostuu -1</span>

<span class="nx">t</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">luku</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">luku</span><span class="p">)</span>    <span class="c1">// tulostuu 1, -1, 3 ja 5 omille riveilleen</span>
<span class="p">})</span>

<span class="nx">t</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span>         <span class="c1">// tulostuu [ 1, -1, 3, 5, &lt;2 empty items&gt;, 99 ]</span>
</code></pre></div></div>

<p>Huomattavaa esimerkissä on se, että taulukon sisältöä voi muuttaa vaikka sen on määritelty <em>const</em>:ksi. Koska taulukko on olio,
viittaa muuttuja koko ajan samaan olioon. Olion sisältö muuttuu sitä mukaa kuin taulukkoon lisätään uusia alkioita.</p>

<p>Eräs tapa käydä taulukon alkiot läpi on esimerkissä käytetty <em>forEach</em>, joka saa parametrikseen nuolisyntaksilla määritellyn <em>funktion</em></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nx">luku</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">luku</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>forEach kutsuu funktiota <em>jokaiselle taulukon alkiolle</em> antaen taulukon alkion aina parametrina. forEachin parametrina oleva funktio voi saada myös <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach">muita parametreja</a>.</p>

<p>Taulukoille on määritelty runsaasti hyödyllisiä operaatioita. Katsotaan pieni esimerkki operaation <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a> käytöstä.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="kd">const</span> <span class="nx">m1</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">luku</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">luku</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">m1</span><span class="p">)</span> <span class="c1">// tulostuu 2, 4, 6, 8</span>

<span class="kd">const</span> <span class="nx">m2</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">luku</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s1">'&lt;li&gt;'</span> <span class="o">+</span> <span class="nx">luku</span> <span class="o">+</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">m2</span><span class="p">)</span> <span class="c1">// tulostuu [ '&lt;li&gt;1&lt;/li&gt;', '&lt;li&gt;2&lt;/li&gt;', '&lt;li&gt;3&lt;/li&gt;', '&lt;li&gt;4&lt;/li&gt;' ]</span>
</code></pre></div></div>

<p>Map siis muodostaa taulukon perusteella <em>uuden taulukon</em>, jonka jokainen alkio muodostetaan map:in parametrina olevan funktion avulla. Kuten tulemme kurssin <a href="/osa2">osassa2</a> näkemään, mapia käytetään Reactissa todella usein.</p>

<p>Taulukon yksittäisiä alkioita on helppo sijoittaa muuttujiin <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">destrukturoivan</a> sijoituslauseen avulla:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="kd">const</span> <span class="p">[</span><span class="nx">eka</span><span class="p">,</span> <span class="nx">toka</span><span class="p">,</span> <span class="p">...</span><span class="nx">loput</span><span class="p">]</span> <span class="o">=</span> <span class="nx">t</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">eka</span><span class="p">,</span> <span class="nx">toka</span><span class="p">)</span>      <span class="c1">// tulostuu 1, 2</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">loput</span><span class="p">)</span>          <span class="c1">// tulostuu [3, 4 ,5]</span>
</code></pre></div></div>

<p>Eli muuttujiin <em>eka</em> ja <em>toka</em> tulee sijoituksen ansiosta taulukon kaksi ensimmäistä lukua. Muuttujaan <em>loput</em> “kerätään” sijoituksesta jäljellejääneet luvut omaksi taulukoksi.</p>

<h3 id="oliot">Oliot</h3>

<p>Javasriptissa on muutama tapa määritellä olioita. Erittäin yleisesti käytetään <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Grammar_and_types#Object_literals">olioliteraaleja</a>, eli määritellään olio luettelemalla sen kentät (englanniksi property) aaltosulkeiden sisällä:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">olio1</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">ika</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
  <span class="na">koulutus</span><span class="p">:</span> <span class="s1">'Filosofian tohtori'</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">olio2</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Full Stack -websovelluskehitys'</span><span class="p">,</span>
  <span class="na">taso</span><span class="p">:</span> <span class="s1">'aineopinto'</span><span class="p">,</span>
  <span class="na">laajuus</span><span class="p">:</span> <span class="mi">5</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">olio3</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">etunimi</span><span class="p">:</span> <span class="s1">'Jami'</span><span class="p">,</span>
    <span class="na">sukunimi</span><span class="p">:</span> <span class="s1">'Kousa'</span>
  <span class="p">},</span>
  <span class="na">arvosanat</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
  <span class="na">laitos</span><span class="p">:</span> <span class="s1">'TKTL'</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Kenttien arvot voivat olla tyypiltään mitä vaan, lukuja, merkkijonoja, taulukoita, olioita…</p>

<p>Olioiden kenttiin viitataan pistenotaatiolla, tai hakasulkeilla:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">olio1</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>          <span class="c1">// tulostuu Arto Hellas</span>
<span class="kd">const</span> <span class="nx">kentanNimi</span> <span class="o">=</span> <span class="s1">'ika'</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">olio1</span><span class="p">[</span><span class="nx">kentanNimi</span><span class="p">])</span>   <span class="c1">// tulostuu 35</span>
</code></pre></div></div>

<p>Olioille voidaan lisätä kenttiä myös lennossa joko pistenotaation tai hakasulkeiden avulla:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">olio1</span><span class="p">.</span><span class="nx">osoite</span> <span class="o">=</span> <span class="s1">'Tapiola'</span>
<span class="nx">olio1</span><span class="p">[</span><span class="s1">'salainen numero'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12341</span>
</code></pre></div></div>

<p>Jälkimäinen lisäyksistä on pakko tehdä hakasulkeiden avulla, sillä pistenotaatiota käytettäessä ‘salainen numero’ ei kelpaa kentän nimeksi.</p>

<p>Javascriptissä olioilla voi luonnollisesti olla myös metodeja. Palaamme aiheeseen funktioiden käsittelyn jälkeen.</p>

<p>Olioita on myös mahdollista määritellä ns. konstruktorifunktioiden avulla, jolloin saadaan aikaan hieman monien ohjelmointikielten, esim. Javan luokkia (class) muistuttava mekanismi. Javascriptissä ei kuitenkaan ole luokkia samassa mielessä kuin olio-ohjelmointikielissä. Kieleen on kuitenkin lisätty versiosta ES6 alkaen <em>luokkasyntaksi</em>, joka helpottaa tietyissä tilanteissa olio-ohjelmointikielimäisten luokkien esittämistä. Palaamme asiaan hetken kuluttua.</p>

<p>Reactissa konstruktorifunktioihin perustuvalle olioiden määrittelyyn ei ole kovin usein tarvetta, joten sivuutamme sen tällä kurssilla.</p>

<h3 id="funktiot">Funktiot</h3>

<p>Olemme jo tutustuneet ns. nuolifunktioiden määrittelyyn. Täydellinen eli “pitkän kaavan” mukaan menevä tapa nuolifunktion määrittelyyn on seuraava</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">summa</span> <span class="o">=</span> <span class="p">(</span><span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p1</span><span class="p">)</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p2</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">p1</span> <span class="o">+</span> <span class="nx">p2</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ja funktiota kutsutaan kuten olettaa saattaa</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">vastaus</span> <span class="o">=</span> <span class="nx">summa</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">vastaus</span><span class="p">)</span>
</code></pre></div></div>

<p>Jos parameteja on vain yksi, voidaan sulut jättää määrittelystä pois:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">nelio</span> <span class="o">=</span> <span class="nx">p</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">p</span> <span class="o">*</span> <span class="nx">p</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Jos funktio sisältää ainoastaan yhden lausekkeen, ei aaltosulkeita tarvita. Tällöin funktio palauttaa ainoan lausekkeensa arvon. Eli edellinen voitaisiin ilmaista lyhyemmin seuraavasti:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">nelio</span> <span class="o">=</span> <span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span> <span class="o">*</span> <span class="nx">p</span>
</code></pre></div></div>

<p>Tämä muoto on erityisen kätevä käsiteltäessä taulukkoja esim. map-metodin avulla:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="kd">const</span> <span class="nx">tnelio</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span> <span class="o">*</span> <span class="nx">p</span><span class="p">)</span>
<span class="c1">// tnelio on nyt [1, 4, 9]</span>
</code></pre></div></div>

<p>Nuolifunktio on tullut Javascriptiin vasta muutama vuosi sitten version <a href="http://es6-features.org/">ES6</a> myötä. Tätä ennen ja paikoin nykyäänkin funktioiden määrittely tapahtui avainsanan <em>function</em> avulla.</p>

<p>Määrittelytapoja on kaksi, funktiolle voidaan antaa <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/function">function declaration</a> -tyyppisessä määrittelyssä <em>nimi</em> jonka avulla funktioon voidaan viitata:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">tulo</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">a</span> <span class="o">*</span> <span class="nx">b</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">vastaus</span> <span class="o">=</span> <span class="nx">tulo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</code></pre></div></div>

<p>Toinen tapa on tehdä määrittely <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/function">funktiolausekkeena</a>. Tällöin funktiolle ei tarvitse antaa nimeä ja määrittely voi sijaita muun koodin seassa:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">keskiarvo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">vastaus</span> <span class="o">=</span> <span class="nx">keskiarvo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="tehtäviä-javascriptistä">Tehtäviä javascriptistä</h3>

<p>Tee nyt <a href="/tehtävät#javascriptin-alkeet">tehtävät 1.3-1.5</a></p>

<h3 id="olioiden-metodit-ja-this">Olioiden metodit ja this</h3>

<p>Kaikille kolmelle tavalle määritellä funktio on oma paikkansa.</p>

<p>Nuolifunktiot ja avainsanan <em>function</em> avulla määritellyt funktiot kuitenkin poikkeavat radikaalisti siitä miten ne käyttäytyvät avainsanan <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this">this</a> suhteen.</p>

<p>Voimme liittää oliolle metodeja määrittelemällä niille kenttiä, jotka ovat funktioita:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">ika</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
  <span class="na">koulutus</span><span class="p">:</span> <span class="s1">'Filosofian tohtori'</span><span class="p">,</span>
  <span class="na">tervehdi</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">()</span>  <span class="c1">// tulostuu hello, my name is Arto Hellas</span>
</code></pre></div></div>

<p>metodeja voidaan liittää olioille myös niiden luomisen jälkeen:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">ika</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
  <span class="na">koulutus</span><span class="p">:</span> <span class="s1">'Filosofian tohtori'</span><span class="p">,</span>
  <span class="na">tervehdi</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">arto</span><span class="p">.</span><span class="nx">vanhene</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">ika</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arto</span><span class="p">.</span><span class="nx">ika</span><span class="p">)</span>  <span class="c1">// tulostuu 35</span>
<span class="nx">arto</span><span class="p">.</span><span class="nx">vanhene</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arto</span><span class="p">.</span><span class="nx">ika</span><span class="p">)</span>  <span class="c1">// tulostuu 36</span>
</code></pre></div></div>

<p>Muutetaan oliota hiukan</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">tervehdi</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="na">laskeSumma</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">arto</span><span class="p">.</span><span class="nx">laskeSumma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>   <span class="c1">// tulostuu 5</span>

<span class="kd">const</span> <span class="nx">viiteSummaan</span> <span class="o">=</span> <span class="nx">arto</span><span class="p">.</span><span class="nx">laskeSumma</span>
<span class="nx">viiteSummaan</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>   <span class="c1">// tulostuu 25</span>
</code></pre></div></div>

<p>Oliolla on nyt metodi <em>laskeSumma</em>, joka osaa laskea parametrina annettujen lukujen summan. Metodia voidaan kutsua normaaliin tapaan olion kautta <code>arto.laskeSumma(1, 4)</code> tai tallettamalla <em>metodiviite</em> muuttujaan ja kutsumalla metodia muuttujan kautta <code>viiteSummaan(10, 15)</code>.</p>

<p>Jos yritämme samaa metodille <em>tervehdi</em>, aiheutuu ongelmia:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">tervehdi</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="na">laskeSumma</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">()</span>        <span class="c1">// tulostuu hello, my name is Arto Hellas</span>

<span class="kd">const</span> <span class="nx">viiteTervehdykseen</span> <span class="o">=</span> <span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span>
<span class="nx">viiteTervehdykseen</span><span class="p">()</span>   <span class="c1">// tulostuu hello, my name is undefined</span>
</code></pre></div></div>

<p>Kutsuttaessa metodia viitteen kautta, on metodi kadottanut tiedon siitä mikä oli alkuperäinen <em>this</em>. Toisin kuin melkein kaikissa muissa kielissä, Javascriptissa <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this">this</a>:n arvo määrittyy sen mukaan <em>miten metodia on kutsuttu</em>. Kutsuttaessa metodia viitteen kautta, <em>this</em>:in arvoksi tulee ns. <a href="https://developer.mozilla.org/en-US/docs/Glossary/Global_object">globaali objekti</a> ja lopputulos ei ole yleensä ollenkaan se, mitä sovelluskehittäjä olettaa.</p>

<p>This:in kadottaminen aiheuttaa Reactilla ja Node.js:lla ohjelmoidessa monia potentiaalisia ongelmia. Eteen tulee erittäin usein tilanteita, missä Reactin/Noden (oikeammin ilmaistuna selaimen Javascript-moottorin) tulee kutsua joitain käyttäjän määrittelemien olioiden metodeja. Tälläinen tilanne tulee esim. jos pyydetään Artoa tervehtimään sekunnin kuluttua metodia <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout">setTimeout</a> hyväksikäyttäen.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">nimi</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">tervehdi</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></div>

<p>Javascriptissa this:in arvo siis määräytyy siitä miten metodia on kutsuttu. setTimeoutia käytettäessä metodia kutsuu Javascript-moottori ja this viittaa Timeout-olioon.</p>

<p>On useita mekanismeja, joiden avulla alkuperäinen <em>this</em> voidaan säilyttää, eräs näistä on metodin <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">bind</a> käyttö:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">arto</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></div>

<p>Komento <code>arto.tervehdi.bind(arto)</code> luo uuden funktion, missä se on sitonut <em>this</em>:in tarkoittamaan Artoa riippumatta siitä missä ja miten metodia kutsutaan.</p>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions">Nuolifunktioiden</a> avulla on mahdollista ratkaista eräitä this:iin liittyviä ongelmia. Olioiden metodeina niitä ei kuitenkaan kannata käyttää, sillä silloin <em>this</em> ei toimi ollenkaan. Palaamme nuolifunktioiden this:in käyttäytymiseen myöhemmin.</p>

<p>Jos haluat ymmärtää paremmin javascriptin <em>this</em>:in toimintaa, löytyy internetistä runsaasti materiaalia aiheesta. Esim. <a href="https://egghead.io">egghead.io</a>:n 20 minuutin screencastsarja <a href="https://egghead.io/courses/understand-javascript-s-this-keyword-in-depth">Understand JavaScript’s this Keyword in Depth</a> on erittäin suositeltava!</p>

<h3 id="luokat">Luokat</h3>

<p>Kuten aiemmin mainittiin, Javascriptissä ei ole olemassa olio-ohjelmointikielten luokkamekanismia. Javascriptissa on kuitenkin ominaisuuksia, jotka mahdollistavat olio-ohjelmoinnin <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes">luokkien</a> “simuloinnin”. Emme mene nyt sen tarkemmin Javascriptin olioiden taustalla olevaan <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">prototyyppiperintämekanismiin</a>.</p>

<p>Tutustumme kuitenkin pikaisesti ES6:n myötä Javascriptiin tulleeseen <em>luokkasyntaksiin</em>, joka helpottaa oleellisesti luokkien (tai luokan kaltaisten asioiden) määrittelyä Javascriptissa.</p>

<p>Seuraavassa on määritelty “luokka” Henkilö ja sille kaksi Henkilö-oliota:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Henkilo</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">nimi</span><span class="p">,</span> <span class="nx">ika</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span> <span class="o">=</span> <span class="nx">nimi</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">ika</span> <span class="o">=</span> <span class="nx">ika</span>
  <span class="p">}</span>
  <span class="nx">tervehdi</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello, my name is'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">nimi</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">arto</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Henkilo</span><span class="p">(</span><span class="s1">'Arto Hellas'</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
<span class="nx">arto</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">()</span>

<span class="kd">const</span> <span class="nx">jami</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Henkilo</span><span class="p">(</span><span class="s1">'Jami Kousa'</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="nx">jami</span><span class="p">.</span><span class="nx">tervehdi</span><span class="p">()</span>
</code></pre></div></div>

<p>Syntaksin osalta luokat ja niistä luodut oliot muistuttavat erittäin paljon esim. Javan olioita. Käyttäytymiseltäänkin ne ovat aika lähellä Javan olioita. Perimmiltään kyseessä on kuitenkin edelleen Javascriptin <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Inheritance">prototyyppiperintään</a> perustuvista olioista. Molempien olioiden todellinen tyyppi on <em>Object</em> sillä Javascriptissä ei perimmiltään ole muita tyyppejä kuin <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures">Boolean, Null, Undefined, Number, String, Symbol ja Object</a></p>

<p>Luokkasyntaksin tuominen Javascriptiin on osin kiistelty lisäys, ks. esim. <a href="https://github.com/joshburgess/not-awesome-es6-classes">Not Awesome: ES6 Classes</a> tai <a href="https://medium.com/@rajaraodv/is-class-in-es6-the-new-bad-part-6c4e6fe1ee65">Is “Class” In ES6 The New “Bad” Part?</a></p>

<p>ES6:n luokkasyntaksia käytetään kuitenkin paljon Reactissa ja Node.js:ssä ja siksi mekin käytämme sitä sopivissa määrin. Olio-ohjelmointimainen luokkahierarkioiden luominen ei kuitenkaan ole Reactin eikä tämän kurssin suositeltavan hengen mukaista. Reactia ohjelmoitaessa pyritään enemmän funktionaaliseen ohjelmointityyliin.</p>

<h3 id="javascript-materiaalia">Javascript-materiaalia</h3>

<p>Javascriptistä löytyy verkosta suuret määrät sekä hyvää että huonoa materiaalia. Tällä sivulla lähes kaikki Javascriptin ominaisuuksia käsittelevät linkit ovat <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">Mozillan javascript -materiaaliin</a>.</p>

<p>Mozillan sivuilta kannattaa lukea oikeastaan välittömästi <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/A_re-introduction_to_JavaScript">A re-introduction to JavaScript (JS tutorial)</a>.</p>

<p>Jos haluat tutustua todella syvällisesti Javascriptiin, löytyy internetistä ilmaiseksi mainio kirjasarja <a href="https://github.com/getify/You-Dont-Know-JS">You-Dont-Know-JS</a></p>

<p><a href="https://egghead.io">egghead.io</a>:lla on tarjolla runsaasti laadukkaita screencasteja Javascriptista, Reactista ym. kiinnostavasta. Valitettavasti materiaali on osittain maksullista.</p>

<h2 id="paluu-reactin-äärelle">Paluu Reactin äärelle</h2>

<p>Palataan jälleen Reactin pariin.</p>

<p>Aiemmassa esimerkissämme käytimme <a href="https://reactjs.org/docs/components-and-props.html#functional-and-class-components">funktionaalisia</a> komponentteja, eli määrittelimme kaikki komponentit nuolifunktioiden avulla, esim:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Hello</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span><span class="si">}</span> years old<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Toinen tapa komponenttien määrittelyyn on käyttää luokkasyntaksia. Tällöin komponentti määritellään luokaksi, joka perii <a href="https://reactjs.org/docs/react-component.html">React.Component</a>-luokan.</p>

<p>Muutetaan esimerkkisovelluksen komponentti <em>Hello</em> -luokaksi seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Hello</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span><span class="si">}</span> years old<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Luokkakomponenttien tulee määritellä ainakin metodi <em>render</em>, joka palauttaa komponentin ulkoasun määrittelevät React-elementit eli käytännössä JSX:n.</p>

<p>Luokkakomponentissa viitataan komponentin <em>propseihin</em> this-viitteen kautta.
Eli koska komponenttia käytetään seuraavasti</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Hello</span> <span class="na">name=</span><span class="s">"Arto"</span> <span class="na">age=</span><span class="s">{36}</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>päästään nimeen ja ikään käsiksi luokkamuotoisen komponentin sisällä viittaamalla <em>this.props.name</em> ja <em>this.props.age</em>. Huomaa ero funktionaaliseen komponenttiin!</p>

<p>Luokkakomponenteille voidaan tarvittaessa määritellä muitakin metodeja ja “oliomuuttujia”, eli kenttiä.</p>

<p>Voisimme esim. määritellä metodin seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Hello</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">bornYear</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">yearNow</span> <span class="o">=</span> <span class="mi">1900</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getYear</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">yearNow</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
          Hello <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span><span class="si">}</span> years old <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
          So you were propably born <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">bornYear</span><span class="p">()</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Metodia kutsutaan render:in sisältä käyttäen <em>this</em>-viitettä syntaksilla <code>this.bornYear()</code>.</p>

<p>Tässä tilanteessa ei kuitenkaan ole varsinaisesti mitään hyötyä määritellä apufunktiota <em>bornYear</em> metodiksi, joten parempi olisi määritellä se metodin <em>render</em> sisäisenä apumetodina:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Hello</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">bornYear</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">yearNow</span> <span class="o">=</span> <span class="mi">1900</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getYear</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">yearNow</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
          Hello <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span><span class="si">}</span> years old <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
          So you were propably born <span class="si">{</span><span class="nx">bornYear</span><span class="p">()</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Huomaa, että nyt metodia <em>ei</em> kutsuta viitteen <em>this</em> kautta, vaan syntaksilla <code>bornYear()</code>, sillä metodi ei ole komponentin eli <em>this</em>:in tasolla määritelty. Metodia <em>bornYear</em> ei nyt voi kutsua mistään muualta kuin metodin <em>render</em> sisältä, sillä se ei näy renderin ulkopuolelle.</p>

<p>Ennen kuin siirrymme eteenpäin, tarkastellaan erästä pientä, mutta käyttökelpoista ES6:n mukanaan tuomaa uutta piirrettä Javascriptissä, eli sijoittamisen yhteydessä tapahtuvaa <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">destrukturointia</a>.</p>

<p>Jouduimme äskeisessä koodissa viittaamaan propseina välitettyyn dataan hieman ikävästi muodossa <em>this.props.name</em> ja <em>this.props.age</em>. Näistä <em>this.props.age</em> pitää toistaa metodissa <em>render</em> kahteen kertaan.</p>

<p>Koska <em>this.props</em> on nyt olio</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">props</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">age</span><span class="p">:</span> <span class="mi">35</span>
<span class="p">}</span>
</code></pre></div></div>

<p>voimme suoraviivaistaa metodia <em>render</em> siten, että sijoitamme kenttien arvot muuttujiin <em>name</em> ja <em>age</em> jonka jälkeen niitä on mahdollista käyttää koodissa suoraan:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span>
  <span class="kd">const</span> <span class="nx">age</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">age</span>
  <span class="kd">const</span> <span class="nx">bornYear</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="mi">1900</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getYear</span><span class="p">()</span> <span class="o">-</span> <span class="nx">age</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        Hello <span class="si">{</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="nx">age</span><span class="si">}</span> years old <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
        So you were propably born <span class="si">{</span><span class="nx">bornYear</span><span class="p">()</span><span class="si">}</span>
      <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Huomaa, että olemme myös hyödyntäneet nuolifunktion kompaktimpaa kirjoitustapaa metodin <em>bornYear</em> määrittelyssä.</p>

<p>Destrukturointi tekee asian vielä helpommaksi, sen avulla voimme “kerätä” olion oliomuuttujien arvot suoraan omiin yksittäisiin muuttujiin:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Hello</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span>
    <span class="kd">const</span> <span class="nx">bornYear</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="mi">1900</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getYear</span><span class="p">()</span> <span class="o">-</span> <span class="nx">age</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
          Hello <span class="si">{</span><span class="nx">name</span><span class="si">}</span>, you are <span class="si">{</span><span class="nx">age</span><span class="si">}</span> years old <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
          So you were propably born <span class="si">{</span><span class="nx">bornYear</span><span class="p">()</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Eli koska</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">props</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Arto Hellas'</span><span class="p">,</span>
  <span class="na">age</span><span class="p">:</span> <span class="mi">35</span>
<span class="p">}</span>
</code></pre></div></div>

<p>saa <code> const {name, age} = this.props</code> aikaan sen, että <em>name</em> saa arvon ‘Arto Hellas’ ja <em>age</em> arvon 35.</p>

<p>Komponentti <em>Hello</em> on oikeastaan luonteeltaan sellainen, että sitä ei ole järkevää määritellä luokkasyntaksilla. Reactin best practice onkin käyttää funktioiden avulla määriteltyjä komponentteja aina kuin mahdollista.</p>

<h3 id="sivun-uudelleenrenderöinti">Sivun uudelleenrenderöinti</h3>

<p>Toistaiseksi tekemämme sovellukset ovat olleet sellaisia, että kun niiden komponentit on kerran renderöity, niiden ulkoasua ei ole enää voinut muuttaa. Entä jos haluaisimme toteuttaa laskurin, jonka arvo kasvaa esim. ajan kuluessa tai nappien painallusten yhteydessä?</p>

<p>Aloitetaan seuraavasta rungosta:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span><span class="nx">counter</span><span class="p">}</span> <span class="o">=</span> <span class="nx">props</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">counter</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">value</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="p">&lt;</span><span class="nc">App</span> <span class="na">counter=</span><span class="si">{</span><span class="nx">counter</span><span class="si">}</span> <span class="p">/&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Sovelluksen juurikomponentille siis annetaan viite laskuriin. Juurikomponentti renderöi arvon ruudulle. Entä laskurin arvon muuttuessa? Jos lisäämme ohjelmaan esim. komennon</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></div>

<p>ei komponenttia kuitenkaan renderöidä uudelleen. Voimme saada komponentin uudelleenrenderöitymään kutsumalla uudelleen metodia <em>ReactDOM.render</em>, esim. seuraavasti</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span><span class="nx">counter</span><span class="p">}</span> <span class="o">=</span> <span class="nx">props</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">counter</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">counter</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">value</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">renderoi</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">App</span> <span class="na">counter=</span><span class="si">{</span><span class="nx">counter</span><span class="si">}</span> <span class="p">/&gt;,</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="nx">renderoi</span><span class="p">()</span>
<span class="nx">counter</span><span class="p">.</span><span class="nx">value</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nx">renderoi</span><span class="p">()</span>
<span class="nx">counter</span><span class="p">.</span><span class="nx">value</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nx">renderoi</span><span class="p">()</span>
</code></pre></div></div>

<p>Copypastea vähentämään on komponentin renderöinti kääritty funktioon <em>renderoi</em>.</p>

<p>Nyt komponentti renderöityy kolme kertaa, saaden ensin arvon 1, sitten 2 ja lopulta 3. 1 ja 2 tosin ovat ruudulla niin vähän aikaa, että niitä ei ehdi havaita.</p>

<p>Hieman mielenkiintoisempaan toiminnallisuuteen pääsemme tekemällä renderöinnin ja laskurin kasvatuksen toistuvasti sekunnin välein käyttäen <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval">SetInterval</a>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">renderoi</span><span class="p">()</span>
  <span class="nx">counter</span><span class="p">.</span><span class="nx">value</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></div>

<p><em>ReactDOM.render</em>-metodin toistuva kutsuminen ei kuitenkaan ole suositeltu tapa päivittää komponentteja. Tutustutaan seuraavaksi järkevämpään tapaan.</p>

<h3 id="tilallinen-komponentti">Tilallinen komponentti</h3>

<p>Muutetaan esimerkkisovelluksen komponentti <em>App</em> luokkaperustaiseksi:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="p">&lt;</span><span class="nc">App</span> <span class="p">/&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Komponentilla on nyt metodin <em>render</em> lisäksi <em>konstruktori</em>. Komponentin konstruktori saa parametrikseen sille välitettävät muuttujat parametrin <em>props</em> välityksellä, konstruktorin ensimmäisen rivin on oltava kutsu <code>super(props)</code>.</p>

<p>Luokkiin perustuvalla komponenteilla voi olla <em>tila</em>, joka talletetaan muuttujaan <em>state</em>.</p>

<p>Konstruktori määrittelee komponentin alkutilan olevan:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">counter</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Eli tila sisältää kentän <em>counter</em>, jonka arvo on 1. React-komponenttien tilaa, eli muuttujaa <em>this.state</em> <strong>ei saa päivittää suoraan</strong>, tilan päivitys on tehtävä <strong>aina</strong> funktion <a href="https://reactjs.org/docs/faq-state.html#what-does-setstate-do">setState</a> avulla. Metodin kutsuminen päivittää tilan <em>ja</em> aiheuttaa komponentin uuden renderöinnin (ellei sitä ole estetty myöhemmin esiteltävällä tavalla). Uudelleenrenderöinnin yhteydessä myös kaikki komponentin sisältämät alikomponentit renderöidään.</p>

<p>Muutetaan komponenttia <em>App</em> siten, että konstruktorissa käynnistetään ajastin, joka kutsuu funktiota <em>setState</em> toistuvasti sekunnin välein korottaen laskurin arvoa aina yhdellä:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>

    <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">})</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Ruudulle renderöity laskurin arvo päivittyy sillä aina komponenentin tilan muuttuessa <em>React</em> kutsuu komponentin metodia <em>render</em>.</p>

<p>Jos komponentti ei renderöidy vaikka sen omasta mielestä pitäisi, tai se renderöityy “väärään aikaan”, debuggaamista auttaa joskus metodiin <em>render</em> liitetty konsoliin tulostus. Esim. jos lisäämme koodiin seuraavan,</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'renderöidään'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>on konsolista helppo seurata metodin <em>render</em> kutsuja:</p>

<p><img src="http://localhost:4000/images/1/27a.png" alt="" /></p>

<h3 id="tapahtumankäsittely">Tapahtumankäsittely</h3>

<p>Mainitsimme jo <a href="/osa0">osassa 0</a> muutamaan kertaan <em>tapahtumankäsittelijät</em>, eli funktiot, jotka on rekisteröity kutsuttavaksi tiettyjen tapahtumien eli eventien yhteydessä. Esim. käyttäjän interaktio sivun elementtien kanssa aiheuttaa joukon erinäisiä tapahtumia.</p>

<p>Muutetaan sovellusta siten, että laskurin kasvaminen tapahtuukin käyttäjän painaessa <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button">button</a>-elementin avulla toteutettua nappia.</p>

<p>Button-elementit tukevat mm. <a href="https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent">hiiritapahtumia</a> (mouse events), joista yleisin on <a href="https://developer.mozilla.org/en-US/docs/Web/Events/click">click</a>.</p>

<p>Reactissa funktion rekisteröiminen tapahtumankäsittelijäksi tapahtumalle <em>click</em> <a href="https://reactjs.org/docs/handling-events.html">tapahtuu</a> seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">funktio</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* koodi */</span> <span class="p">}</span>

<span class="c1">//...</span>

<span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="nx">funktio</span><span class="si">}</span><span class="p">&gt;</span>
  plus
<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>Eli laitetaan <em>button</em>:in onClick-attribuutin arvoksi aaltosulkeissa oleva viite koodissa määriteltyyn funktioon.</p>

<p>Tapahtumankäsittelijäfunktio voidaan määritellä suoraan onClick-määrittelyn yhteydessä:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'clicked'</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
          plus
        <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Nyt jokainen napin <em>plus</em> painallus tulostaa konsoliin <em>clicked</em>.</p>

<p>Muuttamalla tapahtumankäsittelijä seuraavaan muotoon</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={()</span> <span class="o">=&gt;</span> this.setState<span class="o">({</span> counter: this.state.counter + 1 <span class="o">})}&gt;</span>
  plus
&lt;/button&gt;
</code></pre></div></div>

<p>saamme halutun toiminnallisuuden.</p>

<p>Lisätään sovellukseen myös nappi laskurin nollaamiseen:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">})</span><span class="si">}</span><span class="p">&gt;</span>
            plus
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span><span class="si">}</span><span class="p">&gt;</span>
            zero
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Sovelluksemme on valmis!</p>

<h3 id="metodien-käyttö-ja-this">Metodien käyttö ja <em>this</em></h3>

<p>Tapahtumankäsittelijöiden määrittely suoraan JSX-templatejen sisällä ei useimmiten ole kovin viisasta. Eriytetään nappien tapahtumankäsittelijä omaksi metodeikseen:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">kasvataYhdella</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">nollaa</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">kasvataYhdella</span><span class="si">}</span><span class="p">&gt;</span>
            plus
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">nollaa</span><span class="si">}</span><span class="p">&gt;</span>
            zero
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Komponentin määrittelemälle luokalle on nyt lisätty metodit <em>kasvataYhdella</em> ja <em>nollaa</em>. Metodeihin <em>viitataan</em> nappeja vastaavista React-elementeistä:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">kasvataYhdella</span><span class="p">}</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Kun testaamme nyt sovellusta, törmäämme ongelmaan. Virheilmoitus on erittäin hyvä:</p>

<p><img src="http://localhost:4000/assets/1/28.png" alt="" /></p>

<p>Eli törmäämme jo <a href="#olioiden-metodit-ja-this">aiemmin mainittuun</a> ongelmaan alkuperäisen <em>this</em>:in kadottamisesta.</p>

<p>Kun selaimen Javascriptin runtime kutsuu takaisinkutsufunktiota, <em>this</em> ei enää viittaa komponenttiin <em>App</em> vaan on arvoltaan <em>undefined</em> eli määrittelemätön:</p>

<p><img src="http://localhost:4000/assets/1/29.png" alt="" /></p>

<p>Ongelmaan on useita erilaisia ratkaisuja. Eräs näistä on jo <a href="#olioiden-metodit-ja-this">aiemmin mainittu</a> <em>bindaaminen</em>, eli esim. komennolla <code>this.kasvataYhdella.bind(this)</code> voimme muodostaa uuden funktion, jonka koodi on alkuperäisen funktion koodi, missä <em>this</em> on sidottu viittaamaan parametrina olevaan arvoon, eli komponenttiin itseensä.</p>

<p>Eli sovellus toimii taas jos koodi muutetaan muotoon:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">onClick=</span><span class="s">{this.kasvataYhdella.bind(this)}</span><span class="nt">&gt;</span>
  plus
<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">onClick=</span><span class="s">{this.nollaa.bind(this)}</span><span class="nt">&gt;</span>
  zero
<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>

<p>Jos samaa metodia joudutaan kutsumaan useasta kohtaa koodia, on hieman ikävää kirjoittaa toistuvasti metodin bindattu muoto React-elementtien sekaan.</p>

<p>Yksi mahdollisuus onkin suorittaa bindaukset konstruktorissa:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">kasvataYhdella</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">kasvataYhdella</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nollaa</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">nollaa</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Nyt riittää viitata metodeihin “normaalisti”, ilman bindiä:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">onClick=</span><span class="s">{this.kasvataYhdella}</span><span class="nt">&gt;</span>
  plus
<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">onClick=</span><span class="s">{this.nollaa}</span><span class="nt">&gt;</span>
  zero
<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>

<p>Teknisesti ottaen konstruktorissa korvataan kenttään <em>kasvataYhdella</em> alunperin määritelty metodi uudella metodilla, jolla on alkuperäisen metodin koodi siten, että <em>this</em> on pysyvästi bindattu komponenttiin.</p>

<p>Ehkä paras ratkaisu <em>this</em>-ongelman estämiseen on käyttää tulevaan Javascript-standardiin ehdotettua <a href="https://babeljs.io/docs/plugins/transform-class-properties/">class properties</a> -ominaisuutta, jonka avulla voimme määritellä this:in suhteen hyvin käyttäytyviä metodeja seuraavasti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">kasvataYhdella</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">nollaa</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Näin jokainen <em>App</em>-komponentti saa kentät <em>kasvataYhdella</em> ja <em>nollaa</em> jotka ovat funktioita, joiden <em>this</em> on sidottu komponenttiin riippumatta siitä miten ja kenen toimesta metodia kutsutaan.</p>

<p>Syy miksi nuolifunktiolla määritelty metodi toimii <em>this</em>:in suhteen samaan tapaan kuin esim. Javassa, on se, että nuolifunktioilla on ns. <em>leksikaalinen (lexical) this</em>, eli nuolifunktion <em>this</em> määräytyy sen määrittelykontekstin <em>this</em>:in mukaan. Kun metodi määritellään class propertynä, on määrittelykontekstina <em>App</em>-komponentti. Tarkempaa selitystä esim. <a href="https://medium.com/@reasoncode/javascript-es6-arrow-functions-and-lexical-this-f2a3e2a5e8c4">täällä</a>.</p>

<p>Käytämme kurssilla jatkossa tätä tapaa komponenttien metodien määrittelemiseen.</p>

<p><a href="https://babeljs.io/docs/plugins/transform-class-properties/">class propertyt</a> siis eivät ole vielä mukana uusimmassa javascript-standardissa eli kesäkuussa 2017 ilmestyneessä ES8:ssa. Voimme kuitenkin käyttää ominaisuutta create-react-app:illa luoduissa sovelluksissa, sillä <a href="https://babeljs.io/">babel</a> osaa kääntää (eli transpiloida) ominaisuuden selainten ymmärtämään muotoon.</p>

<p>Node.js ei oletusarvoisesti vielä tue ominaisuutta, eli kääntämätöntä koodia joka sisältää class propertyjä ei voi vielä suorittaa Node.js:llä.</p>

<h3 id="pari-huomiota-funktion-setstate-käytöstä">Pari huomiota funktion setState käytöstä</h3>

<p>Käytimme metodia <em>setState</em> kahteen kertaan:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">kasvataYhdella</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">})</span>
<span class="p">}</span>

<span class="nx">nollaa</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Näistä ensimmäinen tapa <code>this.setState({ counter: this.state.counter + 1 })</code> ei ole kaikissa tilanteissa suositeltava, sillä React ei takaa että metodin <em>setState</em> kutsut tapahtuvat <a href="https://reactjs.org/docs/state-and-lifecycle.html#state-updates-may-be-asynchronous">siinä järjestyksessä missä ne on kirjoitettu koodiin</a>.</p>

<p>Jos halutaan määritellä uusi tila olemassaolevan tilan perusteella, on varmempi kutsua <em>setState</em>:a seuraavasti:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">((</span><span class="nx">prevState</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">counter</span><span class="p">:</span> <span class="nx">prevState</span><span class="p">.</span><span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span>
<span class="p">}));</span>
</code></pre></div></div>

<p>Nyt metodin parametrina on funktio, jonka parametrina on edellinen tila <em>prevState</em> ja tilan päivitys tapahtuu varmuudella kutsuhetken edellisen tilan perusteella.</p>

<p>Emme nyt viitsi käyttää tätä monimutkaisempa muotoa, sillä emme välitä vaikka sovelluksessamme ilmenisikin silloin tällöin pieni epäkonsistenssi (on epäselvää olisiko se sovelluksessamme edes teoriassa mahdollista).</p>

<p>Asia tulee kuitenkin ehdottomasti pitää mielessä, <em>setState</em>:n vääränlainen käyttö saattaa aiheuttaa hankalasti löydettäviä, harvoin toistuvia bugeja.</p>

<p>Tärkeä mielessä pidettävä seikka on myös, se että <strong>React kutsuu funktiota setState asynkroonisesti</strong>, eli jos meillä on seuraava koodi</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="p">)</span>
<span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">counter</span><span class="p">:</span> <span class="mi">55</span><span class="p">})</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="p">)</span>
</code></pre></div></div>

<p>tulostavat molemmat rivit saman arvon sillä Reactin tila <strong>ei saa uutta arvoa</strong> heti komennon <em>this.setState</em> jälkeen, vaan vasta sitten, kun suorituksen alla oleva metodi on suoritettu loppuun ja <em>setState</em> on saanut mahdollisuuden suoritukselle.</p>

<h3 id="funktio-joka-palauttaa-funktion">Funktio joka palauttaa funktion</h3>

<p>Metodit <em>kasvataYhdella</em> ja <em>nollaa</em> toimivat melkein samalla tavalla, ne asettavat uuden arvon laskurille. Tehdään koodiin yksittäinen metodi, joka sopii molempiin käyttötarkoituksiin:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">asetaArvoon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arvo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="nx">arvo</span> <span class="p">})</span>
<span class="p">}</span>

<span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//...</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
    Plus
  <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
    Zero
  <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="c1">//...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Huomaamme kuitenkin että muutos hajottaa sovelluksemme täysin:</p>

<p><img src="http://localhost:4000/assets/1/30.png" alt="" /></p>

<p>Mistä on kyse? Tapahtumankäsittelijäksi on tarkoitus määritellä viite <em>funktioon</em>. Kun koodissa on</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="mi">0</span><span class="p">)}</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>tapahtumankäsittelijäksi tulee määriteltyä <em>funktiokutsu</em>. Sekin on monissa tilanteissa ok, mutta ei nyt, nimittäin kun React suorittaa metodin <em>render</em>, se suorittaa kutsun <code>this.asetaArvoon(0)</code>. Kutsu aiheuttaa metodin <em>setState</em> kutsun. Tämä taas aiheuttaa uuden <em>render</em>-kutsun jne…</p>

<p>Tässä tilanteessa meidän onkin käytettävä yleistä Javascriptin ja yleisemminkin funktionaalisen ohjelmoinnin kikkaa, eli määritellä <em>funktio joka palauttaa funktion</em>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">asetaArvoon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arvo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="nx">arvo</span> <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
            Plus
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
            Zero
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Jos et ole aiemmin törmännyt tekniikkaan, siihen totutteluun voi mennä tovi.</p>

<p>Olemme siis määritelleen komponentin metodin <em>asetaArvoon</em> seuraavasti:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">asetaArvoon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arvo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="nx">arvo</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Kun <em>render</em>-metodissa määritellään tapahtumankäsittelijä kutsumalla <code>this.asetaArvoon(0)</code>, on lopputuloksena</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>eli juuri oikeanlainen tilan nollaamisen aiheuttava funktio!</p>

<p>Plus-napin tapahtumankäsittelijä määritellään kutsumalla <code>this.asetaArvoon(this.state.counter + 1)</code>. Kun komponentti renderöidään ensimmäisen kerran, <em>this.state.counter</em> on saanut konstruktorissa arvon 1, eli plus-napin tapahtumankäsittelijäksi tulee metodikutsun <code>this.asetaArvoon(1 + 1)</code> tulos, eli funktio</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="mi">2</span> <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Vastaavasti, kun laskurin tila on esim 41, tulee plus-napin tapahtumakuuntelijaksi</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="mi">42</span> <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Tarkastellaan vielä hieman metodia <em>asetaArvoon</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">asetaArvoon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arvo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="nx">arvo</span> <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Koska metodi itse sisältää ainoastaan yhden komennon, eli <em>returnin</em>, joka palauttaa funktion, voidaan hyödyntää nuolifunktion tiiviimpää muotoa:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">asetaArvoon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arvo</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="nx">arvo</span> <span class="p">})</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Usein tälläisissä tilanteissa kaikki kirjoitetaan samalle riville, jolloin tuloksena on “kaksi nuolta sisältävä funktio”:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">asetaArvoon</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arvo</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="nx">arvo</span> <span class="p">})</span>
</code></pre></div></div>

<p>Kaksinuolisen funktion voi ajatella funktiona, jota lopullisen tuloksen saadakseen täytyy kutsua kaksi kertaa.</p>

<p>Ensimmäisellä kutsulla “konfiguroidaan” varsinainen funktio, sijoittamalla osalle parametreista arvo. Eli kutsu <code>asetaArvoon(5)</code> sitoo muuttujaan <em>arvo</em> arvon 5 ja funktiosta “jää jäljelle” seuraava funktio:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">counter</span><span class="p">:</span> <span class="mi">5</span> <span class="p">})</span>
</code></pre></div></div>

<p>Tässä näytetty tapa soveltaa funktioita palauttavia funktioita on oleellisesti sama asia mistä funktionaalisessa ohjelmoinnissa käytetään termiä <a href="http://www.datchley.name/currying-vs-partial-application/">currying</a>. Termi currying ei ole lähtöisin funktionaalisen ohjelmoinnin piiristä vaan sillä on juuret <a href="https://en.wikipedia.org/wiki/Currying">syvällä matematiikassa</a>.</p>

<p>Jo muutamaan kertaan mainittu termi <em>funktionaalinen ohjelmointi</em> ei ole välttämättä kaikille tässä vaiheessa tuttu. Asiaa avataan hiukan kurssin kuluessa, sillä React tukee ja osin edellyttää funktionaalisen tyylin käyttöä.</p>

<p><strong>HUOM:</strong> muutos, missä korvasimme metodit <em>kasvataArvoa</em> ja <em>nollaa</em> metodilla <em>asetaArvoon</em> ei välttämättä ole järkevä, sillä erikoistuneemmat metodit ovat paremmin nimettyjä. Teimme muutoksen oikeastaan ainoastaan demonstroidaksemme <em>currying</em>-tekniikan soveltamista.</p>

<h3 id="tilan-vieminen-alikomponenttiin">Tilan vieminen alikomponenttiin</h3>

<p>Reactissa suositaan pieniä komponentteja, joita on mahdollista uusiokäyttää monessa osissa sovellusta ja jopa useissa eri sovelluksessa. Refaktoroidaan koodiamme vielä siten, että yhden komponentin sijaan koostamme laskurin näytöstä ja kahdesta painikkeesta.</p>

<p>Tehdään ensin näytöstä vastaava komponentti <em>Display</em>.</p>

<p>Reactissa parhaana käytänteenä on sijoittaa tila <a href="https://reactjs.org/docs/lifting-state-up.html">mahdollisimman ylös</a> komponenttihierarkiassa, mielellään sovelluksen juurikomponenttiin.</p>

<p>Jätetään sovelluksen tila, eli laskimen arvo komponenttiin <em>App</em> ja välitetään tila <em>props</em>:ien avulla komponentille <em>Display</em>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Display</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Kyseessä on siis todella yksinkertainen komponentti joka kannattaa ehdottomasti määritellä funktion avulla eli funktionaalisena komponenttina.</p>

<p>Voimme hyödyntää aiemmin mainittua <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">destrukturointia</a> myös metodien parametreissa. Eli koska olemme kiinnostuneita <em>props</em>:in kentästä <em>counter</em>, on edellinen mahdollista yksinkertaistaa seuraavaan muotoon:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Display</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">counter</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Koska komponentin määrittelevä metodi ei sisällä muuta kuin returnin, voimme ilmaista sen hyödyntäen nuolifunktioiden tiiviimpää ilmaisumuotoa</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Display</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">counter</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">counter</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>Komponentin käyttö on suoraviivaista, riittää että sille välitetään laskurin tila eli <em>this.state.counter</em>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">Display</span> <span class="na">counter=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
            Plus
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
            Zero
          <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Kaikki toimii edelleen. Kun nappeja painetaan ja <em>App</em> renderöityy uudelleen, renderöityvät myös kaikki sen alikomponentit, siis myös <em>Display</em> automaattisesti uudelleen.</p>

<p>Tehdään seuraavaksi napeille tarkoitettu komponentti <em>Button</em>. Napille on välitettävä propsien avulla tapahtumankäsittelijä sekä napin teksti:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Button</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">handleClick</span><span class="si">}</span><span class="p">&gt;</span>
    <span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">text</span><span class="si">}</span>
  <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">)</span>
</code></pre></div></div>

<p>ja hyödynnetään taas destrukturointia ottamaan <em>props</em>:in tarpeelliset kentät suoraan:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Button</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">handleClick</span><span class="p">,</span> <span class="nx">text</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="nx">handleClick</span><span class="si">}</span><span class="p">&gt;</span>
    <span class="si">{</span><span class="nx">text</span><span class="si">}</span>
  <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Komponentin <em>App</em> metodi <em>render</em> muuttuu nyt muotoon:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Display</span> <span class="na">counter=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span><span class="si">}</span><span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nc">Button</span>
          <span class="na">handleClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span>
          <span class="na">text=</span><span class="s2">"Plus"</span>
        <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">Button</span>
          <span class="na">handleClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">counter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span>
          <span class="na">text=</span><span class="s2">"Minus"</span>
        <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nc">Button</span>
          <span class="na">handleClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">asetaArvoon</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span>
          <span class="na">text=</span><span class="s2">"Zero"</span>
        <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Koska meillä on nyt uudelleenkäytettävä nappi, sovellukselle on lisätty uutena toiminnallisuutena nappi, jolla laskurin arvoa voi vähentää.</p>

<p>Tapahtumankäsittelijä välitetään napeille propsin <em>handleClick</em> välityksellä. Propsin nimellä ei ole sinänsä merkitystä, mutta valinta ei ollut täysin sattumanvarainen, esim. Reactin <a href="https://reactjs.org/tutorial/tutorial.html">tutoriaali</a> suosittelee tätä konventiota.</p>

<h3 id="monimutkaisemman-tilan-päivittäminen">Monimutkaisemman tilan päivittäminen</h3>

<p>Tarkastellaan sovellusta, jonka tila on hieman monimutkaisempi:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">vasen</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">oikea</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">klikVasen</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="na">vasen</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">vasen</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">klikOikea</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="na">oikea</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">oikea</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">vasen</span><span class="si">}</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">klikVasen</span><span class="si">}</span><span class="p">&gt;</span>vasen<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">klikOikea</span><span class="si">}</span><span class="p">&gt;</span>oikea<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
          <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">oikea</span><span class="si">}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Tilassa on siis kaksi kenttää, <em>vasen</em> ja <em>oikea</em> jotka laskevat vastaavien nappien painalluksia.</p>

<p>Kun tilaa päivitetään, riittää asettaa ainoastaan muuttuvan kentän arvo, sillä React <a href="https://reactjs.org/docs/state-and-lifecycle.html#state-updates-are-merged">lomittaa</a> tai “mergeää” muutokset olemassaolevaan tilaan.</p>

<p>Eli kun päivitämme esim. vasemman napin painalluksia, riittää seuraava koodi</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">klikVasen</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
    <span class="na">vasen</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">vasen</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>tilassa oleva kenttä <em>oikea</em> jää muutoksen yhteydessä ennalleen.</p>

<h3 id="taulukon-käsittelyä">Taulukon käsittelyä</h3>

<p>Tehdään sovellukseen vielä laajennus, lisätään tilaan taulukko <em>kaikki</em> joka muistaa kaikki näppäimenpainallukset.</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">vasen</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">oikea</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">kaikki</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">klikVasen</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="na">vasen</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">vasen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">kaikki</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">kaikki</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="s1">'v'</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">klikOikea</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="na">oikea</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">oikea</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">kaikki</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">kaikki</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="s1">'o'</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">historia</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">kaikki</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">vasen</span><span class="si">}</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">klikVasen</span><span class="si">}</span><span class="p">&gt;</span>vasen<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">klikOikea</span><span class="si">}</span><span class="p">&gt;</span>oikea<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
          <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">oikea</span><span class="si">}</span>
          <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">historia</span><span class="p">()</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Kun esim. nappia <em>vasen</em> painetaan, lisätään tilan taulukkoon <em>kaikki</em> kirjain <em>v</em>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">klikVasen</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
    <span class="na">vasen</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">vasen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="na">kaikki</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">kaikki</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="s1">'v'</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Tilan kenttä <em>kaikki</em> saa nyt arvokseen entisen tilan, mihin on liitetty <em>v</em> metodilla <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/concat">concat</a>, joka toimii siten, että se ei muuta olemassaolevaa taulukkoa vaan luo <em>uuden taulukon</em>, mihin uusi alkio on lisätty.</p>

<p>Javascriptissa on myös mahdollista lisätä taulukkoon metodilla <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/push">push</a> ja sovellus näyttäisi tässä tilanteessa toimivan myös jos lisäys tapahtuisi komennolla</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">kaikki</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">kaikki</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">'v'</span><span class="p">)</span>
</code></pre></div></div>

<p>mutta älä tee niin. React-komponentin tilaa, eli muuttujaa <em>this.state</em> ei saa muuttaa suoraan!</p>

<p><strong>Jos tilan kentissä on olioita, älä muuta niitä vaan tee muutos aina kopioon!</strong></p>

<p>Katsotaan vielä tarkemmin, miten kaikkien painallusten historia renderöidään ruudulle:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">historia</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">kaikki</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">vasen</span><span class="si">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">klikVasen</span><span class="si">}</span><span class="p">&gt;</span>vasen<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">klikOikea</span><span class="si">}</span><span class="p">&gt;</span>oikea<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">oikea</span><span class="si">}</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="si">{</span><span class="nx">historia</span><span class="p">()</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Metodiin <em>render</em> on nyt määritelty apufunktio:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">historia</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">kaikki</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
</code></pre></div></div>

<p>Taulukon <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join">join</a>-metodilla muodostetaan taulukosta merkkijono, joka sisältää taulukon alkiot erotettuna välilyönnillä.</p>

<h3 id="ehdollinen-renderöinti">Ehdollinen renderöinti</h3>

<p>Muutetaan apufunktiota hiukan:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">historia</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">kaikki</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">em</span><span class="p">&gt;</span>sovellusta käytetään nappeja painelemalla<span class="p">&lt;/</span><span class="nt">em</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      näppäilyhistoria: <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">kaikki</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Nyt funktion palauttama sisältö riippuu siitä, onko näppäimiä jo painettu. Jos ei, eli taulukko <code>this.state.kaikki</code> on tyhjä, palauttaa metodi “käyttöohjeen” sisältävän elementin</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div&gt;</span>
  <span class="nt">&lt;em&gt;</span>sovellusta käytetään nappeja painelemalla<span class="nt">&lt;/em&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>ja muussa tapauksessa näppäilyhistorian:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div&gt;</span>
  näppäilyhistoria: {this.state.kaikki.join(' ')}
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Komponentin <em>App</em> ulkoasun muodostomat React-elementit siis ovat erilaisia riippuen sovelluksen tilasta, eli komponentissa on <em>ehdollista renderöintiä</em>.</p>

<p>Reactissa on monia muitakin tapoja <a href="https://reactjs.org/docs/conditional-rendering.html">ehdolliseen renderöintiin</a>. Katsotaan niitä tarkemmin <a href="/osa2">seuraavassa osassa</a>.</p>

<p>Näppäilyhistorian esittäminen alkaa olla jo sen verran monimutkainen operaatio, että se kannattaisi eristää omaksi komponentikseen. Jätämme sen kuitenkin tekemättä.</p>

<h2 id="funktionaalinen-vai-luokkasyntaksiin-perustuva-komponentti">Funktionaalinen vai luokkasyntaksiin perustuva komponentti?</h2>

<p>Olemme nyt esitelleet kaksi erilaista tapaa komponenttien määrittelemiseen. Kumpaa tulisi käyttää? Useimpien vastauksena on, <a href="https://hackernoon.com/react-stateless-functional-components-nine-wins-you-might-have-overlooked-997b0d933dbc">käytä funktionaalista komponenttia aina kun se on mahdollista</a>.</p>

<p>Jos komponentti tarvitsee tilaa, on luokkasyntaksin käyttäminen välttämätöntä. Kannattaa kuitenkin muistaa, että Reactin filosofian mukaista on sijoittaa tila <a href="https://reactjs.org/docs/lifting-state-up.html">mahdollisimman ylös</a> komponenttihierarkiaan, mielellään ainoastaan sovelluksen juurikomponenttiin. Näin tilallisten komponenttien potentiaalinen tarvekin on vähäisempi.</p>

<p>Joskus komponenttien on käytettävä <a href="/osa2#komponenttien-lifecycle-metodit">osassa 2 esiteltäviä</a> lifecycle-metodeja, myös niissä tapauksissa on pakko käyttää luokkiin perustuvia komponentteja.</p>

<p>Yleisohjeena on siis se, että käytä funktionaalisia komponentteja ellet aivan pakosti tarvitse jotain luokkasyntaksin omaavien komponenttien ominaisuuksia.</p>

<p>Internetistä löytyy kyllä aiheesta päinvastaisiakin mielipiteitä, esim. <a href="https://medium.freecodecamp.org/7-reasons-to-outlaw-reacts-functional-components-ff5b5ae09b7c">7 Reasons to Outlaw React’s Functional Components</a></p>

<h2 id="react-sovellusten-debuggaus">React-sovellusten debuggaus</h2>

<p>Ohjelmistokehittäjän elämä koostuu pääosin debuggaamisesta (ja olemassaolevan koodin lukemisesta). Silloin tällöin syntyy toki muutama rivi uuttakin koodia, mutta suuri osa ajasta ihmetellään miksi joku on rikki tai miksi joku asia ylipäätään toimii. Hyvät debuggauskäytänteet ja työkalut ovatkin todella tärkeitä.</p>

<p>Onneksi React on debuggauksen suhteen jopa harvinaisen kehittäjäystävällinen kirjasto.</p>

<p>Muistutetaan vielä tärkeimmästä web-sovelluskehitykseen liittyvästä asiasta:</p>

<div class="important">
  <h3>Web-sovelluskehityksen sääntö numero yksi</h3>
  <div>Pidä selaimen developer-konsoli koko ajan auki.</div>
  <br />
  <div>Välilehdistä tulee olla auki nimenomaan <em>Console</em> jollei ole erityistä syytä käyttää jotain muuta välilehteä.
  </div>
</div>

<p>Pidä myös koodi ja web-sivu <strong>koko ajan</strong> molemmat yhtä aikaa näkyvillä.</p>

<p>Jos ja kun koodi ei käänny, eli selaimessa alkaa näkyä punaista</p>

<p><img src="http://localhost:4000/assets/1/31.png" alt="" /></p>

<p>älä kirjota enää lisää koodia vaan selvitä ongelma <strong>välittömästi</strong>. Koodauksen historia ei tunne tilannetta, missä kääntymätön koodi alkaisi ihmeenomaisesti toimimaan kirjoittamalla suurta määrää lisää koodia, en usko että sellaista ihmettä nähdään tälläkään kurssilla.</p>

<p>Vanha kunnon printtaukseen perustuva debuggaus kannattaa aina. Eli jos esim. komponentissa</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Button</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">handleClick</span><span class="p">,</span> <span class="nx">text</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="nx">handleClick</span><span class="si">}</span><span class="p">&gt;</span>
    <span class="si">{</span><span class="nx">text</span><span class="si">}</span>
  <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">)</span>
</code></pre></div></div>

<p>olisi jotain ongelmia, kannattaa komponentista alkaa printtailla konsoliin. Pystyäksemme printtaamaan, tulee funktio muuttaa pitempään muotoon ja propsit kannattaa kenties vastaanottaa ilman destrukturointia:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Button</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">handleClick</span><span class="p">,</span> <span class="nx">text</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">props</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="nx">handleClick</span><span class="si">}</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">text</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>näin selviää heti onko esim. joku propsia vastaava attribuutti nimetty väärin komponenttia käytettäessä.</p>

<p><strong>HUOM</strong> kun käytät komentoa <em>console.log</em> debuggaukseen, älä yhdistele asioita “javamaisesti” plussalla, eli sen sijaan että kirjoittaisit</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'propsin arvo on'</span> <span class="o">+</span> <span class="nx">props</span><span class="p">)</span>
</code></pre></div></div>

<p>erottele tulostettavat asiat pilkulla:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'propsin arvo on'</span><span class="p">,</span> <span class="nx">props</span><span class="p">)</span>
</code></pre></div></div>

<p>Jos yhdistät merkkijonoon olion, tuloksena on suhteellisen hyödytön tulostusmuoto</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>propsin arvo on <span class="o">[</span>Object object]
</code></pre></div></div>

<p>kun taas pilkulla tulostettavat asiat erotellessa saat developer-konsoliin olion, jonka sisältöä on mahdollista tarkastella.</p>

<p>Koodin suorituksen voi pysäyttää chromen developer konsolin debuggeriin kirjoittamalla mihin tahansa kohtaa koodia komennon <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/debugger">debugger</a>.</p>

<p>Koodi pysähtyy kun suoritus etenee sellaiseen pisteeseen, että komento <em>debugger</em> suoritetaan:</p>

<p><img src="http://localhost:4000/assets/1/32.png" alt="" /></p>

<p>Menemällä välilehdelle <em>Console</em> on helppo tutkia muuttujien tilaa:</p>

<p><img src="http://localhost:4000/assets/1/33.png" alt="" /></p>

<p>Kun bugi selviää, voi komennon <em>debugger</em> poistaa ja uudelleenladata sivun.</p>

<p>Debuggerissa on mahdollista suorittaa koodia tarvittaessa rivi riviltä <em>Source</em> välilehden oikealta laidalta.</p>

<p>Debuggeriin pääsee myös ilman komentoa <em>debugger</em> lisäämällä <em>Source</em>-välilehdellä sopiviin kohtiin koodia <em>breakpointeja</em>. Haluttujen muuttujien arvojen tarkkailu on mahdollista määrittelemällä ne <em>Watch</em>-osassa:</p>

<p><img src="http://localhost:4000/assets/1/34.png" alt="" /></p>

<p>Chromeen kannattaa ehdottomasti asentaa <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">React developer tools</a> -lisäosa, joka tuo konsoliin uuden tabin <em>React</em>:</p>

<p><img src="http://localhost:4000/assets/1/35.png" alt="" /></p>

<p>Uuden konsolitabin avulla voidaan tarkkailla sovelluksen React-elementtejä ja niiden tilaa (eli this.state:a) ja propseja.</p>

<h2 id="tapahtumankäsittely-revisited">Tapahtumankäsittely revisited</h2>

<p>Pajan ja telegrammin havaintojen perusteella tapahtumankäsittely on osoittautunut haastavaksi.</p>

<p>Tarkastellaan asiaa vielä uudelleen.</p>

<p>Oletetaan, että käytössä on äärimmäisen yksinkertainen sovellus:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class App extends React.Component <span class="o">{</span>
  constructor<span class="o">()</span> <span class="o">{</span>
    super<span class="o">()</span>
    this.state <span class="o">=</span> <span class="o">{</span>
      value: 10
    <span class="o">}</span>
  <span class="o">}</span>
  render<span class="o">(){</span>
    <span class="k">return</span> <span class="o">(</span>
      &lt;div&gt;
        <span class="o">{</span>this.state.value<span class="o">}</span>
        &lt;button&gt;nollaa&lt;/button&gt;
      &lt;/div&gt;
    <span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

ReactDOM.render<span class="o">(</span>
  &lt;App /&gt;,
  document.getElementById<span class="o">(</span><span class="s1">'root'</span><span class="o">)</span>
<span class="o">)</span>
</code></pre></div></div>

<p>Haluamme, että napin avulla tilassa oleva <em>value</em> saadaan nollattua.</p>

<p>Jotta saamme napin reagoimaan, on sille lisättävä <em>tapahtumankäsittelijä</em>.</p>

<p>Tapahtumankäsittelijän tulee aina olla <em>funktio</em>. Jos tapahtumankäisttelijän paikalle yritetään laittaa jotain muuta, ei nappi toimi.</p>

<p>Jos esim. antaisimme tapahtumankäsittelijäksi merkkijonon:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span><span class="s2">"roskaa"</span><span class="o">}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>React varoittaa asiasta konsolissa</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>index.js:2178 Warning: Expected <span class="sb">`</span>onClick<span class="sb">`</span> listener to be a <span class="k">function</span>, instead got a value of <span class="sb">`</span>string<span class="sb">`</span> type.
    <span class="k">in </span>button <span class="o">(</span>at index.js:20<span class="o">)</span>
    <span class="k">in </span>div <span class="o">(</span>at index.js:18<span class="o">)</span>
    <span class="k">in </span>App <span class="o">(</span>at index.js:27<span class="o">)</span>
</code></pre></div></div>

<p>eli esim. seuraavanlainen yritys olisi tuhoon tuomittu</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>this.state.value+1<span class="o">}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>nyt tapahtumankäsittelijäksi on yritetty laittaa <em>this.state.value+1</em> mikä tarkoittaa laskuoperaation tulosta. React varoittaa tästäkin konsolissa</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>index.js:2178 Warning: Expected <span class="sb">`</span>onClick<span class="sb">`</span> listener to be a <span class="k">function</span>, instead got a value of <span class="sb">`</span>number<span class="sb">`</span> type.
</code></pre></div></div>

<p>Myöskään seuraava ei toimi</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>this.state.value <span class="o">=</span> 0<span class="o">}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>taaskaan tapahtumankäsittelijänä ei ole funktio vaan sijoitusoperaatio. Konsoliin tulee valitus. Tämä tapa on myös toisella tavalla väärin. Kuten on jo mainittu, reactin tilaa <em>ei saa muuttaa suoraan</em>, vaan ainoastaan funktion setState-avulla.</p>

<p>Entä seuraava:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>console.log<span class="o">(</span><span class="s1">'nappia painettu'</span><span class="o">)}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>konsoliin tulostuu kertaalleen <em>nappia painettu</em>, mutta nappia painellessa ei tapahdu mitään. Miksi tämä ei toimi vaikka tapahtumankäsittelijänä on nyt funktio <em>console.log</em>?</p>

<p>Ongelma on nyt siinä, että tapahtumankäsittelijänä on funktion kutsu, eli varsinaiseksi tapahtumankäsittelijäksi tulee funktion kutsun paluuarvo, joka on tässä tapauksessa <em>undefined</em>.</p>

<p>Funktiokutsu <em>console.log(‘nappia painettu’)</em> suoritetaan siinä vaiheessa kun komponentti renderöidään, ja tämän takia konsoliin tulee tulostus kertalleen.</p>

<p>Myös seuraava yritys on virheellinen</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>this.setState<span class="o">({</span>value: 0<span class="o">})}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>jälleen olemme yrittäneet laittaa tapahtumankäsittelijäksi funktiokutsun. Ei toimi. Tämä yritys aiheuttaa myös toisen ongelman. Kun komponenttia renderöidään, suoritetaan tapahtumankäsittelijänä oleva funktiokutsu <em>this.setState({value: 0})</em> joka taas saa aikaan komponentin uudelleenrenderöinnin. Ja uudelleenrenderöinnin yhteydessä funktiota kutsutaan uudelleen käynnistäen jälleen uusi uudelleenrenderöinti, ja joudutaan päättymättömään rekursioon.</p>

<p>Jos haluamme tietyn funktiokutsun tapahtuvan nappia painettaessa, toimii seuraava</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={()</span> <span class="o">=&gt;</span> console.log<span class="o">(</span><span class="s1">'nappia painettu'</span><span class="o">)}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>Nyt tapahtumankäsittelijä on nuolisyntaksilla määritelty funktio <em>() =&gt; console.log(‘nappia painettu’)</em>. Kun komponentti renderöidään, ei suoriteta mitään, ainoastaan talletetaan funktioviite tapahtumankäsittelijäksi. Itse funktion suoritus tapahtuu vasta napin painallusten yhteydessä.</p>

<p>Saamme myös nollauksen toimimaan samalla tekniikalla</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={()</span> <span class="o">=&gt;</span> this.setState<span class="o">({</span>value: 0<span class="o">})}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>eli nyt tapahtumankäsittelijä on funktio <em>() =&gt; this.setState({value: 0})</em>.</p>

<p>Tapahtumakäsittelijäfunktioiden määrittely suoraan napin määrittelyn yhteydessä ei välttämättä ole paras mahdollinen idea.</p>

<p>Usein tapahtumankäsittelijä määritelläänkin jossain muualla. Seuraavassa määritellään funktio metodin render alussa ja sijoitetaan se muuttujaan <em>handler</em>:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'nappia painettu'</span><span class="p">)</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="nx">handler</span><span class="si">}</span><span class="p">&gt;</span>nappi<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Muuttujassa <em>handler</em> on nyt talletettuna viite itse funktioon. Viite annetaan napin määrittelyn yhteydessä</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>handler<span class="o">}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>Tapahtumankäsittelijäfunktio voi luonnollisesti koostua useista komennoista, tällöin käytetään nuolifunktion aaltosulullista muotoa:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'nappia painettu'</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="nx">handler</span><span class="si">}</span><span class="p">&gt;</span>nappi<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Joissain tilanteissa tapahtumankäsittelijät kannattaa määritellä komponentin metodeina:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// ...</span>

  <span class="nx">handler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'nappia painettu'</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="na">value</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handler</span><span class="si">}</span><span class="p">&gt;</span>nappi<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Koska <em>handler</em> on nyt komponentin metodi, päästään siihen käsiki viitteen <em>this</em> avulla:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>this.handler<span class="o">}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>Mennään lopuksi funktioita palauttavaan funktioon.</p>

<p>Muutetaa koodia seuraavasti</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">hello</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">)</span>

    <span class="k">return</span> <span class="nx">handler</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick=</span><span class="si">{</span><span class="nx">hello</span><span class="p">()</span><span class="si">}</span><span class="p">&gt;</span>nappi<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Koodi näyttää hankalalta mutta se ihme kyllä toimii.</p>

<p>Tapahtumankäsittelijäksi on nyt “rekisteröity” funktiokutsu:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>hello<span class="o">()}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>Aiemmin varoteltiin, että tapahtumankäsittelijä ei saa olla funktiokutsu vaan sen on oltava funktio tai viite funktioon. Miksi funktiokutsu kuitenkin toimii nyt?</p>

<p>Kun komponenttia renderöidään suoritetaan seuraava funktio:</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">hello</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">)</span>

  <span class="k">return</span> <span class="nx">handler</span>
<span class="p">}</span>
</code></pre></div></div>

<p>funktion <em>paluuarvona</em> on nyt toinen, muuttujaan <em>handler</em> määritelty funktio.</p>

<p>eli kun react renderöi seuraavan rivin</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>hello<span class="o">()}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>sijoittaa se onClick-käsittelijäksi funktiokutsun <em>hello()</em> paluuarvon. Eli oleellisesti ottaen rivi “muuttuu” seuraavaksi</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={()</span> <span class="o">=&gt;</span> console.log<span class="o">(</span><span class="s1">'hello world'</span><span class="o">)}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>koska funktio <em>hello</em> palautti funktion, on tapahtumankäsittelijä nyt funktio.</p>

<p>Mitä järkeä tässä konseptissa on?</p>

<p>Muutetaan koodia hiukan:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>render<span class="o">()</span> <span class="o">{</span>
  const hello <span class="o">=</span> <span class="o">(</span>who<span class="o">)</span> <span class="o">=&gt;</span> <span class="o">{</span>
    const handler <span class="o">=</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="o">{</span> 
      console.log<span class="o">(</span><span class="s1">'hello'</span>, who<span class="o">)</span>
    <span class="o">}</span>

    <span class="k">return </span>handler
  <span class="o">}</span>

  <span class="k">return</span> <span class="o">(</span>
    &lt;div&gt;
      <span class="o">{</span>this.state.value<span class="o">}</span>
      &lt;button <span class="nv">onClick</span><span class="o">={</span>hello<span class="o">(</span><span class="s1">'world'</span><span class="o">)}&gt;</span>nappi&lt;/button&gt;
      &lt;button <span class="nv">onClick</span><span class="o">={</span>hello<span class="o">(</span><span class="s1">'react'</span><span class="o">)}&gt;</span>nappi&lt;/button&gt;
      &lt;button <span class="nv">onClick</span><span class="o">={</span>hello<span class="o">(</span><span class="s1">'function'</span><span class="o">)}&gt;</span>nappi&lt;/button&gt;
    &lt;/div&gt;
  <span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Nyt meillä on kolme nappia joiden tapahtumankäsittelijät määritellään parametrin saavan funktion <em>hello</em> avulla.</p>

<p>Ensimmäinen nappi määritellään seuraavasti</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>hello<span class="o">(</span><span class="s1">'world'</span><span class="o">)}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>Tapahtumankäsittelijä siis saadaan <em>suorittamalla</em> funktiokutsu <em>hello(‘world’)</em>. Funktiokutsu palauttaa funktion</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">()</span> <span class="o">=&gt;</span> <span class="o">{</span> 
  console.log<span class="o">(</span><span class="s1">'hello'</span>, <span class="s1">'world'</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Toinen nappi määritellään seuraavasti</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>hello<span class="o">(</span><span class="s1">'react'</span><span class="o">)}&gt;</span>nappi&lt;/button&gt;
</code></pre></div></div>

<p>Tapahtumankäsittelijän määrittelevä funktiokutsu <em>hello(‘react’)</em>.  palauttaa</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">()</span> <span class="o">=&gt;</span> <span class="o">{</span> 
  console.log<span class="o">(</span><span class="s1">'hello'</span>, <span class="s1">'react'</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>eli nappi saa oman yksilöllisen tapahtumankäsittelijänsä.</p>

<p>Funktioita palauttavia funktioita voikin hyödyntää määrittelemään geneeristä toiminnallisuutta, jota voi tarkentaa parametrien avulla. Tapahtumankäsittelijöitä luovan funktion <em>hello</em> voikin ajatella olevan eräänlainen tehdas, jota voi pyytää valmistamaan sopivia tervehtimiseen tarkoitettuja tapahtumankäsittelijäfunktioita.</p>

<p>Käyttämämme määrittelytapa</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const hello <span class="o">=</span> <span class="o">(</span>who<span class="o">)</span> <span class="o">=&gt;</span> <span class="o">{</span>
  const handler <span class="o">=</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="o">{</span> 
    console.log<span class="o">(</span><span class="s1">'hello'</span>, who<span class="o">)</span>
  <span class="o">}</span>

  <span class="k">return </span>handler
<span class="o">}</span>
</code></pre></div></div>

<p>on hieman verboosi. Eliminoidaan apumuuttuja, ja määritellään palautettava funktio suoraan returnin yhteydessä:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const hello <span class="o">=</span> <span class="o">(</span>who<span class="o">)</span> <span class="o">=&gt;</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="o">{</span> 
    console.log<span class="o">(</span><span class="s1">'hello'</span>, who<span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ja koska funktio <em>hello</em> sisältää ainoastaan yhden komennon, eli returnin, voidaan käyttää aaltosulutonta muotoa</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const hello <span class="o">=</span> <span class="o">(</span>who<span class="o">)</span> <span class="o">=&gt;</span>
  <span class="o">()</span> <span class="o">=&gt;</span> <span class="o">{</span> 
    console.log<span class="o">(</span><span class="s1">'hello'</span>, who<span class="o">)</span>
  <span class="o">}</span>

</code></pre></div></div>

<p>ja tuodaan vielä “kaikki nuolet” samalle riville</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const hello <span class="o">=</span> <span class="o">(</span>who<span class="o">)</span> <span class="o">=&gt;</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="o">{</span> 
  console.log<span class="o">(</span><span class="s1">'hello'</span>, who<span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Voimme käyttää samaa kikkaa myös muodostamaan tapahtumankäsittelijöitä, jotka asettavat komponentin tilalle halutun arvon. Muutetaan koodi muotoon:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>render<span class="o">()</span> <span class="o">{</span>
  const setToValue <span class="o">=</span> <span class="o">(</span>newValue<span class="o">)</span> <span class="o">=&gt;</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="o">{</span> 
    this.setState<span class="o">({</span> value: newValue <span class="o">})</span>
  <span class="o">}</span>

  <span class="k">return</span> <span class="o">(</span>
    &lt;div&gt;
      <span class="o">{</span>this.state.value<span class="o">}</span>
      &lt;button <span class="nv">onClick</span><span class="o">={</span>setToValue<span class="o">(</span>1000<span class="o">)}&gt;</span>tuhat&lt;/button&gt;
      &lt;button <span class="nv">onClick</span><span class="o">={</span>setToValue<span class="o">(</span>0<span class="o">)}&gt;</span>nollaa&lt;/button&gt;
      &lt;button <span class="nv">onClick</span><span class="o">={</span>setToValue<span class="o">(</span>this.state.value+1<span class="o">)}&gt;</span>kasvata&lt;/button&gt;
    &lt;/div&gt;
  <span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Kun komponentti renderöidään, ja tehdään nappia tuhat</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>setToValue<span class="o">(</span>1000<span class="o">)}&gt;</span>tuhat&lt;/button&gt;
</code></pre></div></div>

<p>tulee tapahtumankäsittelijäksi funktiokutsun <em>setToValue(1000)</em> paluuarvo eli seuraava funktio</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">()</span> <span class="o">=&gt;</span> <span class="o">{</span> 
  this.setState<span class="o">({</span> value: 1000 <span class="o">})</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Kasvatusnapin generoima rivi on seuraava</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;button <span class="nv">onClick</span><span class="o">={</span>setToValue<span class="o">(</span>this.state.value+1<span class="o">)}&gt;</span>kasvata&lt;/button&gt;
</code></pre></div></div>

<p>Tapahtumankäsittelijän muodostaa funktiokutsu <em>setToValue(this.state.value+1)</em>, joka saa parametrikseen tilan kentän <em>value</em> nykyisen arvon kasvatettuna yhdellä. Jos <em>this.state.value</em> olisi 10, tulisi tapahtumankäsittelijäksi funktio</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">()</span> <span class="o">=&gt;</span> <span class="o">{</span> 
  this.setState<span class="o">({</span> value: 11 <span class="o">})</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="hyödyllistä-materiaalia">Hyödyllistä materiaalia</h3>

<p>Internetissä on todella paljon Reactiin liittyvää materiaalia, tässä muutamia linkkejä:</p>
<ul>
  <li>Reactin <a href="https://reactjs.org/docs/hello-world.html">docs</a> kannattaa ehdottomasti käydä läpi, ei välttämättä kaikkea nyt, osa on ajankohtaista vasta kurssin myöhemmissä osissa</li>
  <li>Reactin sivuilla oleva <a href="https://reactjs.org/tutorial/tutorial.html">tutoriaali</a> sen sijaan on aika huono</li>
  <li><a href="https://egghead.io">Egghed.io</a>:n kursseista <a href="https://egghead.io/courses/start-learning-react">Start learning React</a> on laadukas ja hieman uudempi <a href="https://egghead.io/courses/the-beginner-s-guide-to-reactjs">The Beginner’s guide to React</a> myös kohtuullisen hyvä, molemmat sisältävät myös asiaa jotka tulevat tällä kurssilla vasta myöhemmissä osissa</li>
</ul>

<h3 id="lisää-react-tehtäviä">Lisää React-tehtäviä</h3>

<p>Tee nyt <a href="/tehtävät#lisää-reactia">tehtävät 1.6-1.14</a></p>

  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
             Full stack open 
          </li>
          <li>
            <a href="mailto:mluukkai@cs.helsinki.fi">mluukkai@cs.helsinki.fi</a>
          </li>
          <li>
            <a href="https://github.com/mluukkai"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">mluukkai</span></a>

          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
           
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>
          <a href="https://courses.helsinki.fi/fi/TKT21009/121540749">https://courses.helsinki.fi/fi/TKT21009/121540749</a>
        </p>
      </div>
    </div>

  </div>

</footer>

  </body>

</html>
